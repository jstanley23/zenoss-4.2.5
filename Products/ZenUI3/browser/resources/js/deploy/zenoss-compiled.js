/*
 * Copyright (c) 2009-2011 Zenoss, Inc.
 * 
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * version 2 as published by the Free Software Foundation.
 * 
 * For complete information please visit http://www.zenoss.com/oss/
 */
(function(){Ext.override(Ext.form.field.Hidden,{fieldSubTpl:['<input id="{id}" type="{type}" {inputAttrTpl}',' size="1"','<tpl if="name"> name="{name}"</tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' class="{fieldCls} {typeCls} {editableCls}" autocomplete="off"/>',{disableFormats:true}]});Ext.data.Types.AUTO.convert=function(a){return a};Ext.override(Ext.form.field.Checkbox,{inputValue:true,uncheckedValue:false});Ext.override(Ext.resizer.Splitter,{width:2});Ext.override(Ext.panel.Panel,{frame:false,border:false});Ext.override(Ext.AbstractComponent,{initRef:function(){if(this.ref&&!this.refOwner){var d=this.ref.split("/"),c=d.length,b=0,a=this;while(a&&b<c){a=a.ownerCt;++b}if(a){a[this.refName=d[--b]]=this;this.refOwner=a}}},recursiveInitRef:function(){this.initRef();if(Ext.isDefined(this.items)){Ext.each(this.items.items,function(c){c.recursiveInitRef()},this)}if(Ext.isFunction(this.child)){var b=this.child('*[dock="top"]');if(b){b.recursiveInitRef()}var a=this.child('*[dock="bottom"]');if(a){a.recursiveInitRef()}}},removeRef:function(){if(this.refOwner&&this.refName){delete this.refOwner[this.refName];delete this.refOwner}},onAdded:function(a,b){this.ownerCt=a;this.recursiveInitRef();this.fireEvent("added",this,a,b)},onRemoved:function(){this.removeRef();var a=this;a.fireEvent("removed",a,a.ownerCt);delete a.ownerCt},removeCls:function(a){try{var c=this,b=c.rendered?c.el:c.protoEl;b.removeCls.apply(b,arguments);return c}catch(d){}}});Ext.reg=function(c,a){if(Ext.isString(a)){Ext.ClassManager.setAlias(a,"widget."+c)}else{var b="Zenoss.component."+c;if(Ext.ClassManager.get(b)){Ext.ClassManager.setAlias(b,"widget."+c)}else{throw Ext.String.format("Unable to to register the xtype {0}: change the Ext.reg definition from the object to a string",c)}}};Ext.override(Ext.selection.Model,{selectRange:function(l,f,m,d){var j=this,k=j.store,e=0,h,g,a,c=[];if(j.isLocked()){return}if(!m){j.deselectAll(true)}if(!Ext.isNumber(l)){l=k.indexOf(l)}if(!Ext.isNumber(f)){f=k.indexOf(f)}var b=false;if(l>f){b=true;g=f;f=l;l=g}for(h=l;h<=f;h++){if(j.isSelected(k.getAt(h))){e++}}if(!d){a=-1}else{a=(d=="up")?l:f}for(h=l;h<=f;h++){if(e==(f-l+1)){if(h!=a){j.doDeselect(h,true)}}else{c.push(k.getAt(h))}}if(!b){c.reverse()}j.doMultiSelect(c,true)}});Ext.override(Ext.view.AbstractView,{onItemDeselect:function(a){var b=this.getNode(a);if(b){Ext.fly(b).removeCls(this.selectedItemCls)}},onItemSelect:function(a){var b=this.getNode(a);if(b){Ext.fly(b).addCls(this.selectedItemCls)}}});Ext.override(Ext.form.ComboBox,{onExpand:function(){var b=this,a=this.getPicker();if(Ext.isIE){var c=Ext.DomQuery.selectNode("#"+a.id+" .x-boundlist-list-ct");Ext.defer(function(){var d=Ext.DomQuery.selectNode("#"+a.id);c.style.cssText="width: 100%; height: 100%; overflow: auto;"},100,b)}}});Ext.override(Ext.layout.Context,{runComplete:function(){var a=this;a.state=2;if(a.remainingLayouts){a.handleFailure()}a.flush();a.flushLayouts("finishQueue","finishedLayout",true);a.flushLayouts("finishQueue","notifyOwner");a.flush();a.flushAnimations();return true}});Ext.override(Ext.ux.form.MultiSelect,{getSubmitValue:function(){var b=this,a=b.delimiter,c=b.getValue();if(Ext.isString(c)){return Ext.isString(a)?c.join(a):c}return""}});Ext.override(Ext.data.Store,{cancelAllPrefetches:function(){var c=this,a=c.pageRequests,b,d;if(c.pageMap.events.pageadded){c.pageMap.events.pageadded.clearListeners()}for(d in a){if(a.hasOwnProperty(d)){b=a[d];delete a[d];if(b){delete b.callback}}}}});Ext.override(Ext.flash.Component,{afterRender:function(){var b=this,a=Ext.apply({wmode:"transparent"},b.flashParams),c=Ext.apply({},b.flashVars);b.callParent();new swfobject.embedSWF(b.url,b.getSwfId(),b.swfWidth,b.swfHeight,b.flashVersion,b.expressInstall?b.statics.EXPRESS_INSTALL_URL:undefined,c,a,b.flashAttributes,Ext.bind(b.swfCallback,b))}});Ext.override(Ext.data.Store,{prefetchPage:function(e,b){var d=this,a=d.pageSize||d.defaultPageSize,f=Math.max((e-1)*d.pageSize,0),c=d.totalCount;if(c!==undefined&&d.getCount()===c){return}d.prefetch(Ext.apply({page:e,start:f,limit:a},b))},loadToPrefetch:function(a){var c=this,b=function(){if(c.rangeCached(a.start,a.limit-1)){c.pageMap.un("pageAdded",b);c.guaranteeRange(a.start,c.pageSize-1)}};c.pageMap.on("pageAdded",b);return c.prefetch(a||{})}});Ext.define("Ext.overrides.panel.Table",{override:"Ext.panel.Table",syncHorizontalScroll:function(d,b){var c=this,a;b=b===true;if(c.rendered&&(b||d!==c.scrollLeftPos)){if(b){a=c.getScrollTarget();a.el.dom.scrollLeft=d}c.headerCt.el.dom.scrollLeft=d;c.scrollLeftPos=d}}});Ext.override(Ext.grid.column.Column,{defaultRenderer:Ext.htmlEncode});Ext.define("Ext.data.TreeStoreOverride",{override:"Ext.data.TreeStore",applyFilters:function(a){var h=this,l=h.decodeFilters(a),f=0,b=l.length,c,e=[],d=[],k=h.getRootNode(),n=h.tree.flatten(),g,m,j;h.snapshot=h.snapshot||h.getRootNode().copy(null,true);for(f=0;f<b;f++){h.filters.replace(l[f])}g=h.filters.items;b=g.length;for(f=0;f<b;f++){m=g[f];j=m.filterFn||function(o){return o.get(o.property)==o.value};e=Ext.Array.merge(e,Ext.Array.filter(n,j))}b=e.length;for(f=0;f<b;f++){c=e[f];c.bubble(function(o){if(o.parentNode){d.push(o.parentNode)}else{return false}})}e=Ext.Array.merge(e,d);d=[];k.cascadeBy(function(o){if(!Ext.Array.contains(e,o)){d.push(o)}});b=d.length;for(f=0;f<b;f++){d[f].remove()}k.getOwnerTree().getView().refresh();k.getOwnerTree().expandAll();if(Ext.isFunction(k.getOwnerTree().postFilter)){k.getOwnerTree().postFilter()}},filter:function(d,e){var b,a,c,f;if(Ext.isString(d)){d={property:d,value:e}}f=function(g){return !g.isLeaf()&&!(g.isLoading()||g.isLoaded())};b=Ext.Array.filter(this.tree.flatten(),f);a=b.length;if(a===0){this.applyFilters(d)}else{for(c=0;c<a;c++){this.load({node:b[c],callback:function(){a--;if(a===0){this.filter(d,e)}},scope:this})}}},clearFilter:function(a){this.filters.clear();if(this.isFiltered()){this.setRootNode(this.snapshot);delete this.snapshot}},isFiltered:function(){var a=this.snapshot;return !!a&&a!==this.getRootNode()}})}());(function(){Ext.namespace("Zenoss.flares");Ext.define("Zenoss.flares.Container",{extend:"Ext.Container",_layoutDelay:null,constructor:function(a){a=Ext.applyIf(a||{},{id:"flare-container",baseCls:"x-flare-container",alignment:"t-t",width:"100%",zindex:400000,items:[]});this.callParent([a])},onRender:function(b,a){this.el=b.createChild({cls:this.baseCls+"-layer",children:[{cls:this.baseCls+"-body"}]});this.body=this.el.child("."+this.baseCls+"-body");this.el=new Ext.Layer({zindex:this.zindex},this.el);Zenoss.flares.Container.superclass.onRender.apply(this,arguments);this.el.alignTo(document,this.alignment)},getLayoutTarget:function(){return this.body},onShow:function(){this.el.show();Zenoss.flares.Container.superclass.onShow.apply(this,arguments)},onRemove:function(){if(!this._layoutDelay){this._layoutDelay=new Ext.util.DelayedTask(this.doLayout,this)}this._layoutDelay.delay(500)},show:function(){if(!this.rendered){this.render(Ext.getBody())}Zenoss.flares.Container.superclass.show.apply(this,arguments)},onLayout:function(){Ext.each(this.items.items,function(c,b,a){if(c.canLayout()){if(b==0){c.anchorTo(this.el,this.alignment)}else{c.anchorTo(a[b-1].el,"tl")}}},this);Zenoss.flares.Container.superclass.onLayout.apply(this,arguments)}});Zenoss.flares.Manager={container:Ext.create("Zenoss.flares.Container",{}),INFO:"x-flare-info",ERROR:"x-flare-error",WARNING:"x-flare-warning",DEBUG:"x-flare-debug",SUCCESS:"x-flare-success",CRITICAL:"x-flare-critical",_visibleFlares:new Ext.util.MixedCollection(false,function(a){return a._bodyHtml}),flare:function(b){var a=Zenoss.flares.Manager._visibleFlares.last();Zenoss.flares.Manager._visibleFlares.add(b._bodyHtml,b);if(a){b.on("afterrender",function(c){c.alignTo(a.getEl(),"bl-bl",[0,32])})}else{b.on("afterrender",function(c){c.alignTo(Ext.getBody(),"tl-tl")})}if(Ext.isIE){b.on("afterrender",function(c){c.setWidth(c.getWidth())})}if(Zenoss.SELENIUM){b.on("afterrender",function(c){c.getEl().query(".x-flare-message")[0].id="flare-message-span"})}Zenoss.flares.Manager.container.add(b);Zenoss.flares.Manager.container.doLayout();b.show()},removeFlare:function(a){Zenoss.flares.Manager._visibleFlares.removeAtKey(a._bodyHtml);Zenoss.flares.Manager.adjustFlares()},adjustFlares:function(){var c=Zenoss.flares.Manager._visibleFlares;var a=Ext.getBody(),b=false;c.each(function(d){if(!b){d.alignTo(a,"tl-tl");b=true}else{d.alignTo(a,"bl-bl",[0,32])}a=d.getEl()})},_formatFlare:function(e,d,b){e=Ext.htmlDecode(e);b=Array.prototype.slice.call(b,1);var c=new Zenoss.flares.Flare(e,b,{iconCls:d,animateTarget:Zenoss.flares.Manager.container.el});var a=Zenoss.flares.Manager._visibleFlares.get(c._bodyHtml);if(a==undefined){Zenoss.flares.Manager.flare(c);return c}c.destroy();return a},info:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.INFO,arguments)},error:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.ERROR,arguments)},warning:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.WARNING,arguments)},debug:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.DEBUG,arguments)},critical:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.CRITICAL,arguments)},success:function(b,a){return Zenoss.flares.Manager._formatFlare(b,Zenoss.flares.Manager.SUCCESS,arguments)}};Ext.define("Zenoss.flares.Flare",{extend:"Ext.Window",_bodyHtml:null,_task:null,_closing:false,focus:Ext.emptyFn,constructor:function(d,e,a){if(Ext.isArray(d)){var b=[];Ext.each(d,function(f){b.push({tag:"li",html:f})});d=Ext.DomHelper.markup({tag:"ul",children:b})}var c=new Ext.Template(d,{compiled:true});this._bodyHtml=c.apply(e);Ext.applyIf(a,{headerAsText:false,bodyCls:a.iconCls||"x-flare-info",baseCls:"x-flare",plain:false,draggable:false,shadow:false,closable:true,resizable:false,delay:5000,alignment:"t-t",duration:0.2,hideDuration:1,template:c,cls:"x-flare-body",height:"32",dismissOnClick:true,listeners:{show:function(){if(this._task){this._task.delay(this.delay)}},hide:function(){Zenoss.flares.Manager.removeFlare(this)},scope:this},items:{html:"<div class='x-flare-icon'></div><span class='x-flare-message'>"+this._bodyHtml+"</span>"}});this.callParent([a])},initEvents:function(){this.callParent(arguments);this.mon(this.el,"mouseover",function(){this.sticky()},this);this.mon(this.el,"mouseout",function(){Ext.defer(function(){this.hide()},1000,this)},this);if(this.dismissOnClick){this.mon(this.el,"click",function(){this.hide()},this)}},initComponent:function(){if(this.delay){this._task=new Ext.util.DelayedTask(this.hide,this)}this.callParent(arguments)},sticky:function(){if(this._task){this._task.cancel();delete this._task}},animShow:function(){this.el.slideIn("t",{duration:this.duration,callback:this._afterShow,scope:this})},close:function(){Zenoss.flares.Manager._visibleFlares.removeAtKey(this._bodyHtml);this.hide()},animHide:function(){Zenoss.flares.Manager._visibleFlares.removeAtKey(this._bodyHtml);this._closing=true;this.el.ghost("t",{duration:this.hideDuration,remove:false,callback:Ext.bind(function(){this.destroy()},this)})},canLayout:function(){if(!this._closing){return Zenoss.flares.Flare.superclass.canLayout.apply(this,arguments)}}});Ext.namespace("Zenoss.messaging");Ext.define("Zenoss.messaging.Message",{INFO:0,WARNING:1,CRITICAL:2,constructor:function(a){a=Ext.applyIf(a||{},{body:"",priority:this.INFO,sticky:false});Ext.apply(this,a)}});Ext.define("Zenoss.messaging.Messenger",{extend:"Ext.util.Observable",constructor:function(a){a=Ext.applyIf(a||{},{interval:30000});Ext.apply(this,a);this.callParent([a]);this.addEvents("message")},init:function(){this._task=new Ext.util.DelayedTask(function(){this.checkMessages()},this);this._task.delay(this.interval);this.checkMessages()},checkMessages:function(){Zenoss.remote.MessagingRouter.getUserMessages({},function(a){Ext.each(a.messages,function(b){this.send(b)},this)},this)},send:function(c){var b=new Zenoss.messaging.Message(c);this.fireEvent("message",this,b);var a;if(b.priority===b.WARNING){a=Zenoss.flares.Manager.warning(b.body)}else{if(b.priority===b.CRITICAL){a=Zenoss.flares.Manager.critical(b.body)}else{a=Zenoss.flares.Manager.info(b.body)}}if(b.sticky){a.sticky()}}});Zenoss.messenger=Ext.create("Zenoss.messaging.Messenger",{});Ext.onReady(function(){Zenoss.flares.Manager.container.show();Zenoss.messenger.init()});Zenoss.message={info:function(b,a){return Zenoss.flares.Manager.info.apply(null,arguments)},error:function(b,a){return Zenoss.flares.Manager.error.apply(null,arguments)},warning:function(b,a){return Zenoss.flares.Manager.warning.apply(null,arguments)},debug:function(b,a){return Zenoss.flares.Manager.debug.apply(null,arguments)},critical:function(c,a){var b=Zenoss.flares.Manager.critical.apply(null,arguments);b.sticky();return b},success:function(b,a){return Zenoss.flares.Manager.success.apply(null,arguments)}}}());(function(){Ext.BLANK_IMAGE_URL="/++resource++zenui/img/s.gif";Zenoss.logDirectRequests=false;Ext.apply(Ext.direct.RemotingProvider.prototype,{queueTransaction:Ext.Function.createInterceptor(Ext.direct.RemotingProvider.prototype.queueTransaction,function(h){if(Zenoss.logDirectRequests){console.log(Ext.String.format("Router: {0} Method: {1}",h.action,h.method));console.trace(Ext.String.format("Router: {0} Method: {1}",h.action,h.method))}})});Ext.namespace("Zenoss");Zenoss.SEVERITY_CLEAR=0;Zenoss.SEVERITY_DEBUG=1;Zenoss.SEVERITY_INFO=2;Zenoss.SEVERITY_WARNING=3;Zenoss.SEVERITY_ERROR=4;Zenoss.SEVERITY_CRITICAL=5;Zenoss.STATUS_NEW=0;Zenoss.STATUS_ACKNOWLEDGED=1;Zenoss.STATUS_SUPPRESSED=2;Zenoss.STATUS_CLOSED=3;Zenoss.STATUS_CLEARED=4;Zenoss.STATUS_DROPPED=5;Zenoss.STATUS_AGED=6;Zenoss.SELENIUM=0;Ext.namespace("Zenoss.env");Ext.QuickTips.init();Zenoss.env.getColumnDefinitions=function(h){Ext.each(Zenoss.env.COLUMN_DEFINITIONS,function(j){if(Zenoss.events.customColumns[j.dataIndex]){Ext.apply(j,Zenoss.events.customColumns[j.dataIndex])}});if(h){return Zenoss.util.filter(Zenoss.env.COLUMN_DEFINITIONS,function(j){return Ext.Array.indexOf(h,j.id)==-1})}else{return Zenoss.env.COLUMN_DEFINITIONS}};Zenoss.env.initProductionStates=function(){var h=Zenoss.env.productionStates;if(!Zenoss.env.PRODUCTION_STATES){Zenoss.env.PRODUCTION_STATES=[];Zenoss.env.PRODUCTION_STATES_MAP={};Ext.each(h,function(j){Zenoss.env.PRODUCTION_STATES.push(j);Zenoss.env.PRODUCTION_STATES_MAP[j.value]=j.name})}};Zenoss.env.initPriorities=function(){var h=Zenoss.env.priorities;if(!Zenoss.env.PRIORITIES){Zenoss.env.PRIORITIES=[];Zenoss.env.PRIORITIES_MAP={};Ext.each(h,function(j){Zenoss.env.PRIORITIES.push(j);Zenoss.env.PRIORITIES_MAP[j.value]=j.name})}};Ext.define("Zenoss.state.PersistentProvider",{extend:"Ext.state.Provider",directFn:Zenoss.remote.MessagingRouter.setBrowserState,constructor:function(){this.callParent(arguments);this.on("statechange",this.save,this);this.task=null},setState:function(h){var j=Ext.decode(h);this.state=Ext.isObject(j)?j:{}},save:function(){if(!this.onSaveTask){this.onSaveTask=new Ext.util.DelayedTask(function(){this.directFn({state:Ext.encode(this.state)})},this)}this.onSaveTask.delay(500)},saveStateNow:function(j,h){this.directFn({state:Ext.encode(this.state)},function(){Ext.callback(j,h)})}});Ext.state.Manager.setProvider(Ext.create("Zenoss.state.PersistentProvider"));Ext.Direct.on("event",function(h,j){if(Ext.isDefined(h.result)&&h.result&&Ext.isDefined(h.result.asof)){Zenoss.env.asof=h.result.asof||null}});Ext.Direct.on("event",function(h){if(Ext.isDefined(h.result)&&h.result&&Ext.isDefined(h.result.msg)&&h.result.msg.startswith("ObjectNotFoundException")){new Zenoss.dialog.SimpleMessageDialog({title:_t("Stale Data Warning"),message:_t("Another user has edited the information on this page since you loaded it. Please reload the page."),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){window.location.reload()}},{xtype:"DialogButton",text:_t("Cancel")}]}).show();return false}});Ext.Direct.on("event",function(k){if(Ext.isDefined(k.result)&&k.result&&Ext.isDefined(k.result.msg)){var l=k.result.success||false,j=k.result.sticky||false,h;if(l){h=Zenoss.message.success(k.result.msg)}else{h=Zenoss.message.error(k.result.msg)}if(j){h.sticky()}}});function f(){var h=0,j;for(j in Ext.Ajax.requests){h++}return h}function e(h){if(document.body){document.body.style.cursor=h}}Ext.Ajax.on("beforerequest",function(){e("wait")});function c(){if(f()<=1){e("default")}}Ext.Ajax.on("requestcomplete",c);Ext.Ajax.on("requestexception",c);Zenoss.env.unloading=false;Ext.EventManager.on(window,"beforeunload",function(){Zenoss.env.unloading=true});Ext.Direct.on("exception",function(k){if(Zenoss.env.unloading===true){return}if(k.message.startswith("Error parsing json response")&&k.message.endswith("null")){window.location.reload();return}var h="serverExceptionDialog",j;j=Ext.getCmp(h);if(j){j.destroy()}Ext.create("Zenoss.dialog.SimpleMessageDialog",{id:h,title:_t("Server Exception"),message:"<p>"+_t("The server reported the following error:")+'</p><p class="exception-message">'+k.message+"</p><p>"+_t("The system has encountered an error.")+" "+_t("Please reload the page.")+"</p>",buttons:[{xtype:"DialogButton",text:_t("RELOAD"),handler:function(){window.location.reload()}},{xtype:"DialogButton",text:_t("DISMISS")}]}).show()});Ext.Direct.on("event",function(j){var h=Ext.getCmp("serverExceptionDialog");if(h&&Ext.isDefined(j.result)){h.hide();h.destroy()}});Ext.Element.prototype.setOverflow=function(h,j){j=j?j.toString().toUpperCase():"";var k="overflow";if(j=="X"||j=="Y"){k+=j}if(h=="auto"&&Ext.isMac&&Ext.isGecko2){this.dom.style[k]="hidden";(function(){this.dom.style[k]="auto"}).defer(1,this)}else{this.dom.style[k]=h}};Ext.override(Ext.Panel,{setAutoScroll:function(){if(this.rendered&&this.autoScroll){var h=this.body||this.el;if(h){h.setOverflow("auto",this.autoScroll)}}}});var b=Ext.dd.DragZone.prototype.getDragData;Ext.override(Ext.dd.DragZone,{getDragData:function(j){var h=Ext.lib.Event.getTarget(j);if(h.tagName=="A"){j.target=j.getTarget("div.x-grid3-cell-inner")}return b.call(this,j)}});Zenoss.PlaceholderPanel=Ext.extend(Ext.Panel,{constructor:function(h){Ext.apply(h,{cls:"placeholder",layout:"fit",border:false,items:[{baseCls:"inner",border:false,html:h.text,listeners:{resize:function(j){j.getEl().setStyle({"line-height":j.getEl().getComputedHeight()+"px"})}}}]});Zenoss.PlaceholderPanel.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.LargeToolbar",{alias:"widget.largetoolbar",extend:"Ext.toolbar.Toolbar",constructor:function(h){Ext.applyIf(h,{ui:"large",cls:"largetoolbar",height:45,border:false});Zenoss.LargeToolbar.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.SingleRowSelectionModel",{extend:"Ext.selection.RowModel",mode:"SINGLE",getSelected:function(){var h=this.getSelection();if(!h.length){return null}return h[0]}});Ext.define("Zenoss.ExtraHooksSelectionModel",{extend:"Zenoss.SingleRowSelectionModel",suppressDeselectOnSelect:false,initEvents:function(){Zenoss.ExtraHooksSelectionModel.superclass.initEvents.call(this);this.addEvents("rangeselect");this.on("beforeselect",function(){if(this.suppressDeselectOnSelect){this.selectingRow=true}},this)},clearSelections:function(){if(this.selectingRow){this.suspendEvents()}Zenoss.ExtraHooksSelectionModel.superclass.clearSelections.apply(this,arguments);if(this.selectingRow){this.resumeEvents();this.selectingRow=false}},selectRange:function(j,h,k){this.suspendEvents();Zenoss.ExtraHooksSelectionModel.superclass.selectRange.apply(this,arguments);this.resumeEvents();this.fireEvent("rangeselect",this)}});Zenoss.PostRefreshHookableDataView=Ext.extend(Ext.DataView,{constructor:function(h){Zenoss.PostRefreshHookableDataView.superclass.constructor.apply(this,arguments);this.addEvents("afterrefresh")}});Ext.extend(Zenoss.PostRefreshHookableDataView,Ext.DataView,{refresh:function(){this.clearSelections(false,true);this.el.update("");var h=this.store.getRange();if(h.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){this.el.update(this.emptyText)}this.hasSkippedEmptyText=true;this.all.clear();return}this.tpl.overwrite(this.el,this.collectData(h,0));this.fireEvent("afterrefresh",this);this.all.fill(Ext.query(this.itemSelector,this.el.dom));this.updateIndexes(0)}});Ext.define("Zenoss.MultiselectMenu",{extend:"Ext.button.Button",alias:["widget.multiselectmenu"],makeItemConfig:function(k,j){var h={hideOnClick:false,handler:Ext.bind(function(){this.fireEvent("change")},this),value:j,text:k};return h},constructor:function(h){h.menu=h.menu||[];Zenoss.MultiselectMenu.superclass.constructor.apply(this,arguments);this.initialSetValue(h)},initialSetValue:function(h){var j=this.defaultValues||[];if(Ext.isDefined(h.store)){this.hasLoaded=false;h.store.on("load",function(k,l){this.menu.removeAll();Ext.each(l,function(n){var m=this.makeItemConfig(n.data.name,n.data.value);m.checked=(Ext.Array.indexOf(j,n.data.value)>-1);this.menu.add(m)},this);this.hasLoaded=true},this);h.store.load()}else{this.hasLoaded=true;Ext.each(h.source,function(l){var k=this.makeItemConfig(l.name,l.value);k.checked=(Ext.Array.indexOf(j,l.value)>-1);this.menu.add(k)},this)}},reset:function(){this.setValue()},_initialValue:null,getValue:function(){if(!this.hasLoaded){return this._initialValue||this.defaultValues}var h=[];Ext.each(this.menu.items.items,function(j){if(j.checked){h[h.length]=j.value}});return h},setValue:function(j){if(!j){this.initialSetValue(this.initialConfig)}else{function h(m){var k=false;try{k=j.indexOf(m.value)!=-1}catch(n){var l}m.setChecked(k)}if(!this.hasLoaded){this._initialValue=j;this.menu.on("add",function(l,k){h(k)})}else{Ext.each(this.menu.items.items,h)}}}});Ext.define("Zenoss.StatefulRefreshMenu",{extend:"Ext.menu.Menu",alias:["widget.statefulrefreshmenu"],constructor:function(h){h.stateful=true;h.stateEvents=["click"];this.callParent([h])},getState:function(){return[this.trigger.interval]},applyState:function(j){var k=j[0]||60;if(k==1){k=5}var h=this.items.items;Ext.each(h,function(l){if(l.value==k){l.checked=true}return},this);this.trigger.on("afterrender",function(){this.trigger.setInterval(k)},this)}});Ext.define("Zenoss.RefreshMenuButton",{extend:"Ext.button.Split",alias:["widget.refreshmenu"],constructor:function(h){var j={xtype:"statefulrefreshmenu",id:h.stateId||"evc_refresh",trigger:this,width:127,items:[{cls:"refreshevery",text:"Refresh every",canActivate:false},{xtype:"menucheckitem",text:"5 seconds",value:5,group:"refreshgroup"},{xtype:"menucheckitem",text:"10 seconds",value:10,group:"refreshgroup"},{xtype:"menucheckitem",text:"30 seconds",value:30,group:"refreshgroup"},{xtype:"menucheckitem",text:"1 minute",value:60,group:"refreshgroup"},{xtype:"menucheckitem",text:"Manually",value:-1,group:"refreshgroup"}]};Ext.applyIf(h,{menu:j});this.callParent([h]);this.refreshTask=new Ext.util.DelayedTask(this.poll,this);this.menu.on("click",function(l,k){this.setInterval(k.value)},this);this.setInterval(60)},setInterval:function(h){var j=false;this.menu.items.each(function(k){if(k.value==h){j=true}});if(j){this.interval=h;this.refreshTask.delay(this.interval*1000)}},poll:function(){if(this.interval>0){if(!this.disabled){if(Ext.isDefined(this.pollHandler)){this.pollHandler()}else{this.handler(this)}}this.refreshTask.delay(this.interval*1000)}}});Ext.define("EventActionManager",{extend:"Ext.util.Observable",constructor:function(h){var j=this;h=h||{};Ext.applyIf(h,{cancelled:false,dialog:new Ext.Window({width:300,modal:true,title:_t("Processing..."),layout:"anchor",closable:false,bodyBorder:false,border:false,hideBorders:true,plain:true,buttonAlign:"left",stateful:false,items:[{xtype:"panel",ref:"panel",layout:"anchor",items:[{xtype:"box",ref:"../status",autoEl:{tag:"p",html:_t("Processing...")},height:20},{xtype:"progressbar",width:270,unstyled:true,ref:"../progressBar"}]}],buttons:[{xtype:"DialogButton",text:_t("Cancel"),ref:"../cancelButton",handler:function(l,k){j.cancelled=true;j.finishAction()}}]}),events:{updateRequestIncomplete:true,updateRequestComplete:true},listeners:{updateRequestIncomplete:function(k){if(!j.cancelled){j.run()}},updateRequestComplete:function(k){j.finishAction()}},isLargeRequest:function(){return j.params.evids.length>100||j.params.evids.length==0},action:function(k,l){throw ("The EventActionManager action must be implemented before use.")},startAction:function(){j.cancelled=false;if(j.isLargeRequest()){j.dialog.show();j.dialog.status.update(_t("Processing..."))}j.run()},run:function(){if(j.next_request===null){Ext.apply(j.params,{limit:100});j.action(j.params,j.requestCallback)}else{Zenoss.remote.EventsRouter.nextEventSummaryUpdate({next_request:j.next_request},j.requestCallback)}},finishAction:function(){j.dialog.hide();if(j.onFinishAction){j.onFinishAction()}},requestCallback:function(n,k){var m=k.result.data;if(!m){new Zenoss.dialog.ErrorDialog({message:_t("There was an error handling your request.")});j.finishAction();return}j.eventsUpdated+=m.updated;if(m.next_request){j.next_request=m.next_request;if(j.isLargeRequest()){var l=m.next_request.offset/m.total;j.dialog.status.update(Ext.String.format(_t("Progress: {0}%"),Math.ceil(l*100)));j.dialog.progressBar.updateProgress(l)}j.fireEvent("updateRequestIncomplete",{data:m})}else{if(j.dialog.isVisible()){j.dialog.progressBar.wait({interval:120,duration:1200,increment:10,text:"",scope:this,fn:function(){j.next_request=null;j.fireEvent("updateRequestComplete",{data:m})}})}else{j.next_request=null;j.fireEvent("updateRequestComplete",{data:m})}}},reset:function(){j.eventsUpdated=0;j.next_request=null;j.dialog.progressBar.reset()},findParams:function(){throw ("The EventActionManager findParams() method must be implemented before use.")},execute:function(k){j.action=k;j.params=j.findParams();if(j.params){j.reset();j.startAction()}},configure:function(k){Ext.apply(this,k)}});Ext.apply(this,h);EventActionManager.superclass.constructor.call(this,h)}});Ext.onReady(function(){Zenoss.EventActionManager=new EventActionManager()});Ext.define("Zenoss.ColumnFieldSet",{extend:"Ext.form.FieldSet",alias:["widget.ColumnFieldSet"],constructor:function(k){var j={items:{layout:"column",border:false,items:k.__inner_items__,defaults:{layout:"anchor",border:false,bodyStyle:"padding-left: 15px"}}};delete k.__inner_items__;var h=Ext.apply(j,k);Zenoss.ColumnFieldSet.superclass.constructor.call(this,h)}});Ext.namespace("Zenoss.util");Zenoss.util.isolatedRequest=function(j){var l=Ext.Direct.getProvider(j.directCfg.action),h=Ext.bind(l.combineAndSend,l),k;k=Ext.Function.createSequence(Ext.Function.createInterceptor(j,h),h);k.directCfg=Ext.clone(j.directCfg);return k};Zenoss.util.isSuccessful=function(h){return h.result&&h.result.success};Zenoss.util.addLoadingMaskToGrid=function(h){h.store.proxy.on("beforeload",function(){var k=this.container;k._treeLoadMask=k._treeLoadMask||new Ext.LoadMask(this.container);var j=k._treeLoadMask;j.show()},h);h.store.proxy.on("load",function(){var k=this.container;k._treeLoadMask=k._treeLoadMask||new Ext.LoadMask(this.container);var j=k._treeLoadMask;j.hide()},h)};Zenoss.env.SEVERITIES=[[5,"Critical"],[4,"Error"],[3,"Warning"],[2,"Info"],[1,"Debug"],[0,"Clear"]];Zenoss.util.convertSeverity=function(h){if(Ext.isString(h)){return h}var j=["clear","debug","info","warning","error","critical"];return j[h]};Zenoss.util.convertStatus=function(j){var h=["New","Acknowledged","Suppressed"];return h[j]};Zenoss.util.render_severity=function(h){return Zenoss.render.severity(h)};Zenoss.util.render_status=function(h){return Zenoss.render.evstatus(h)};Zenoss.util.render_linkable=function(l,k,h){var j=h.data[k.id+"_url"];var m=h.data[k.id+"_title"]||l;if(j){return'<a href="'+j+'">'+m+"</a>"}else{return m}};Zenoss.util.render_device_group_link=function(m,l,j){var k=j.data.DeviceGroups.split("|"),h="",o=undefined;for(var n=0;n<k.length;n++){o=k[n];if(o){h+="&nbsp;|&nbsp;"+Zenoss.render.DeviceGroup(o,o)}}return h};Zenoss.util.base64={base64s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",encode:function(o){if(typeof btoa==="function"){return btoa(o)}var j=this.base64s,k=0,h="",q,p,n,m,l;while(o.length>=k+3){n=(o.charCodeAt(k)&255)<<16;k++;m=(o.charCodeAt(k)&255)<<8;k++;l=o.charCodeAt(k)&255;k++;q=n|m|l;h+=j.charAt((q&16515072)>>18)+j.charAt((q&258048)>>12)+j.charAt((q&4032)>>6)+j.charAt((q&63))}if(o.length-k>0&&o.length-k<3){p=Boolean(o.length-k-1);n=((o.charCodeAt(k)&255)<<16);k++;m=(p?(o.charCodeAt(k)&255)<<8:0);q=n|m;h+=j.charAt((q&16515072)>>18)+j.charAt((q&258048)>>12)+(p?j.charAt((q&4032)>>6):"=")+"="}return(h)},decode:function(k){if(typeof atob==="function"){return atob(k)}var m=this.base64s;var l;var h="";var j=0;for(;j<k.length;j+=4){l=(m.indexOf(k.charAt(j))&255)<<18|(m.indexOf(k.charAt(j+1))&255)<<12|(m.indexOf(k.charAt(j+2))&255)<<6|m.indexOf(k.charAt(j+3))&255;h+=String.fromCharCode((l&16711680)>>16,(l&65280)>>8,l&255)}if(k.charCodeAt(j-2)==61){return(h.substring(0,h.length-2))}else{if(k.charCodeAt(j-1)==61){return(h.substring(0,h.length-1))}else{return(h)}}}};Zenoss.util.dot2num=function(h){var j=h.split(".");return((((((+j[0])*256)+(+j[1]))*256)+(+j[2]))*256)+(+j[3])};Zenoss.util.num2dot=function(h){var k=h%256;for(var j=3;j>0;j--){h=Math.floor(h/256);k=h%256+"."+k}return k};Zenoss.util.setContext=function(h){var j=Array.prototype.slice.call(arguments,1);Ext.each(j,function(k){Ext.getCmp(k).setContext(h)})};Zenoss.util.each=function(k,j,h){if(Ext.isFunction(k.each)){k.each(j,h)}else{Ext.each(k,j,h)}};Zenoss.util.filter=function(j,l,k){var h=[];Zenoss.util.each(j,function(n){var m=l.call(k||this,n);if(m){h.push(n)}});return h};Zenoss.util.applyNotIf=function(l,j){var h;if(l){for(h in j){if(h in l){l[h]=j[h]}}}return l};Zenoss.util.callWhenReady=function(h,l,j){var k=Ext.getCmp(h);if(Ext.isDefined(k)){if(j){Ext.bind(l,j)()}else{l()}}else{Ext.ComponentMgr.onAvailable(h,l,j)}};Zenoss.util.getExtControlType=function(h,l){var j={eventClass:"EventClass",severity:"Severity",dsnames:"DataPointItemSelector"},k={"int":"numberfield",string:"textfield","boolean":"checkbox",text:"textarea"};if(Ext.ComponentMgr.isRegistered(h)){return h}if(j[h]){return j[h]}return(k[l]||"textfield")};Ext.define("Zenoss.DateRange",{extend:"Ext.form.field.Date",alias:["widget.DateRange"],xtype:"daterange",getErrors:function(h){var j=new Array();if(h==""){return j}if(/[^0-9TO :-]/.test(h)){j.push("Date contains invalid characters - valid characters include digits, dashes, colons, and spaces");return j}if(h.indexOf("TO")===-1){if(!Zenoss.date.regex.ISO8601Long.test(h)){j.push("Date is formatted incorrectly - format should be "+Zenoss.date.ISO8601Long);return j}}else{if(!Zenoss.date.regex.ISO8601LongRange.test(h)){j.push("Date range is formatted incorrectly - format should be "+Zenoss.date.ISO8601LongRange.replace(/\\/g,""));return j}}return j},getValue:function(){var h=this.getRawValue();if(!h){return""}var k=(h.indexOf("TO")===-1)?false:true;if(k){var j=h.replace(" TO ","/");return j.replace(" ","T")}else{return h.replace(" ","T")}},parseDate:function(j){var h=Ext.form.field.Date.prototype.parseDate.call(this,j);Ext.iterate(Zenoss.date.regex,function(k,l){if(l.test(j)){h=j;return false}});return h}});Zenoss.util.validateConfig=function(){var h=arguments[0];Ext.each(arguments,function(k){if(Ext.isString(k)&&!Ext.isDefined(h[k])){var j=Ext.String.format("Did not receive expected config options: {0}",k);if(Ext.global.console){console.error(j)}}})};Zenoss.ThrottlingProxy=Ext.extend(Ext.data.DirectProxy,{constructor:function(h){Zenoss.ThrottlingProxy.superclass.constructor.apply(this,arguments);this.loading=false;this.addListener("beforeload",function(k,j){if(!k.loading){k.loading=true;return true}return false});this.addListener("load",function(k,j){k.loading=false});this.addListener("exception",function(k,j){k.loading=false})}});Ext.namespace("Zenoss.date");Ext.apply(Zenoss.date,{ISO8601Long:"Y-m-d H:i:s",ISO8601Short:"Y-m-d",ShortDate:"n/j/Y",LongDate:"l, F d, Y",FullDateTime:"l, F d, Y g:i:s A",MonthDay:"F d",ShortTime:"g:i A",LongTime:"g:i:s A",SortableDateTime:"Y-m-d\\TH:i:s",UniversalSortableDateTime:"Y-m-d H:i:sO",YearMonth:"F, Y",ISO8601LongRange:"Y-m-d H:i:s \\T\\O Y-m-d H:i:s",LongRangeAndDefault:Ext.form.field.Date.prototype.altFormats+"|"+Zenoss.date.ISO8601LongRange,regex:{ISO8601LongRange:/^(19|20)\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]) TO (19|20)\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,ISO8601Long:/^(19|20)\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/}});Ext.override(Ext.Shadow,{realign:Ext.Function.createInterceptor(Ext.Shadow.prototype.realign,function(m,n,k,o){if(Ext.isIE){var j=this.adjusts;j.h=Math.max(j.h,0)}})});var a=Ext.form.Checkbox.prototype.setValue;Ext.override(Ext.form.Checkbox,{setValue:function(j){var h=a.call(this,j);this.fireEvent("valid",this);return h}});String.prototype.startswith=function(h){return(this.match("^"+h)==h)};String.prototype.endswith=function(h){return(this.match(h+"$")==h)};var g=[["year",60*60*24*365],["month",60*60*24*30],["week",60*60*24*7],["day",60*60*24],["hour",60*60],["minute",60],["second",1]];Date.prototype.readable=function(m){var o=(new Date().getTime()-this.getTime())/1000,k=Math.abs(o),q=[];for(i=0;i<g.length;i++){var p=g[i],j=p[0],n=p[1],l=Math.floor(k/n);k=k-l*n;if(l){q.push(l+" "+j+(l>1?"s":""))}if(q.length==m){break}}var h=q.join(" ");return o>=0?h+" ago":"in "+h};var d;if(!d){d=function(q,n,m){if(Object.prototype.toString.call(n)!=="[object RegExp]"){return d._nativeSplit.call(q,n,m)}var k=[],h=0,l=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":""),n=RegExp(n.source,l+"g"),j,o,p,r;q=q+"";if(!d._compliantExecNpcg){j=RegExp("^"+n.source+"$(?!\\s)",l)}if(m===undefined||+m<0){m=Infinity}else{m=Math.floor(+m);if(!m){return[]}}while(o=n.exec(q)){p=o.index+o[0].length;if(p>h){k.push(q.slice(h,o.index));if(!d._compliantExecNpcg&&o.length>1){o[0].replace(j,function(){for(var s=1;s<arguments.length-2;s++){if(arguments[s]===undefined){o[s]=undefined}}})}if(o.length>1&&o.index<q.length){Array.prototype.push.apply(k,o.slice(1))}r=o[0].length;h=p;if(k.length>=m){break}}if(n.lastIndex===o.index){n.lastIndex++}}if(h===q.length){if(r||!n.test("")){k.push("")}}else{k.push(q.slice(h))}return k.length>m?k.slice(0,m):k};d._compliantExecNpcg=/()??/.exec("")[1]===undefined;d._nativeSplit=String.prototype.split}String.prototype.xsplit=function(j,h){return d(this,j,h)};Ext.ns("Zenoss.settings");Zenoss.settings.deviceMoveIsAsync=function(k){switch(Zenoss.settings.deviceMoveJobThreshold){case 0:return true;case -1:return false;default:var j,h=Zenoss.settings.deviceMoveJobThreshold||5;if(k==null){j=0}else{if(!Ext.isArray(k)){j=1}else{j=k.length}}return h<=j}}})();(function(){Ext.define("Zenoss.Store",{extend:"Ext.data.Store",firstLoad:true,constructor:function(a){this.callParent([a]);this.addEvents("afterguaranteedrange")},setBaseParam:function(a,b){this.proxy.extraParams[a]=b},setParamsParam:function(a,b){if(!this.proxy.extraParams.params){this.proxy.extraParams.params={}}this.proxy.extraParams.params[a]=b},onGuaranteedRange:function(b,d,a,c){this.callParent(arguments);this.fireEvent("afterguaranteedrange",this)}});Ext.define("Zenoss.DirectStore",{extend:"Zenoss.Store",alias:"store.zendirectstore",constructor:function(a){a=a||{};Ext.applyIf(a,{remoteSort:true,pageSize:a.pageSize||50,buffered:true,sorters:[{property:a.initialSortColumn,direction:a.initialSortDirection||"ASC"}],proxy:{type:"direct",simpleSortMode:true,directFn:a.directFn,extraParams:a.baseParams||{},reader:{root:a.root||"data",totalProperty:a.totalProperty||"totalCount"}}});this.callParent(arguments)}});Ext.define("Zenoss.NonPaginatedStore",{extend:"Zenoss.Store",alias:["store.directcombo"],constructor:function(a){a=a||{};Ext.applyIf(a,{remoteSort:false,buffered:false,proxy:{type:"direct",limitParam:undefined,startParam:undefined,pageParam:undefined,sortParam:undefined,extraParams:a.baseParams||{},directFn:a.directFn,reader:{type:"json",root:a.root||"data"}}});this.callParent(arguments)},setContext:function(a){if(this.proxy.extraParams){this.proxy.extraParams.uid=a}this.load()}});Ext.define("Ext.ux.grid.FilterRow",{extend:"Ext.util.Observable",init:function(a){this.grid=a;a.headerCt.on("columnresize",this.resizeFilterField,this);a.headerCt.on("columnshow",this.resetFilterRow,this);a.headerCt.on("columnhide",this.resetFilterRow,this);a.headerCt.on("columnmove",this.resetFilterRow,this);a.on("columnmove",function(c,d,b){this.gridColumnMoveWithFilter(c,d,b)},this);this.view=this.grid.getView();this.view.on("bodyscroll",this.onViewScroll,this)},onViewScroll:function(c){if(c){var a=this.view.el.dom.scrollLeft,b=this.dockedFilter.el.dom.childNodes[0],d=b.scrollLeft;if(a!=d){b.scrollLeft=a}}},gridColumnMoveWithFilter:function(d,c,a){var b=this.grid;var e=this;var f=e.dockedFilter;if(f){e.eachColumn(function(g){if(Ext.isDefined(g.filterField)){g.filterField.destroy();delete g.filterField}});f.removeAll(true);Ext.each(b.getDockedItems(),function(g){if(g.id==b.id+"docked-filter"){b.removeDocked(g,true)}});e.applyTemplate();e.eachColumn(function(g){if(g.isVisible()&&g.getEl()){g.setWidth(g.getWidth()+1);g.setWidth(g.getWidth()-1);return false}})}},applyTemplate:function(){var a=[],b=this.defaultFilters;this.eachColumn(function(c){if(!c.filterKey){c.filterKey=c.id;if(!c.filterKey||c.filterKey.startswith("gridcolumn")){c.filterKey=c.dataIndex}}var d=this.getFilterDivId(c.filterKey);if(!c.filterField){if(Ext.isDefined(c.filter)&&c.filter===false){c.filter={};c.filter.xtype="hidden"}if(c.nofilter||c.isCheckerHd!=undefined){c.filter={}}else{if(!c.filter){c.filter={};c.filter.xtype="textfield"}}c.filter=Ext.apply({id:d,hidden:c.isHidden(),xtype:"component",baseCls:"x-grid-filter",width:c.width-2,enableKeyEvents:true,style:{margin:"1px 1px 1px 1px"},hideLabel:true,value:this.defaultFilters[c.filterKey]},c.filter);c.filterField=Ext.ComponentManager.create(c.filter)}else{if(c.hidden!=c.filterField.hidden){c.filterField.setVisible(!c.hidden)}}if(Zenoss.SELENIUM){c.filterField.on("afterrender",function(g){if(Ext.getCmp(g.id).inputEl){var f=Ext.getCmp(g.id).inputEl;f.dom.id=g.id+"-input"}},this)}if(Zenoss.settings.enableLiveSearch){c.filterField.on("change",this.onChange,this)}c.filterField.on("keydown",this.onKeyDown,this);c.filterField.on("validitychange",this.onInvalidFilter,this);a.push(c.filterField)});if(!Ext.isEmpty(this.defaultFilters)){if(!this.grid.store.proxy.extraParams){this.grid.store.proxy.extraParams={}}Ext.applyIf(this.grid.store.proxy.extraParams.params,this.getSearchValues())}if(a.length>0){this.grid.addDocked(this.dockedFilter=Ext.create("Ext.container.Container",{id:this.grid.id+"docked-filter",weight:100,dock:"top",border:false,baseCls:Ext.baseCSSPrefix+"grid-header-ct",items:a,layout:{type:"hbox"}}))}this.grid.on("afterrender",function(){this.storeSearch()},this,{single:true})},clearFilters:function(){var a=this;this.eachColumn(function(b){if(Ext.isDefined(b.filterField)){if(b.filterField.isXType("multiselectmenu")){var c=false;b.filterField.menu.items.each(function(d){if(d.checked!=d.initialConfig.checked){d.setChecked(d.initialConfig.checked);c=true}});if(c==true){this.onChange()}}else{b.filterField.reset()}}})},getState:function(){return this.getSearchValues()},applyState:function(a){if(Ext.isEmpty(a)){return}if(!this.dockedFilter){this.applyTemplate()}this.eachColumn(function(b){b.filterField.setVisible(!b.isHidden());if(!b.isHidden()&&Ext.isDefined(a[b.filterKey])&&!Ext.isEmpty(a[b.filterKey])){b.filterField.setValue(a[b.filterKey])}})},onChange:function(c,b,a){if(!this.onChangeTask){this.onChangeTask=new Ext.util.DelayedTask(function(){this.storeSearch()},this)}this.onChangeTask.delay(1000)},onKeyDown:function(b,a){if(a.getKey()==a.ENTER){this.onChange()}},isValid:function(){var a=true;this.eachColumn(function(b){if(b.filterField.isValid){a=a&&b.filterField.isValid()}},this);return a},onInvalidFilter:function(c,b){if(!b){var a=c.activeError;if(a){Zenoss.message.error(a)}}},getSearchValues:function(){var a={},b=(this.appendGlob&&(Ext.isDefined(b)?b:true));this.eachColumn(function(c){var e=c.filterField,d=["*",'"',"?"],f;if(e&&e.xtype!="component"){if(!Ext.isEmpty(e.getValue())){f=e.getValue();if(b&&e.xtype=="textfield"&&e.vtype!="numcmp"&&e.vtype!="numrange"&&e.vtype!="floatrange"&&Ext.Array.indexOf(d,f.charAt(f.length-1))===-1){f+="*"}a[c.filterKey]=f}}});a=Ext.applyIf(a,this.defaultFilters);return a},storeSearch:function(){if(!this.isValid()){return}var a=this.getSearchValues();if(!this.grid.store.proxy.extraParams){this.grid.store.proxy.extraParams={}}this.grid.store.proxy.extraParams.params=a;this.grid.scrollToTop();if(Ext.isDefined(this.grid.getContext())||this.grid.getStore().autoLoad){this.grid.getStore().load({callback:function(){this.grid.fireEvent("filterschanged",this.grid,a)},scope:this})}this.grid.saveState()},resetFilterRow:function(){this.eachColumn(function(a){if(!a.filterField){return}a.filterField.setVisible(!a.isHidden())});if(!this.dockedFilter){this.applyTemplate()}},resizeFilterField:function(d,b,c){var a;if(!b.filterField){this.resetFilterRow();a=this.grid.headerCt.items.findBy(function(e){return e.dataIndex==b.dataIndex}).filterField}else{a=b.filterField}if(a){a.setWidth(c-2)}},scrollFilterField:function(c,b){var a=this.grid.headerCt.el.dom.firstChild.style.width;this.dockedFilter.el.dom.firstChild.style.width=a;this.dockedFilter.el.dom.scrollLeft=b.scrollLeft},getFilterDivId:function(a){return this.grid.id+"-filter-"+a},eachFilterColumn:function(a){this.eachColumn(function(b,c){if(b.filterField){a.call(this,b,c)}})},setFilter:function(a,b){this.eachColumn(function(c){if(c.filterKey==a){c.filterField.setValue(b)}})},eachColumn:function(a){Ext.each(this.grid.columns,a,this)}});Ext.define("Zenoss.ContextGridPanel",{extend:"Ext.grid.Panel",alias:["widget.contextgridpanel"],selectedNodes:[],constructor:function(a){var b=a.viewConfig||{};Zenoss.util.validateConfig(a,"store","columns");b=a.viewConfig||{};Ext.applyIf(b,{autoScroll:false,stripeRows:true,loadMask:true,preserveScrollOnRefresh:true});Ext.applyIf(a,{scroll:"both",viewConfig:b});this.callParent([a]);this.getStore().on("afterguaranteedrange",function(){if(!this._disableSavedSelection){this.applySavedSelection()}},this);this.getStore().on("beforeprefetch",function(d,c){if(!c){return true}this.start=c.start;this.limit=c.limit;if(!Ext.isDefined(c.params)){c.params={}}if(this.uid){c.params.uid=this.uid}this.applyOptions(c);return true},this);this.addEvents("contextchange")},saveSelection:function(){this.selectedNodes=this.getSelectionModel().getSelection()},disableSavedSelection:function(a){this._disableSavedSelection=a},applySavedSelection:function(){var c=this.getStore(),b=this.getSelectionModel(),d,e,f,a=[];for(d=0;d<this.selectedNodes.length;d++){e=this.selectedNodes[d];f=c.findRecord(e.idProperty,e.get(e.idProperty));if(f){a.push(f)}}if(a.length>0){this.suspendEvents();this.getSelectionModel().select(a,false,true);this.resumeEvents();b.fireEvent("selectionchange",b,b.getSelection());this.selectedNodes=[]}},clearSavedSelections:function(){this.selectedNodes=[]},applyOptions:function(a){},setStoreParameter:function(b,c){var a=this.getStore();if(!a.proxy.extraParams){a.proxy.extraParams={}}a.proxy.extraParams[b]=c},setContext:function(b){var a=this.getStore();this.uid=b;this.setStoreParameter("uid",b);this.fireEvent("contextchange",this,b);if(a.buffered&&a.firstLoad){a.guaranteeRange(0,a.pageSize-1);a.firstLoad=false}else{this.getStore().load()}},getContext:function(){return this.uid},refresh:function(){if(!this.getContext()){return}this.saveSelection();this.getStore().load()}});Ext.define("Zenoss.BaseGridPanel",{extend:"Zenoss.ContextGridPanel",alias:["widget.basegridpanel"],constructor:function(a){Ext.applyIf(a,{verticalScrollerType:"paginggridscroller",invalidateScrollerOnRefresh:false,scroll:"both",verticalScroller:{numFromEdge:a.store.pageSize<=25?5:Math.pow(a.store.pageSize,0.7),scrollToLoadBuffer:100},bbar:{cls:"commonlivegridinfopanel",items:["->",{xtype:"livegridinfopanel",grid:this}]}});this.callParent([a])},initComponent:function(){this.callParent(arguments);this.headerCt.on("columnhide",this.onColumnChange,this);this.headerCt.on("columnshow",this.onColumnChange,this)},onColumnChange:function(){if(!this.onColumnChangeTask){this.onColumnChangeTask=new Ext.util.DelayedTask(function(){this.refresh()},this)}this.onColumnChangeTask.delay(1000)},setContext:function(a){this.scrollToTop();if(this.getStore().pageMap){this.getStore().pageMap.clear()}this.callParent([a])},refresh:function(g,c){if(!this.getContext()){return}this.saveSelection();var b=this.getStore(),d=!b.buffered||b.getCount()>=b.getTotalCount();if(d){b.load({callback:g,scope:c||this})}else{var f=Math.max(b.lastRequestStart,0),a=Math.min(f+b.pageSize-1,b.totalCount),e=b.pageMap.getPageFromRecordIndex(a);b.pageMap.removeAtKey(e);if(Ext.isFunction(g)){b.guaranteeRange(f,a,g,c)}else{b.guaranteeRange(f,a)}}},scrollToTop:function(){var a=this.getView();if(a.getEl()){a.getEl().dom.scrollTop=0}}});Ext.define("Zenoss.FilterGridPanel",{extend:"Zenoss.BaseGridPanel",alias:["widget.filtergridpanel"],constructor:function(a){a=a||{};Ext.applyIf(a,{displayFilters:true,stateful:Ext.isDefined(a.id),stateId:a.id});this.callParent(arguments)},initComponent:function(){this.addEvents("filterschanged");this.callParent();var a=Ext.create("Ext.ux.grid.FilterRow",{grid:this,appendGlob:this.appendGlob,defaultFilters:this.defaultFilters||{}});if(this.displayFilters){a.init(this)}this.filterRow=a},getState:function(){var a=this.callParent();a.filters=this.filterRow.getState();return a},applyState:function(a){this.callParent([a]);if(this.displayFilters){this.filterRow.applyState(a.filters)}},getFilters:function(){return this.filterRow.getSearchValues()},setFilter:function(a,b){this.filterRow.setFilter(a,b)},afterRender:function(){this.callParent();this.applyState(this.getState())}});Ext.define("Zenoss.LiveGridInfoPanel",{extend:"Ext.toolbar.TextItem",alias:["widget.livegridinfopanel"],cls:"livegridinfopanel",initComponent:function(){this.setText(this.emptyMsg);if(this.grid){if(!Ext.isObject(this.grid)){this.grid=Ext.getCmp(this.grid)}this.view=this.grid.getView();this.grid.getStore().on("datachanged",this.onDataChanged,this);this.grid.getStore().on("guaranteedrange",this.onDataChanged,this);this.view.on("bodyscroll",this.onScroll,this);this.view.on("resize",this.onResize,this)}this.scrollLeft=0;this.rowHeight=null;this.visibleRows=null;this.displayMsg=_t("DISPLAYING {0} - {1} of {2} ROWS");this.emptyMsg=_t("NO RESULTS");this.callParent(arguments)},onResize:function(){this.visibleRows=null;this.onScroll()},getNumberOfVisibleRows:function(){if(this.visibleRows){return this.visibleRows}var d,c;d=this.view.el.getHeight();var b=this.view.getNode(0),a=Ext.fly(b);if(a){this.rowHeight=a.getHeight()}if(this.rowHeight&&d){this.visibleRows=Math.floor(d/this.rowHeight);return this.visibleRows}return 0},getEndCount:function(b){var a=this.getNumberOfVisibleRows();if(a){return b+a+1}return 0},getStartCount:function(){var a=this.view.el.dom.scrollTop;if(this.rowHeight&&a){return Math.ceil(a/this.rowHeight)}if(this.grid.verticalScroller){var b=this.grid.verticalScroller.getFirstVisibleRowIndex();if(b){return b}}return 0},onDataChanged:function(){var a=this.grid.getStore().getTotalCount();this.totalCount=a;if(a&&a>0){this.onScroll()}else{this.setText(this.emptyMsg)}},onScroll:function(b,a){if(!this.onScrollTask){this.onScrollTask=new Ext.util.DelayedTask(this._doOnScroll,this)}this.onScrollTask.delay(250)},_doOnScroll:function(){var c=this.grid.verticalScroller;if(!this.totalCount){return this.setText(this.emptyMsg)}if(c){var f=Math.max(this.getStartCount(),0),b=Math.min(this.getEndCount(f),this.totalCount),e=this.view.el.dom.scrollLeft,d;d=Ext.String.format(this.displayMsg,f+1,b,this.totalCount);if(this.scrollLeft!=e){this.scrollLeft=e}else{this.setText(d);this.view.el.dom.scrollLeft-=1}}else{var a=_t("Found {0} records");var d=Ext.String.format(a,this.totalCount);this.setText(d)}}})}());(function(){Ext.ns("Zenoss.Security");var b=_global_permissions(),a=[];Zenoss.Security.hasPermission=function(c){return b[c.toLowerCase()]};Zenoss.Security.hasGlobalPermission=function(c){return _global_permissions()[c.toLowerCase()]};Zenoss.Security.doesNotHavePermission=function(c){return(!this.hasPermission(c))};Zenoss.Security.onPermissionsChange=function(d,c){if(c){a.push(Ext.bind(d,c))}else{a.push(d)}};Zenoss.Security.setContext=function(c){var d={uid:c};function e(f){var g;if(f.success){b=f.data;if(a){for(g=0;g<a.length;g+=1){a[g]()}}}}Zenoss.remote.DetailNavRouter.getSecurityPermissions(d,e)}}());(function(){Ext.ns("Zenoss.Action");Ext.define("Zenoss.PermissionableAction",{externallyDisabled:false,permitted:false,filtered:false,updateDisabled:function(){this.setDisabled(this.checkDisabled())},checkDisabled:function(){if(this.externallyDisabled){return true}if(!this.permitted&&!this.filtered){return true}return false},checkPermitted:function(){if(this.permission){if(this.permissionContext){if(Zenoss.env.PARENT_CONTEXT==this.permissionContext){return Zenoss.Security.hasPermission(this.permission)}else{return Zenoss.Security.hasGlobalPermission(this.permission)}}else{return !Zenoss.Security.doesNotHavePermission(this.permission)}}else{return true}},setPermission:function(b){var d=this;var c=function(){d.permitted=d.checkPermitted();d.updateDisabled()};if(b.permission){this.permission=b.permission;if(b.permissionContext){this.permissionContext=b.permissionContext;Zenoss.Security.onPermissionsChange(c)}else{Zenoss.Security.onPermissionsChange(c,this)}}this.permitted=this.checkPermitted()}});function a(b){this.externallyDisabled=b;this.callParent([this.checkDisabled()])}Ext.define("Zenoss.Action",{extend:"Ext.menu.Item",alias:["widget.Action"],mixins:{permissions:"Zenoss.PermissionableAction"},constructor:function(b){this.setPermission(b);this.filtered=b.filtered;b.disabled=this.checkDisabled();this.callParent([b])},setDisabled:a});Ext.define("Zenoss.ActionButton",{extend:"Ext.button.Button",alias:["widget.buttonaction"],mixins:{permissions:"Zenoss.PermissionableAction"},constructor:function(b){this.setPermission(b);this.filtered=b.filtered;b.disabled=this.checkDisabled();this.callParent([b])},setDisabled:a})}());(function(){var b={IpAddress:["^/zport/dmd/.*/ipaddresses/[^/]*/?$"],IpInterface:["^/zport/dmd/Devices/.*/devices/.*/os/interfaces/.*"],Device:["^/zport/dmd/.*/devices/[^/]*/?$"],DeviceLocation:["^/zport/dmd/Locations/"],DeviceSystem:["^/zport/dmd/Systems/"],DeviceGroup:["^/zport/dmd/Groups/"],DeviceClass:["^/zport/dmd/Devices(/(?!devices)[^/]+)*/?$"],EventClass:["^/zport/dmd/Events(/[A-Za-z][^/]*)*/?$"],Network:["^/zport/dmd/Networks(/(?!ipaddresses)[^/]+)*/?$"],Process:["^/zport/dmd/Processes(.*)$"]};var a=Ext.ns("Zenoss.types");Ext.apply(a,{TYPES:{},getAllTypes:function(){var c=[];for(var d in a.TYPES){if(true){c.push(d)}}return c},type:function(c){var e;for(var d in a.TYPES){if(a.TYPES[d]){e=true;Ext.each(a.TYPES[d],function(f){if(!e){return}e=f.test(c)});if(e){return d}}}return null},register:function(d){function f(g,j){var h=a.TYPES[g]=a.TYPES[g]||[];if(!(j instanceof RegExp)){j=new RegExp(j)}if(!(j in h)){h.push(j)}}for(var c in d){var e=d[c];if(Ext.isString(e)){f(c,e)}else{if(Ext.isArray(e)){Ext.each(e,function(g){f(c,g)})}}}}});a.register(b)})();(function(){Ext.ns("Zenoss.render");var d=new Ext.Template('<td class="severity-icon-small {severity} {cssclass}" title="{acked} out of {total} acknowledged">{total}</td>');d.compile();var a=new Ext.Template('<table class="eventrainbow eventrainbow_cols_{count}"><tr>{cells}</tr></table>');a.compile();var c=new Ext.Template('<span class="status-{0}{2}">{1}</span>');c.compile();var b=new Ext.Template('<span title="Administrative / Operational">{adminStatus} / {operStatus}</span>');b.compile();function e(k,n,m,j){m=m||"B";j=j||2;n=n||1024;var h=[];Ext.each(["","K","M","G","T","P"],function(o){h.push(o+m)});var g=1;if(k<0){k=Math.abs(k);g=-1}var l;for(l=0;l<h.length;l++){if(k<n){break}k=k/n}return(k*g).toFixed(j)+h[l]}function f(g){if(g==null||!Ext.isDefined(g)){return"Unknown"}if(Ext.isString(g)){if(g.toLowerCase()=="none"){return"Unknown"}else{g=g.toLowerCase()=="up"}}var h=g?"Up":"Down";return h}Ext.apply(Zenoss.render,{bytesString:function(g){return g===0?"0":e(g,1024,"B")},memory:function(g){return(g===0)?"0":e(g,1024,"B",2)},cpu_speed:function(g){if(g){var h=parseFloat(g);if(isNaN(h)){return g}else{return e(h,1000,"Hz",2)}}else{return g}},checkbox:function(g){if(g){return'<input type="checkbox" checked="true" disabled="true">'}else{return'<input type="checkbox" disabled="true">'}},pingStatus:function(g){var h=f(g);return c.apply([h.toLowerCase(),h])},pingStatusLarge:function(g){var h=f(g);return c.apply([h.toLowerCase(),h,"-large"])},upDownUnknown:function(g,h){return c.apply([g.toLowerCase(),h])},upDownUnknownLarge:function(g,h){return c.apply([g.toLowerCase(),h,"-large"])},ipInterfaceStatus:function(g){return b.apply(g)},ipAddress:function(g){if(Ext.isObject(g)){g=g.name}if(!g||g=="0.0.0.0"){return""}return Ext.isString(g)?g:Zenoss.util.num2dot(g)},severity:function(g){return'<div class="severity-icon-small '+Zenoss.util.convertSeverity(g)+'"></div>'},availability:function(g){return Ext.util.Format.number(g*100,"0.000%")},evstatus:function(g){if(!g){return""}return'<div class="status-icon-small-'+g.toLowerCase()+'"></div>'},events:function(m,l){var g="",n=["critical","error","warning","info","debug","clear"],k="",j,h;l=l||3;Ext.each(n.slice(0,l),function(o){j=m[o].count;h=m[o].acknowledged_count;k=(j===0)?"no-events":(j===h)?"acked-events":"";g+=d.apply({severity:o,total:j,acked:h,cssclass:k})});return a.apply({cells:g,count:l})},worstevents:function(l){var g="",m=["critical","error","warning","info","debug","clear"],k="",j,h;Ext.each(m,function(n){if(l[n]&&l[n].count&&!g){j=l[n].count;h=l[n].acknowledged_count;k=(j===h)?"acked-events":"";g=d.apply({severity:n,total:j,acked:h,cssclass:k})}});return a.apply({cells:g})},locking:function(h){var j=[];if(h.updates){j.push("updates")}if(h.deletion){j.push("deletion")}if(!Ext.isEmpty(j)){var g=_t("Locked from ")+j.join(_t(" and "));if(h.events){g+="<br/>"+_t("Send event when blocked")}else{g+="<br/>"+_t("Do not send event when blocked")}return g}else{return _t("Unlocked")}},locking_icons:function(j){var h=new Ext.Template('<img border="0" src="locked-{str}-icon.png"','style="vertical-align:middle"/>'),g="";h.compile();if(j.updates){g+=h.apply({str:"update"})}if(j.deletion){g+=h.apply({str:"delete"})}if(j.events){g+=h.apply({str:"sendevent"})}return g},link:function(j,h,g){if(!h){var m="default_uid_renderer",k=Zenoss.types.type(j)||m,l=Zenoss.render[k];if(l){return l(j,g)}}if(h&&g){return'<a class="z-entity" href="'+h+'">'+Ext.htmlEncode(g)+"</a>"}},default_uid_renderer:function(h,g){var j;if(!h){return h}if(Ext.isObject(h)){g=h.name;h=h.uid}if(!g){j=h.split("/");g=j[j.length-1]}return Zenoss.render.link(null,h,g)},linkFromGrid:function(k,h,g){var j;if(typeof(k=="object")){j=k;if(j==null){return k}else{if(j.url!=null){return Zenoss.render.link(null,j.url,j.text)}else{if(j.uid){return Zenoss.render.link(j.uid,null,j.text)}}}return Ext.htmlEncode(j.text)}return Ext.htmlEncode(k)},LinkFromGridGuidGroup:function(k,j,g){if(!k){return k}var h,l=[];Ext.each(k,function(m){h="/zport/dmd/goto?guid="+m.uuid;l.push(Zenoss.render.link(null,h,m.name))});return l.join(" | ")},LinkFromGridUidGroup:function(k,j,g){if(!k){return k}var h,l=[];Ext.each(k,function(m){l.push(Zenoss.render.default_uid_renderer(m.uid,m.name))});return l.join(" | ")},Device:function(h,g){return Zenoss.render.link(null,h+"/devicedetail#deviceDetailNav:device_overview",g)},DeviceClass:function(j,h){var k=j.replace(/^\/zport\/dmd\/Devices/,"");k=k.replace(/\/devices\/.*$/,"");var g="/zport/dmd/itinfrastructure#devices:.zport.dmd.Devices"+k.replace(/\//g,".");if(!Ext.isString(h)){h=k}return Zenoss.render.link(null,g,h)},DeviceLocation:function(j,h){var k=j.replace(/^\/zport\/dmd\/Locations/,"");k=k.replace(/\/devices\/.*$/,"");var g="/zport/dmd/itinfrastructure#locs:.zport.dmd.Locations"+k.replace(/\//g,".");if(!Ext.isString(h)){h=k}return Zenoss.render.link(null,g,h)},DeviceGroup:function(j,h){var k=j.replace(/^\/zport\/dmd\/Groups/,"");k=k.replace(/\/devices\/.*$/,"");var g="/zport/dmd/itinfrastructure#groups:.zport.dmd.Groups"+k.replace(/\//g,".");if(!Ext.isString(h)){h=k}return Zenoss.render.link(null,g,h)},DeviceSystem:function(j,h){var k=j.replace(/^\/zport\/dmd\/Systems/,"");k=k.replace(/\/devices\/.*$/,"");var g="/zport/dmd/itinfrastructure#systems:.zport.dmd.Systems"+k.replace(/\//g,".");if(!Ext.isString(h)){h=k}return Zenoss.render.link(null,g,h)},DeviceComponent:function(j,h,g){var k=g.data[h.id];if(k.uid){return Zenoss.render.default_uid_renderer(k.uid,k.text)}return k.text},EventClass:function(h,g){return Zenoss.render.default_uid_renderer(h,g)},IpServiceClass:function(m,l,g,n,j,h){var k=g.data.serviceClassUid.replace(/\//g,".");return Zenoss.render.serviceClass("ipservice",k,m)},WinServiceClass:function(m,l,g,n,j,h){var k=g.data.serviceClassUid.replace(/\//g,".");return Zenoss.render.serviceClass("winservice",k,m)},serviceClass:function(k,j,h){var g=Ext.String.format("/zport/dmd/{0}#navTree:{1}",k,j);return Zenoss.render.link(null,g,h)},nextHop:function(m,k,g,n,j,h){var l="";if(m&&m.uid&&m.id){l+=Zenoss.render.IpAddress(m.uid,m.id);if(m.device&&m.device.uid&&m.device.id){l+=" (";l+=Zenoss.render.Device(m.device.uid,m.device.id);l+=")"}}return l},IpInterface:function(j,h){var k=j.split("/os/interfaces/")[0];var g=k+"/devicedetail#deviceDetailNav:IpInterface:"+j;return Zenoss.render.link(null,g,h)},IpAddress:function(h,g){return Zenoss.render.Network(h,g)},Network:function(j,h){var g="/zport/dmd/networks#networks:"+j.replace(/\//g,".");if(!h){var k=j.split("/");h=k[k.length-1]}return Zenoss.render.link(null,g,h)},Process:function(j,h){var g="/zport/dmd/process#processTree:"+j.replace(/\//g,".");if(!h){var k=j.split("/");h=k[k.length-1]}return Zenoss.render.link(null,g,h)},eventSummaryRow:function(l,j,g,n,k,h){var m=g.data.message;if(!m||m=="None"){m=g.data.summary}m=Ext.htmlEncode(m);m="<pre style='white-space:normal;'>"+m+"</pre>";m=m.replace(/\"/g,"&quot;");j.attr='ext:qtip="'+m+'" ext:qwidth="500"';l=Ext.htmlEncode(l);return l}})})();(function(){Ext.ns("Zenoss");Ext.define("Zenoss.FlexButton",{extend:"Ext.button.Button",alias:["widget.FlexButton"],constructor:function(b){if(b.menu&&b.menu.items&&b.menu.items.length==1){b.originalMenu=Ext.apply({},b.menu);var a=b.menu.items[0];Ext.apply(b,{listeners:a.listeners});Ext.destroyMembers(b,"menu")}Zenoss.FlexButton.superclass.constructor.call(this,b)},add:function(c){if(!this.menu){var b={};if(this.initialConfig.originalMenu){Ext.apply(b,this.initialConfig.originalMenu)}else{b.items=[{text:this.getText()?this.getText():this.tooltip,listeners:this.initialConfig.listeners}]}this.split=true;var a=this.initialConfig.listeners.click;this.un("click",a);this.on("render",function(){this.events.click.clearListeners()});this.clearTip();this.menu=Ext.menu.MenuMgr.get(b);this.up("panel").doLayout()}return this.menu.add(c)}})})();(function(){Ext.ns("Zenoss","Zenoss.i18n");Zenoss.i18n._data=Zenoss.i18n._data||{};Zenoss.i18n.translate=function(b,c){var a=Zenoss.i18n._data[b];return a?a:(c?c:b)};window._t=Zenoss.i18n.translate})();(function(){Zenoss.TIPS={};Zenoss.ToolTip=Ext.extend(Ext.ToolTip,{constructor:function(a){Zenoss.ToolTip.superclass.constructor.call(this,a);this.on("render",this.attachHoverEvents,this)},attachHoverEvents:function(){var a=this.getEl();a.on("mouseenter",this.onMouseEnter,this);a.on("mouseleave",this.onTargetOut,this)},onMouseEnter:function(a){this.clearTimer("hide")}});Zenoss.registerTooltip=function(a){var b,f=a.target,e=Ext.apply({},a),c=Ext.getCmp(f);if(typeof(c)!="undefined"){c.on("destroy",function(){Zenoss.TIPS[f]=e});if(c.btnEl){a.target=c.btnEl}}else{Ext.ComponentMgr.onAvailable(f,function(g){g.tooltip=a})}if((b=Ext.get(f))){var d=new Zenoss.ToolTip(a);Zenoss.TIPS[f]=d}else{Zenoss.TIPS[f]=e}};Zenoss.registerTooltipFor=function(b){var a;if(Ext.isDefined(a=Zenoss.TIPS[b])){if(!(a instanceof Ext.ToolTip)){Zenoss.registerTooltip(a)}}}})();(function(){Ext.ns("Zenoss.VTypes");var g=new RegExp("^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$");var h=new RegExp("^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(/[0-9]+)$");var j=new RegExp("^#?([a-f]|[A-F]|[0-9]){3}(([a-f]|[A-F]|[0-9]){3,5})?$");var c=new RegExp("^(>=|<=|>|<|=)?s*([0-9]+)$");var b=new RegExp("^(-?[0-9]+)?:?(-?[0-9]+)?$");var f=new RegExp("^([^:]*):?([^:]*)$");var d=new RegExp(/[a-z_\s\d]/i);var a=new RegExp(/[a-zA-Z0-9-_.\(\)\/:]/);var e={numcmp:function(l,k){return c.test(l)},numcmpText:_t("Enter a valid comparison (ex: 4, <2, >=1)"),numrange:function(m,l){var k,o,n;k=b.exec(m);if(!k){return false}o=k[1];n=k[2];if(o&&n){return parseInt(o)<=parseInt(n)}return true},numrangeText:_t("Enter a valid numeric range (ex: 2, 5:, 6:8, :9)"),floatrange:function(m,l){var k,o,n;k=f.exec(m);if(!k){return false}o=k[1];n=k[2];if(o&&n){o=parseFloat(o);n=parseFloat(n);return !isNaN(o)&&!isNaN(n)&&o<=n}if(o){return !isNaN(parseFloat(o))}if(n){return !isNaN(parseFloat(n))}return true},floatrangeText:_t("Enter a valid floating point range (ex: 1, 2.5:5.5, 2.5:, :9.5"),positive:function(l,k){return(l>=0)},positiveText:_t("Must be greater than or equal to 0"),betweenzeroandone:function(l,k){return(l>=0&&l<=1)},betweenzeroandoneText:_t("Must be between 0 and 1"),ipaddress:function(l,k){return g.test(l)},ipaddressText:_t("Invalid IP address"),ipaddresswithnetmask:function(l,k){return h.test(l)},ipaddresswithnetmaskText:_t("You must enter a valid IP address with netmask."),hexnumber:function(l,k){return j.test(l)},hexnumberText:_t("Must be a 6 or 8 digit hexadecimal value."),alphanumspace:function(l,k){return d.test(l)},alphanumspaceText:_t("Must be an alphanumeric value or a space "),alphanumspaceMask:d,hostnameorIP:function(l,k){return a.test(l)},hostnameorIPText:_t("Must be a valid hostname or IP address "),hostnameorIPMask:a};Ext.apply(Ext.form.VTypes,e)}());Ext.onReady(function(){var a=Ext.util.History;a.DELIMITER=":";a.selectByToken=function(b){if(b){var e=b.split(a.DELIMITER),d=Ext.getCmp(e[0]),c=e.slice(1).join(a.DELIMITER);if(d){d.selectByToken(c)}}};a.events=a.events||{};a.addListener("change",a.selectByToken)});(function(){Ext.define("Zenoss.DisplayField",{extend:"Ext.form.DisplayField",alias:["widget.displayfield"],constructor:function(a){Ext.applyIf(a,{fieldClass:"display-field"});Zenoss.DisplayField.superclass.constructor.call(this,a)},setRawValue:function(a){if(a&&Ext.isIE&&typeof a==="string"){a=a.replace(/\n/g,"<br/>")}Zenoss.DisplayField.superclass.setRawValue.call(this,a)}});Ext.define("Zenoss.EditorWithButtons",{extend:"Ext.Editor",alias:["widget.btneditor"],onRender:function(b,a){Zenoss.EditorWithButtons.superclass.onRender.apply(this,arguments);this.editorpanel=new Ext.Panel({frame:true,bodyStyle:Ext.isIE?"padding-bottom:5px":"",buttonAlign:"left",buttons:[{text:_t("Save"),handler:Ext.bind(this.completeEdit,this)},{text:_t("Cancel"),handler:Ext.bind(this.cancelEdit,this)}],items:this.field});if(Ext.isIE){this.el.setWidth(450)}this.editorpanel.render(this.el).show()},onBlur:function(){}});Ext.define("Zenoss.EditableField",{extend:"Zenoss.DisplayField",alias:["widget.editable"],constructor:function(a){a=Ext.applyIf(a||{},{cls:"editable-field",overCls:"editable-field-over",editEvent:"click"});a.editor=Ext.applyIf(a.editor||{},{xtype:"btneditor",updateEl:!Ext.isIE,ignoreNoChange:true,autoSize:"width",field:{xtype:"textfield",selectOnFocus:true}});Zenoss.EditableField.superclass.constructor.call(this,a);this.initEditor();this.on("render",function(){this.getEl().on(this.editEvent,this.startEdit,this)},this)},initEditor:function(){if(!(this.editor instanceof Ext.Editor)){this.editor=Ext.create(this.editor)}var a=this.editor;a.on("beforecomplete",this.onBeforeComplete,this);if(Ext.isIE){a.field.origSetValue=a.field.setValue;a.field.setValue=Ext.bind(function(b){b=b.replace(/\<BR\>/g,"\n");return this.origSetValue(b)},a.field)}},getForm:function(){var a=this.ownerCt;while(a&&!(a instanceof Ext.FormPanel)){a=a.ownerCt}return a},onBeforeComplete:function(b,d,a){var c=Ext.apply({},this.getForm().baseParams||{});c[this.name]=d;this.getForm().api.submit(c,function(e){if(e.success){this.setValue(e[this.name]||d)}else{this.setValue(a)}},this)},startEdit:function(b,a){if(!this.disabled){this.editor.startEdit(a)}}});Ext.define("Zenoss.EditableTextarea",{extend:"Zenoss.EditableField",alias:["widget.editabletextarea"],constructor:function(a){a.editor=a.editor||{};a.editor.field=Ext.applyIf(a.editor.field||{},{xtype:"textarea",grow:true});Zenoss.EditableTextarea.superclass.constructor.call(this,a)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.FieldRow",{alias:["widget.fieldrow"],extend:"Ext.Container",constructor:function(b){Ext.apply(b,{layout:"hbox",align:"top"});var a=b.items;b.items=[];Ext.each(a,function(d){var c={xtype:"container",autoHeight:true,minWidth:10,width:d.width,fieldDefaults:{labelAlign:d.labelAlign||"top"},layout:"anchor",items:[d]};if(!d.width){c.flex=d.flex||1}b.items.push(c)});Zenoss.form.FieldRow.superclass.constructor.call(this,b)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.InheritField",{extend:"Zenoss.form.FieldRow",alias:["widget.inheritfield"],constructor:function(a){var b;if(Ext.isObject(a.items)){b=a.items}else{b=a.items[0]}this.inheritbox=new Ext.form.Checkbox({fieldLabel:_t("Inherit?"),width:60});a.items=[this.inheritbox,b];Zenoss.form.InheritField.superclass.constructor.call(this,a);this.field=this.items.items[1].items.items[0]},inherit:function(){return this.inheritbox.checked},getValue:function(){return{inherited:this.inherit(),value:this.field.getValue()}},setValue:function(a){if(Ext.isObject(a)){this.inheritbox.setValue(Ext.isDefined(a.inherited)?a.inherited:false);a=a.value}else{this.inheritbox.setValue(false)}this.field.setValue(a)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.Radio",{extend:"Ext.form.Radio",alias:["widget.zradio"],setBoxLabel:function(a){if(this.rendered){this.boxLabel=a;this.boxLabelEl.update(a)}else{this.boxLabel=a}}});Ext.define("Zenoss.form.ZPropHidden",{extend:"Ext.form.Hidden",alias:["widget.zprophidden"],getValue:function(){return{isAcquired:this.zpropFieldSet.acquiredRadio.getValue(),localValue:this.zpropFieldSet.localField.getValue(),acquiredValue:this.zpropFieldSet.acquiredValue,ancestor:this.zpropFieldSet.ancestor}},getRawValue:function(){return this.getValue()},setValue:function(a){this.zpropFieldSet.setValues(a)},isDirty:function(){return this.zpropFieldSet.acquiredRadio.isDirty()||this.zpropFieldSet.localField.isDirty()}});Ext.define("Zenoss.form.ZProperty",{extend:"Ext.form.FieldSet",alias:["widget.zprop"],constructor:function(a){Ext.applyIf(a,{hideLabels:true,hideBorders:true,border:false,defaults:{border:false},items:[this.getLocalRadioConfig(a.localField),this.getAcquiredRadioConfig(),this.getHiddenFieldConfig(a.name)]});Zenoss.form.ZProperty.superclass.constructor.call(this,a)},setValues:function(b){if(!b){return}var a=this.refOwner.getForm();a.setValues([{id:this.localRadio.getName(),value:!b.isAcquired},{id:this.localField.getName(),value:b.localValue},{id:this.acquiredRadio.getName(),value:b.isAcquired}]);var c;if(b.acquiredValue!==null&&b.ancestor!==null){c=Ext.String.format('Inherit Value "{0}" from {1}',b.acquiredValue,b.ancestor);this.acquiredRadio.enable()}else{c=Ext.String.format("Inherit Value");this.acquiredRadio.disable()}this.acquiredRadio.setBoxLabel(c);this.acquiredValue=b.acquiredValue;this.ancestor=b.ancestor},getHiddenFieldConfig:function(a){return{xtype:"zprophidden",name:a,zpropFieldSet:this}},getAcquiredRadioConfig:function(){return{xtype:"zradio",ref:"acquiredRadio",boxLabel:"Inherit Value",scope:this,anchor:"75%",handler:function(b,a){this.localRadio.setValue(!a)}}},getLocalRadioConfig:function(a){return{xtype:"panel",layout:"column",hideBorders:true,border:false,defaults:{xtype:"panel",layout:"anchor",border:false,hideLabels:true},items:[{width:130,items:[{xtype:"radio",ref:"../../localRadio",boxLabel:_t("Set Local Value:"),checked:true,scope:this,handler:function(c,b){this.acquiredRadio.setValue(!b)}}]},{columnWidth:0.94,items:[Ext.apply(a,{ref:"../../localField",submitValue:false,anchor:"75%",listeners:{scope:this,focus:function(){this.localRadio.setValue(true)}}})]}]}}});Ext.define("Zenoss.form.Select",{extend:"Ext.form.ComboBox",alias:["widget.select"],constructor:function(a){Ext.applyIf(a,{allowBlank:false,triggerAction:"all",typeAhead:false,forceSelection:true});Zenoss.form.Select.superclass.constructor.call(this,a)}})})();(function(){var a=Ext.ns("Zenoss.form");Ext.define("Zenoss.form.IDField",{alias:["widget.idfield"],extend:"Ext.form.TextField",anchor:"80%",context:null,maskRe:/[a-zA-Z0-9-_~,.$\(\)# @]/,validator:function(c){var b=this.context||Zenoss.env.PARENT_CONTEXT;if(Ext.isEmpty(c)){return true}if(typeof _previousVar!="undefined"){if(c==_previousValue){return this.reportResponse(_previousResponseText)}}_previousValue=c;if(this.vtransaction){Ext.Ajax.abort(this.vtransaction)}this.vtransaction=Ext.Ajax.request({url:b+"/checkValidId?id="+c,method:"GET",success:function(d){this._previousResponseText=d.responseText;return this.reportResponse(d.responseText)},failure:function(d){this.markInvalid(_t("That name is invalid or is already in use."))},scope:this});return true},reportResponse:function(b){if(b==="True"){return true}this.markInvalid(_t("That name is invalid: ")+" "+b);return false}})})();(function(){Ext.ns("Zenoss","Zenoss.dialog");Ext.define("Zenoss.dialog.BaseWindow",{extend:"Ext.window.Window",alias:["widget.basewindow"],constructor:function(c){c=c||{};Ext.applyIf(c,{plain:true,buttonAlign:"left",modal:true,constrain:true});Zenoss.dialog.BaseWindow.superclass.constructor.apply(this,arguments)},initEvents:function(){Zenoss.dialog.BaseWindow.superclass.initEvents.apply(this,arguments);this.on("show",this.focusFirstTextField,this);this.on("show",this.registerEnterKey,this)},focusFirstTextField:function(){var c=this.query("textfield");if(c.length){c[0].focus(false,300)}},registerEnterKey:function(){var c=this.getKeyMap();c.on(13,function(){var e,f;if(document.activeElement){f=document.activeElement;if(f.type=="textarea"||f.type=="button"){return}}var h=this.query("button");if(h&&h.length){e=h[0]}else{var d=this.query("form");if(d){if(d.length&&d[0]){var g=d[0];if(g.query("button").length){e=g.query("button")[0]}}}}if(e&&!e.disabled){e.handler(e)}},this)},show:function(){var c=Ext.WindowManager.zseed;Ext.WindowManager.zseed=20000;this.callParent(arguments);Ext.WindowManager.zseec=c}});Ext.define("Zenoss.dialog.BaseDialog",{extend:"Zenoss.dialog.BaseWindow",constructor:function(c){Ext.applyIf(c,{width:310,closeAction:"hide",buttonAlign:"left",padding:10,autoHeight:true});this.callParent([c])}});function b(d){var e=d.up("window");if(e){return e.destroy()}if(d.ownerCt!==undefined){var c=d.ownerCt.ownerCt;if(c.ownerCt!==undefined){c.ownerCt.destroy()}else{c.destroy()}}}Ext.define("Zenoss.dialog.DialogButton",{ui:"dialog-dark",extend:"Ext.button.Button",alias:["widget.DialogButton"],constructor:function(c){var d=c.handler;c.handler=d?Ext.Function.createSequence(d,b):b;Zenoss.dialog.DialogButton.superclass.constructor.call(this,c)},setHandler:function(e,d){var c=e?Ext.Function.createSequence(e,b):b;Zenoss.dialog.DialogButton.superclass.setHandler.call(this,c,d)}});function a(c){c.ownerCt.ownerCt.hide()}Ext.define("Zenoss.dialog.HideDialogButton",{ui:"dialog-dark",extend:"Ext.button.Button",alias:["widget.HideDialogButton"],constructor:function(c){var d=c.handler;c.handler=d?Ext.Function.createSequence(d,a):a;Zenoss.dialog.HideDialogButton.superclass.constructor.call(this,c)},setHandler:function(e,d){var c=e?Ext.Function.createSequence(e,a):a;Zenoss.dialog.HideDialogButton.superclass.setHandler.call(this,c,d)}});Zenoss.dialog.CANCEL={xtype:"DialogButton",text:_t("Cancel")};Ext.define("Zenoss.MessageDialog",{extend:"Zenoss.dialog.BaseDialog",constructor:function(c){Ext.applyIf(c,{layout:"fit",items:[{xtype:"label",text:c.message,ref:"messagelabel"}],buttons:[{xtype:"HideDialogButton",text:_t("OK"),handler:c.okHandler},{xtype:"HideDialogButton",text:_t("Cancel"),handler:c.cancelHandler}]});Zenoss.MessageDialog.superclass.constructor.call(this,c)},setText:function(c){this.messagelabel.setText(c)}});Ext.define("Zenoss.dialog.SimpleMessageDialog",{extend:"Zenoss.dialog.BaseDialog",message:null,constructor:function(c){Ext.applyIf(c,{layout:"anchor",items:[{html:c.message},{height:10}],closeAction:"destroy"});Zenoss.MessageDialog.superclass.constructor.call(this,c)}});Ext.define("Zenoss.FormDialog",{extend:"Zenoss.dialog.BaseWindow",constructor:function(c){var e=this;c=c||{};c.formListeners=c.formListeners||{};Ext.applyIf(c.formListeners,{validitychange:function(f,g){e.query("DialogButton")[0].setDisabled(!g)}});var d=new Ext.form.FormPanel({id:c.formId,minWidth:300,ref:"editForm",fieldDefaults:{labelAlign:"top"},autoScroll:true,defaults:{xtype:"textfield"},items:c.items,html:c.html,listeners:c.formListeners,paramsAsHash:true,api:c.formApi||{}});Ext.destroyMembers(c,"items","formApi","formId","html");Ext.applyIf(c,{plain:true,buttonAlign:"left",autoScroll:true,width:375,modal:true,padding:10});Zenoss.FormDialog.superclass.constructor.call(this,c);this.add(d);this.form=d},getForm:function(){return this.form}});Ext.define("Zenoss.dialog.CloseDialog",{extend:"Zenoss.dialog.BaseWindow",constructor:function(c){Ext.applyIf(c,{width:310,plain:true,layout:"auto",buttonAlign:"left",padding:10,modal:true});Zenoss.dialog.CloseDialog.superclass.constructor.call(this,c)}});Ext.define("Zenoss.HideFormDialog",{extend:"Zenoss.dialog.BaseDialog",constructor:function(c){Ext.applyIf(c,{layout:"anchor",fieldDefaults:{labelAlign:"top"}});Zenoss.HideFormDialog.superclass.constructor.call(this,c)}});Ext.define("Zenoss.SmartFormDialog",{extend:"Zenoss.FormDialog",alias:"widget.smartformdialog",message:"",submitHandler:null,constructor:function(c){var d=this;this.listeners=c.listeners;Ext.applyIf(this.listeners,{validitychange:function(f,g){var e=d.query("button[ref='buttonSubmit']")[0];e.setDisabled(!g)}});Ext.applyIf(c,{buttons:[{xtype:"DialogButton",text:_t("Submit"),disabled:true,type:"submit",ref:"buttonSubmit"},{xtype:"DialogButton",ref:"buttonCancel",text:_t("Cancel")}],modal:true,closeAction:"destroy"});Zenoss.SmartFormDialog.superclass.constructor.call(this,c);if(c.message||this.message){this.insert(0,{xtype:"label",ref:"label",text:c.message||this.message})}},setSubmitHandler:function(c){var d=this.query("button[ref='buttonSubmit']")[0];if(c===null){d.setHandler(null)}else{d.setHandler(Ext.bind(function(){var f=this.getForm();var e=f.getValues();return c(e)},this))}},initComponent:function(){this.callParent();if(this.submitHandler){this.setSubmitHandler(this.submitHandler);delete this.submitHandler}}});Ext.define("Zenoss.dialog.ErrorDialog",{extend:"Zenoss.dialog.BaseDialog",title:_t("Error"),message:null,constructor:function(c){Ext.applyIf(c,{layout:"fit",cls:"errorbox",items:[{html:c.message,buttons:[{xtype:"DialogButton",text:_t("OK")}]}],closeAction:"destroy"});this.callParent([c])},initComponent:function(){this.callParent(arguments);this.show()}});Ext.define("Zenoss.HideFitDialog",{extend:"Zenoss.dialog.BaseWindow",constructor:function(c){Ext.applyIf(c,{width:600,height:300,closeAction:"hide",plain:true,buttonAlign:"left",padding:10,modal:true});Zenoss.HideFitDialog.superclass.constructor.call(this,c)}});Ext.define("Zenoss.dialog.DynamicDialog",{extend:"Zenoss.dialog.BaseDialog",initEvents:function(){Zenoss.dialog.DynamicDialog.superclass.initEvents.call(this);this.body.getLoader().on("failure",function(d,c){d.update("Failed to load dialog")})},constructor:function(c){c=Ext.applyIf(c||{},{layout:"fit",modal:true,stateful:false,closeAction:"close",minHeight:"150",buttons:[{xtype:"DialogButton",text:_t("Submit"),handler:Ext.bind(this.submitHandler,this)},{xtype:"DialogButton",text:_t("Cancel")}]});Ext.apply(c,{id:"dynamic-dialog"});Zenoss.dialog.DynamicDialog.superclass.constructor.call(this,c)},submitHandler:function(d,f){var c=Ext.getCmp("dynamic-dialog-panel");var e=c.getForm();var g={};if(Ext.isDefined(c.submitName)&&c.submitName!==null){g[c.submitName]="OK"}e.submit({params:g,success:Ext.bind(function(h,j){Zenoss.message.success(_t("{0} finished successfully"),this.title)},this),failure:function(h,j){Zenoss.message.error(_t("{0} had errors"),this.title)}})}});Ext.define("Zenoss.dialog.DialogFormPanel",{extend:"Ext.form.FormPanel",alias:["widget.DialogFormPanel"],jsonResult:true,submitName:null,existingFormId:null,constructor:function(c){c=c||{};Ext.apply(c,{id:"dynamic-dialog-panel"});Zenoss.dialog.DialogFormPanel.superclass.constructor.call(this,c)},createForm:function(){var c=Ext.applyIf({listeners:{}},this.initialConfig);if(!this.jsonResult){c.errorReader={read:function(f){var e=true;if(f.status!=200){e=false}return{records:[],success:e}}}}var d=null;if(this.existingFormId!==null){d=this.existingFormId}return new Ext.form.BasicForm(d,c)}})})();(function(){Ext.namespace("Zenoss.form");Ext.define("Zenoss.form.DataSourceEditDialog",{extend:"Zenoss.dialog.BaseWindow",alias:["widget.datasourceeditdialog"],constructor:function(d){d=d||{};var a=d.record,b=d.items,e,c=true,f=this;this.itemCount=0;if(!a){throw"EditDialog did not recieve a record to edit (config.record is undefined)"}if(!d.singleColumn){b=this.sortItems(b,a)}else{b=b.items[0].items;for(e=0;e<b.length;e+=1){b[e].record=a;this.itemCount+=1;if(b[e]["xtype"]=="datapointitemselector"){this.itemCount+=4}}}if(this.itemCount>10){c=false}Ext.apply(d,{layout:"anchor",plain:true,buttonAlign:"left",autoScroll:true,constrain:true,modal:true,padding:10,height:500,autoHeight:c,items:[{xtype:"form",minWidth:300,ref:"editForm",fieldDefaults:{labelAlign:"top"},autoScroll:true,defaults:{xtype:"textfield",anchor:"85%"},listeners:{validitychange:function(g,h){var j=f;if(Zenoss.Security.hasPermission("Manage DMD")){j.submitButton.setDisabled(!h)}}},items:b}],buttons:[{xtype:"DialogButton",ref:"../submitButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),text:_t("Save"),handler:function(){var j=f.editForm.form,g=true,h=j.getFieldValues(g);h.uid=a.uid;d.directFn(h,d.saveHandler)}},Zenoss.dialog.CANCEL]});Zenoss.form.DataSourceEditDialog.superclass.constructor.apply(this,arguments)},sortItems:function(c,h){var a=[],f,d,b,l,m,e,g,k;c=c.items;if(c[0].title){e=c[0];for(f=0;f<c.length;f+=1){if(!c[f].title){c[0]=c[f];c[f]=e;break}}}for(f=0;f<c.length;f+=1){m=c[f];if(m.title){g={xtype:"panel",layout:"anchor",html:"<br /><br /><h1>"+m.title+"</h1>"}}else{g=null}k=[];b={xtype:"panel",layout:"column",items:[{layout:"anchor",border:false,columnWidth:0.5,items:[]},{layout:"anchor",border:false,columnWidth:0.5,items:[]}]};for(d=0;d<m.items.length;d+=1){l=m.items[d];this.itemCount+=1;l.record=h;if(l.xtype.search(/textarea/)>=0){k.push(l)}else{b.items[d%2].items.push(l)}}if(g){a.push(g)}a.push(b);if(k.length){for(d=0;d<k.length;d+=1){a.push({xtype:"panel",layout:"anchor",items:k[d]})}}}return a}})}());(function(){Ext.ns("Zenoss.model");Zenoss.model.BASE_TREE_FIELDS=[{name:"hidden",type:"boolean"},{name:"leaf",type:"boolean"},{name:"uid",type:"string"},{name:"text"},{name:"id",type:"string"},{name:"path",type:"string"},{name:"iconCls",type:"string"},{name:"uuid",type:"string"}];Ext.define("Zenoss.model.Tree",{extend:"Ext.data.Model",fields:Zenoss.model.BASE_TREE_FIELDS})}());(function(){Ext.ns("Zenoss.model");Ext.define("Zenoss.model.Basic",{extend:"Ext.data.Model",idProperty:"uid",fields:["uid","name"]});Ext.define("Zenoss.model.Label",{extend:"Ext.data.Model",idProperty:"uid",fields:["uid","label"]});Ext.define("Zenoss.model.BasicUUID",{extend:"Ext.data.Model",idProperty:"uuid",fields:["uuid","name"]});Ext.define("Zenoss.model.Name",{extend:"Ext.data.Model",idProperty:"name",fields:["name"]});Ext.define("Zenoss.model.NameValue",{extend:"Ext.data.Model",idProperty:"value",fields:["name","value"]});Ext.define("Zenoss.model.IdName",{extend:"Ext.data.Model",idProperty:"id",fields:["id","name"]});Ext.define("Zenoss.model.ValueText",{extend:"Ext.data.Model",idProperty:"value",fields:["value","text"]})}());(function(){Ext.ns("Zenoss");function a(e,d){function b(f){if(Ext.isObject(f.get("text"))){return f.get("text").text.toLowerCase()}return f.get("text").toLowerCase()}function c(j,h){var g=b(j),f=b(h);if(g==f){return 0}return g<f?-1:1}if(e.get("iconCls")=="folder"&&d.get("iconCls")!="folder"){return -1}if(d.get("iconCls")=="folder"&&e.get("iconCls")!="folder"){return 1}return c(e,d)}Ext.define("Zenoss.TreeSelectionModel",{extend:"Ext.selection.TreeModel",getSelectedNode:function(){var b=this.getSelection();if(b.length){return b[0]}return null}});Ext.define("Zenoss.HierarchyTreePanelSearch",{extend:"Ext.Panel",alias:["widget.HierarchyTreePanelSearch"],constructor:function(c){var b=c;c={cls:"x-hierarchy-search-panel",bodyStyle:"background-color:#d4e0ee;",items:[{xtype:"searchfield",id:c.id||Ext.id(),height:25,hidden:!Zenoss.settings.enableTreeFilters,cls:"x-hierarchy-search",enableKeyEvents:true,ref:"searchfield"},{xtype:"panel",ui:"hierarchy",padding:"5px 0 0 0",items:b.items,flex:1,autoScroll:true,regSearchListeners:function(d){this.ownerCt.query(".searchfield")[0].on(d)}}],layout:{type:"vbox",align:"stretch"},listeners:{afterrender:function(d){d.searchfield.container.setWidth(d.ownerCt.getWidth())}}};Zenoss.HierarchyTreePanelSearch.superclass.constructor.call(this,c)}});Zenoss.treeContextMenu=function(d,j,h,f,k,g){var b=d.panel;if(!b.contextMenu){b.contextMenu=new Ext.menu.Menu({items:[{ref:"refreshtree",text:_t("Refresh Tree"),handler:function(n,o){var m=n.parentMenu.contextNode;var c=n.parentMenu.tree;c.getStore().load({callback:function(){c.getRootNode().expand();if(c.getRootNode().childNodes.length){c.getRootNode().childNodes[0].expand()}}})}},{ref:"expandall",text:_t("Expand All"),handler:function(n,o){var m=n.parentMenu.contextNode,c=n.parentMenu.tree;c.expandAll()}},{ref:"collapsall",text:_t("Collapse All"),handler:function(n,o){var m=n.parentMenu.contextNode,c=n.parentMenu.tree;c.collapseAll();c.getRootNode().expand();if(c.getRootNode().childNodes.length){c.getRootNode().childNodes[0].expand()}}},"-",{ref:"expandnode",text:_t("Expand Node"),handler:function(m,n){var c=m.parentMenu.contextNode;if(c){c.expand(true,true)}}},{ref:"newwindow",text:_t("Open in New Window"),handler:function(o,q){var n=o.parentMenu.contextNode,c,p,m=window.location.protocol+"//"+window.location.host+window.location.pathname;if(n&&n.data.uid){c=o.parentMenu.tree;p=c.createDeepLinkPath(n);window.open(m+"#"+p)}}}]})}var l=b.contextMenu;l.tree=b;l.contextNode=j;k.preventDefault();l.showAt(k.getXY())};Ext.define("Zenoss.HierarchyTreePanel",{extend:"Ext.tree.Panel",alias:["widget.HierarchyTreePanel"],constructor:function(d){Ext.applyIf(d,{enableDragDrop:true});d.listeners=d.listeners||{};Ext.applyIf(d.listeners,{itemcontextmenu:Zenoss.treeContextMenu,scope:this});d.viewConfig=d.viewConfig||{};if(d.enableDragDrop){Ext.applyIf(d.viewConfig,{loadMask:true,plugins:{ptype:"treeviewdragdrop",enableDrag:Zenoss.Security.hasPermission("Change Device"),enableDrop:Zenoss.Security.hasPermission("Change Device"),ddGroup:d.ddGroup}})}else{Ext.applyIf(d.viewConfig,{loadMask:true})}Ext.applyIf(d,{ui:"hierarchy",frame:false,useArrows:true,autoScroll:true,manageHeight:false,relationshipIdentifier:null,containerScroll:true,selectRootOnLoad:true,rootVisible:false,rootDepth:d.rootVisible?0:1,allowOrganizerMove:true,pathSeparator:"/",nodeIdSeparator:".",hideHeaders:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text",renderer:function(j,g,k){if(Ext.isString(j)){return j}var f=k.parentNode,h;if(Ext.isEmpty(j.count)){h=""}else{h=Ext.String.format(" <span title='{0}'>({1})</span>",j.description,j.count)}if(f.data.root==true){return Ext.String.format("<span class='rootNode'>{0}{1}</span>",j.text,h)}else{return Ext.String.format("<span class='subNode'>{0}</span>{1}",j.text,h)}}}]});if(d.router){Ext.applyIf(d,{addNodeFn:d.router.addNode,deleteNodeFn:d.router.deleteNode})}else{Ext.applyIf(d,{addNodeFn:Ext.emptyFn,deleteNodeFn:Ext.emptyFn})}var b=d.root||{};if(d.directFn&&!d.loader){var e=Ext.String.format("Zenoss.tree.{0}Model",d.id);var c=Ext.define(e,{extend:"Ext.data.Model",treeId:d.id,idProperty:d.idProperty||"id",getOwnerTree:function(){return Ext.getCmp(this.treeId)},getId:function(){return this.get("uid")},proxy:{simpleSortMode:true,type:"direct",directFn:d.directFn,paramOrder:["uid"]},fields:Zenoss.model.BASE_TREE_FIELDS.concat(d.extraFields||[])});d.store=new Ext.create("Ext.data.TreeStore",{model:e,nodeParam:"uid",defaultRootId:b.uid,remoteSort:false,sorters:{sorterFn:d.sortFn||a,direction:"asc"},uiProviders:{}});Ext.destroyMembers(d,"directFn","ddGroup")}Ext.applyIf(b,{id:b.id,uid:b.uid,text:_t(b.text||b.id)});this.root=b;this.stateHash={};if(d.stateful){this.stateEvents=this.stateEvents||[];this.stateEvents.push("expandnode","collapsenode")}Zenoss.HierarchyTreePanel.superclass.constructor.apply(this,arguments)},setNodeVisible:function(f,e){var d=this.getStore().getNodeById(f),b=this.getView(),c=Ext.fly(b.getNodeByRecord(d));if(c){c.setVisibilityMode(Ext.Element.DISPLAY);c.setVisible(e)}},getState:function(){return{stateHash:this.stateHash}},applyState:function(b){if(b){Ext.apply(this,b);this.setStateListener()}},setStateListener:function(){this.store.on({load:{scope:this,fn:function(){for(var b in this.stateHash){if(this.stateHash.hasOwnProperty(b)){this.expandPath(this.stateHash[b])}}}}})},initEvents:function(){var b=this;Zenoss.HierarchyTreePanel.superclass.initEvents.call(this);if(this.selectRootOnLoad&&!Ext.History.getToken()){this.getRootNode().on("expand",function(){if(this.getRootNode().firstChild){b.addHistoryToken(b.getView(),this.getRootNode().firstChild);b.getRootNode().firstChild.expand();b.getSelectionModel().select(this.getRootNode().firstChild)}},this,{single:true})}else{this.getRootNode().on("expand",function(){if(this.getRootNode().firstChild){this.getRootNode().firstChild.expand()}},this,{single:true})}this.addEvents("filter");this.on("itemclick",this.addHistoryToken,this);this.on({beforeexpandnode:function(c){this.stateHash[c.id]=c.getPath()},beforecollapsenode:function(d){delete this.stateHash[d.id];var e=d.getPath();for(var c in this.stateHash){if(this.stateHash.hasOwnProperty(c)){if(-1!==this.stateHash[c].indexOf(e)){delete this.stateHash[c]}}}}})},addHistoryToken:function(b,c){Ext.History.add(this.id+Ext.History.DELIMITER+c.get("id"))},update:function(b){function c(d,e){Ext.each(e,function(f){var g=d.findChild("id",f.id);if(g){g.data=f;g.setText(g.data.text);c(g,f.children)}})}c(this.getRootNode(),b)},selectByToken:function(d){d=unescape(d);var b=this.getRootNode(),c=Ext.bind(function(){var f=this.getSelectionModel().getSelectedNode(),e,h;if(!(f&&d===f.id)){var g=this.getNodePathById(d);this.selectPath(g)}},this);if(!b.isLoaded()){b.on("expand",c,this,{single:true})}else{c()}},getNodePathById:function(f){var e=this.root.uid.split("/").length-this.rootDepth,d=f.split(this.nodeIdSeparator),c=[],b=Ext.Array.splice(d,0,e+1).join(this.nodeIdSeparator);c.push(this.initialConfig.root.id);c.push(b);Ext.each(d,function(g){b=b+this.nodeIdSeparator+g;if(g!=this.relationshipIdentifier){c.push(b)}else{var h=f.split(this.nodeIdSeparator+this.relationshipIdentifier+this.nodeIdSeparator);if(h.length>1){c.push(b+this.nodeIdSeparator+h.pop());return false}}},this);return"/"+c.join(this.pathSeparator)},expandToChild:function(c){var b=c.parentNode;while(b){if(Ext.isEmpty(b.get("path"))){break}if(!b.isExpanded()&&b.hasChildNodes()){b.expand()}b=b.parentNode}},createDeepLinkPath:function(b){var c=this.id+Ext.History.DELIMITER+b.get("uid").replace(/\//g,".");return c},afterRender:function(){Zenoss.HierarchyTreePanel.superclass.afterRender.call(this);var c=Zenoss.settings.enableLiveSearch,b={scope:this,keypress:function(f,d){if(d.getKey()===d.ENTER){this.filterTree(f)}}};if(c){b.change=this.filterTree}if(this.searchField&&this.ownerCt.regSearchListeners){this.ownerCt.regSearchListeners(b)}this.getRootNode().expand(false,true,function(d){d.expandChildNodes()})},expandAll:function(){if(this.getRootNode().firstChild){this.getRootNode().firstChild.expand(true)}else{this.callParent(arguments)}},filterTree:function(b){if(!this.onFilterTask){this.onFilterTask=new Ext.util.DelayedTask(function(){this.doFilter(b)},this)}this.onFilterTask.delay(1000)},postFilter:function(){var b=this.getRootNode(),c=b.childNodes;while(c.length){if(c[0].childNodes.length){c=c[0].childNodes}else{break}}this.getSelectionModel().select(c[0]);this.up("HierarchyTreePanelSearch").down("searchfield").focus([false])},getFilterFn:function(d){var c=new RegExp(Ext.String.escapeRegex(d),"i");var b=function(f){var e=f.get("text");if(Ext.isObject(e)){e=e.text}return c.test(e)};return b},doFilter:function(f){var g=f.getValue(),d=this,b=this.getRootNode(),c=this.getStore();c.clearFilter(true);this.fireEvent("filter",f);if(g){c.filter(new Ext.util.Filter({filterFn:this.getFilterFn(g)}))}},addNode:function(b,c){this.addChildNode({type:b,id:c})},addChildNode:function(e){var d=this.getSelectionModel().getSelectedNode();var b;if(d.leaf){b=d.parentNode}else{b=d}var c=b.data.uid;Ext.applyIf(e,{contextUid:c});this.addTreeNode(e)},addTreeNode:function(b){var c=function(h,e){var d=e.result;var f=this;if(d.success){var g=Zenoss.env.PARENT_CONTEXT+"/"+b.id;this.getStore().load({callback:function(){g=g.replace(/\//g,".");f.selectByToken(g)}})}else{Ext.Msg.alert("Error",d.msg)}};this.addNodeFn(b,Ext.bind(c,this))},deleteSelectedNode:function(){var e=this.getSelectionModel().getSelectedNode();var d=this;var b=e.parentNode;var c=e.get("uid");var f={uid:c};function g(j,h){if(Zenoss.util.isSuccessful(h)){d.getSelectionModel().select(b);d.getStore().load({callback:function(){d.selectByToken(b.get("uid"));d.getRootNode().firstChild.expand()}})}}if(e.getDepth()<=1){Zenoss.message.error(_t("You can not delete the root node"));return}this.deleteNodeFn(f,g)},canMoveOrganizer:function(d,c){var b=d.split("/"),e=c.split("/");if(!this.allowOrganizerMove){return false}return b[3]===e[3]},refresh:function(c,b){this.getStore().load({scope:this,callback:function(){this.getRootNode().expand();Ext.callback(c,b||this);if(this.getRootNode().childNodes.length){this.getRootNode().childNodes[0].expand()}}})}})})();Ext.ns("Zenoss");Ext.define("Zenoss.SearchField",{extend:"Ext.form.TextField",alias:["widget.searchfield"],constructor:function(a){a=Ext.applyIf(a||{},{validationDelay:500,selectOnFocus:true});a.cls+=" x-field-search";Zenoss.SearchField.superclass.constructor.apply(this,arguments)},getClass:function(){var a=this.altCls?this.altCls:"searchfield";return this.black?a+"-black":a},onRender:function(){Zenoss.SearchField.superclass.onRender.apply(this,arguments);this.wrap=this.el.boxWrap(this.getClass());if(this.bodyStyle){this.wrap.setStyle(this.bodyStyle)}this.resizeEl=this.positionEl=this.wrap;this.syncSize()},syncSize:function(){this.el.setBox(this.el.parent().getBox())}});(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.LinkField",{extend:"Ext.form.DisplayField",alias:["widget.linkfield"],initComponent:function(){this.callParent(arguments);this.setValue(this.value)},getValue:function(){return this.rawValue},setValue:function(c){var a=c;if(Ext.isEmpty(c)){c=_t("None")}else{if(Ext.isArray(c)){var b=[];Ext.each(c,function(d){b.push(Zenoss.render.link(d))});c=b.join("<br/>")}else{c=Zenoss.render.link(c)}}this.callParent([c]);this.rawValue=a}})})();(function(){var b=Ext.ns("Zenoss.form");Ext.form.TextArea.prototype.grow=true;Ext.form.TextArea.prototype.growMin=20;function a(d){return !!d.setValue&&!!d.getValue&&!!d.markInvalid&&!!d.clearInvalid}b.createDirectSubmitFunction=function(c){return function(d,f,e){var h=e.form;var j={};var g=h.getValues(false,true);Ext.iterate(g,function(l,m){var n=h.findField(l);if(n.submitValue!==false&&n.getName().indexOf("ext-gen")!==0){j[l]=m}});Ext.applyIf(j,e.getParams());Ext.iterate(j,function(l,m){if(l.indexOf("ext-gen")!==0){j[l]=m}else{delete j[l]}});var k=function(){h.clearInvalid();h.setValues(g);h.afterAction(e,true);h.reset();Zenoss.message.info(_t("Details updated successfully"))};c.setInfo(j,k,e)}};Ext.define("Zenoss.form.BaseDetailForm",{extend:"Ext.form.FormPanel",alias:["widget.basedetailform"],contextUid:null,isLoadInProgress:false,constructor:function(d){var c=d.router||Zenoss.remote.DeviceRouter;d.baseParams=Ext.applyIf(d.baseParams||{uid:d.contextUid});d=Ext.applyIf(d||{},{paramsAsHash:true,autoScroll:"y",cls:"detail-form-panel",buttonAlign:"left",fieldDefaults:{labelAlign:"top"},trackResetOnLoad:true,permission:"Manage Device",api:{submit:b.createDirectSubmitFunction(c),load:c.getInfo}});var e=function(){var f=!Zenoss.Security.doesNotHavePermission(d.permission);if(Ext.isDefined(d.userCanModify)){return d.userCanModify&&f}else{return f}};if(e()){Ext.apply(d,{buttons:[{xtype:"button",ref:"../savebtn",text:_t("Save"),disabled:true,cls:"detailform-submit-button",handler:function(f,g){this.refOwner.getForm().submit()}},{xtype:"button",ref:"../cancelbtn",disabled:true,text:_t("Cancel"),cls:"detailform-cancel-button",handler:function(f,g){this.refOwner.getForm().reset()}}]})}b.BaseDetailForm.superclass.constructor.call(this,d)},initComponent:function(){this.callParent(arguments);var c=this.getForm();c.on("dirtychange",function(f,e,d){if(e&&f.isValid()){this.setButtonsDisabled(false)}},this)},validityChange:function(e,d,c){if(d){this.setButtonsDisabled(false)}},hasPermission:function(){var c=!Zenoss.Security.doesNotHavePermission(this.permission);if(Ext.isDefined(this.userCanModify)){return this.userCanModify&&c}else{return c}},setButtonsDisabled:function(c){if(this.hasPermission()){this.savebtn.setDisabled(c);this.cancelbtn.setDisabled(c)}},doButtons:function(){this.setButtonsDisabled(!this.form.isDirty())},onFieldAdd:function(c){if(!c.isXType("displayfield")){this.mon(c,"valid",this.doButtons,this)}},getFieldNames:function(){var d=[];for(var c in this.getForm().getValues(false,false)){if(Ext.Array.indexOf(d,c)==-1){d.push(c)}}return d},load:function(){var c=Ext.apply({keys:this.getFieldNames()},this.baseParams);this.form.load(c,function(d){this.form.setValues(d.data);this.form.reset();this.doLayout()},this)},setContext:function(c){this.contextUid=c;this.baseParams.uid=c;this.isLoadInProgress=true;this.load()}})})();(function(){var a=Ext.ns("Zenoss.form");Ext.define("Zenoss.form.AutoFormPanel",{extend:"Zenoss.form.BaseDetailForm",alias:["widget.autoformpanel"]});a.getGeneratedForm=function(c,d,b){b=b||Zenoss.remote.DeviceRouter;b.getForm({uid:c},function(e){d(Ext.apply({xtype:"autoformpanel",contextUid:c,layout:"column",defaults:{layout:"anchor",bodyStyle:"padding:10px",fieldDefaults:{labelAlign:"top"},columnWidth:0.5}},e.form))})};Ext.define("Zenoss.form.AutoFormCombo",{extend:"Ext.form.ComboBox",alias:["widget.autoformcombo"],constructor:function(b){b=Ext.applyIf(b||{},{editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",queryMode:"local",store:b.values||[]});Zenoss.form.AutoFormCombo.superclass.constructor.call(this,b)}})})();(function(){Ext.ns("Zenoss");function a(d){if(d){return d.name}return""}var c=[{dataIndex:"name",header:_t("Device"),id:"name",flex:1,hideable:false,renderer:function(e,f,d){return Zenoss.render.Device(d.data.uid,e)}},{width:100,dataIndex:"ipAddress",header:_t("IP Address"),renderer:function(f,e,d){return d.data.ipAddressString}},{dataIndex:"uid",header:_t("Device Class"),id:"deviceClass",width:120,renderer:Zenoss.render.DeviceClass},{id:"productionState",dataIndex:"productionState",width:100,filter:{xtype:"multiselect-prodstate"},header:_t("Production State"),renderer:function(d){return Zenoss.env.PRODUCTION_STATES_MAP[d]}},{id:"serialNumber",dataIndex:"serialNumber",width:100,hidden:true,header:_t("Serial Number")},{id:"tagNumber",dataIndex:"tagNumber",width:100,hidden:true,header:_t("Tag Number")},{id:"hwManufacturer",dataIndex:"hwManufacturer",width:100,header:_t("Hardware Manufacturer"),hidden:true,renderer:a},{id:"hwModel",dataIndex:"hwModel",hidden:true,width:100,header:_t("Hardware Model"),renderer:a},{id:"osManufacturer",dataIndex:"osManufacturer",width:100,header:_t("OS Manufacturer"),hidden:true,renderer:a},{id:"osModel",dataIndex:"osModel",width:150,hidden:true,header:_t("OS Model"),renderer:a},{dataIndex:"collector",width:100,hidden:true,header:_t("Collector")},{id:"priorityString",dataIndex:"priority",width:100,hidden:true,filter:false,header:_t("Priority"),renderer:function(d){return Zenoss.env.PRIORITIES_MAP[d]}},{dataIndex:"systems",width:100,hidden:true,sortable:false,header:_t("Systems"),renderer:function(e){var d=[];if(e){Ext.each(e,function(f){d.push(Zenoss.render.DeviceSystem(f.uid,f.name))})}return d.join(" | ")}},{dataIndex:"groups",width:100,hidden:true,sortable:false,header:_t("Groups"),renderer:function(d){var e=[];if(d){Ext.each(d,function(f){e.push(Zenoss.render.DeviceGroup(f.uid,f.name))})}return e.join(" | ")}},{dataIndex:"location",width:100,hidden:true,sortable:false,header:_t("Location"),renderer:function(d){if(d){return Zenoss.render.DeviceLocation(d.uid,d.name)}return""}},{id:"worstevents",sortable:false,filter:false,width:75,dataIndex:"events",header:_t("Events"),renderer:function(h,e,d){var g=Zenoss.render.worstevents(h),f=d.data.uid+"/devicedetail?filter=default#deviceDetailNav:device_events";if(g){g=g.replace("table","table onclick=\"location.href='"+f+"';\"")}return g}}];Ext.define("Zenoss.DeviceGridSelectionModel",{extend:"Zenoss.ExtraHooksSelectionModel",mode:"MULTI",_selectAll:false,_excludedRecords:{},constructor:function(d){this.callParent([d]);this.on("select",this._includeRecord,this);this.on("deselect",this._excludeRecord,this)},_includeRecord:function(f,d,e){if(d&&this._selectAll){delete this._excludedRecords[d.getId()]}},_excludeRecord:function(f,d,e){if(d&&this._selectAll){this._excludedRecords[d.getId()]=true}},_handleStoreDataChange:function(){if(this._selectAll){this.suspendEvents();var d=this.store.data.filterBy(function(e){return(!this._excludedRecords[e.getId()])},this);this.select(d.items,false,true);this.resumeEvents();this.fireEvent("selectionchange",this)}},bind:function(d,e){if(!e&&this.store){if(d!==this.store&&this.store.autoDestroy){this.store.destroyStore()}else{this.store.un("datachanged",this._handleStoreDataChange,this)}}if(d){d=Ext.data.StoreManager.lookup(d);d.on("datachanged",this._handleStoreDataChange,this)}this.store=d;if(d&&!e){this.refresh()}},selectAll:function(){this._selectAll=true;this.callParent([true])},selectNone:function(){this._selectAll=false;this._excludedRecords={};this.deselectAll([true]);this.fireEvent("selectionchange",this)},deselectAll:function(){if(!this._selectAll){this.callParent(arguments)}},clearSelections:function(){if(this.isLocked()||this._selectAll){return}this.suspendEvents();this.deselect(this.store.data.items,true);this.resumeEvents();this.fireEvent("selectionchange",this);this.callParent(arguments)}});Ext.define("Zenoss.device.DeviceModel",{extend:"Ext.data.Model",fields:[{name:"uid",type:"string"},{name:"name",type:"string"},{name:"ipAddress",type:"int"},{name:"ipAddressString",type:"string"},{name:"productionState",type:"string"},{name:"serialNumber",type:"string"},{name:"tagNumber",type:"string"},{name:"hwManufacturer",type:"object"},{name:"hwModel",type:"object"},{name:"osManufacturer",type:"object"},{name:"osModel",type:"object"},{name:"collector",type:"string"},{name:"priority",type:"string"},{name:"systems",type:"object"},{name:"groups",type:"object"},{name:"location",type:"object"},{name:"events",type:"object"},{name:"availability",type:"float"},{name:"pythonClass",type:"string"}],idProperty:"uid"});Ext.define("Zenoss.DeviceStore",{alias:["widget.DeviceStore"],extend:"Zenoss.DirectStore",constructor:function(d){d=d||{};Ext.applyIf(d,{autoLoad:false,pageSize:Zenoss.settings.deviceGridBufferSize,model:"Zenoss.device.DeviceModel",initialSortColumn:"name",directFn:Zenoss.remote.DeviceRouter.getDevices,root:"devices"});this.callParent(arguments)}});Ext.define("Zenoss.DeviceGridPanel",{extend:"Zenoss.FilterGridPanel",alias:["widget.DeviceGridPanel","widget.SimpleDeviceGridPanel"],lastHash:null,constructor:function(e){var f=e.storeCfg||{};var d=Ext.create("Zenoss.DeviceStore",f);Ext.applyIf(e,{store:d,columns:c});this.callParent(arguments);this.on("itemdblclick",this.onItemDblClick,this)},onItemDblClick:function(e,d){window.location=d.get("uid")},applyOptions:function(e){var d=Zenoss.util.filter(this.columns,function(g){return !g.hidden}),f=Ext.Array.pluck(d,"dataIndex");f.push("ipAddressString");f.push("pythonClass");Ext.apply(e.params,{keys:f})}});function b(f,d,e){Ext.create("Zenoss.dialog.LockForm",{applyOptions:function(g){Ext.applyIf(g,e.fetcher())},title:f==""?_t("Lock Device"):_t("Lock Devices"),message:f,updatesChecked:d.updates,deletionChecked:d.deletion,sendEventChecked:d.events,submitFn:function(g){e.REMOTE.lockDevices(g,e.saveHandler)}}).show()}Ext.define("Zenoss.DeviceActionMenu",{alias:["widget.deviceactionmenu"],extend:"Ext.Button",constructor:function(d){d=d||{};if(!d.saveHandler){throw"Device Action Menu did not receive a save handler"}if(!d.deviceFetcher){throw"Device Action Menu did not receive a device fetcher"}var g=d.deviceFetcher,e=d.saveHandler,f=Zenoss.remote.DeviceRouter;Ext.applyIf(d,{text:_t("Actions"),disabled:Zenoss.Security.doesNotHavePermission("Delete Device"),menu:{items:[new Zenoss.Action({text:_t("Lock Devices")+"...",iconCls:"lock",permission:"Change Device",handler:function(){var j=g().uids,h={fetcher:g,saveHandler:e,REMOTE:f};if(j.length==0){Zenoss.message.warning(_t("Please select 1 or more devices to lock"));return}if(j.length>1){b(_t("To view locked state, select one device at a time."),"",h)}else{f.getInfo({uid:g().uids[0],keys:["locking"]},function(k){if(k.success){b("",k.data.locking,h)}})}}}),new Zenoss.Action({text:_t("Reset IP"),iconCls:"set",permission:"Change Device",handler:function(){new Zenoss.dialog.SimpleMessageDialog({message:Ext.String.format(_t("Are you sure you want to reset the IP addresses of these devices to the results of a DNS lookup?")),title:_t("Reset IP"),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){f.resetIp(g(),e)}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}),new Zenoss.Action({text:_t("Set Production State")+"...",iconCls:"set",permission:"Change Device Production State",handler:function(){var h=new Zenoss.FormDialog({title:_t("Set Production State"),modal:true,width:310,height:150,items:[{xtype:"ProductionStateCombo",fieldLabel:_t("Select a production state"),id:"prodstate",listeners:{select:function(){Ext.getCmp("prodstateok").enable()}}}],buttons:[{xtype:"DialogButton",id:"prodstateok",disabled:true,text:_t("OK"),handler:function(){var j=Ext.apply(g(),{prodState:Ext.getCmp("prodstate").getValue()});f.setProductionState(j,e)}},Zenoss.dialog.CANCEL]});h.show()}}),new Zenoss.Action({text:_t("Set Priority")+"...",iconCls:"set",permission:"Change Device",handler:function(){var h=new Zenoss.FormDialog({title:_t("Set Priority"),modal:true,width:310,height:150,items:[{xtype:"PriorityCombo",id:"device_action_priority",fieldLabel:_t("Select a priority"),listeners:{select:function(){Ext.getCmp("priorityok").enable()}}}],buttons:[{xtype:"DialogButton",id:"priorityok",disabled:true,text:_t("OK"),handler:function(){var j=Ext.apply(g(),{priority:Ext.getCmp("device_action_priority").getValue()});f.setPriority(j,e)}},Zenoss.dialog.CANCEL]});h.show()}}),new Zenoss.Action({text:_t("Set Collector")+"...",iconCls:"set",permission:"Change Device",handler:function(){var h=new Zenoss.FormDialog({title:_t("Set Collector"),modal:true,width:310,height:180,items:[{xtype:"combo",fieldLabel:_t("Select a collector"),id:"collector",queryMode:"local",store:new Ext.data.ArrayStore({data:Zenoss.env.COLLECTORS,fields:["name"]}),valueField:"name",displayField:"name",forceSelection:true,editable:false,listeners:{select:function(){Ext.getCmp("collectorok").enable()}}},{xtype:"checkbox",name:"moveData",id:"moveData",fieldLabel:_t("Move Data")}],buttons:[{xtype:"DialogButton",id:"collectorok",disabled:true,text:_t("OK"),handler:function(){var j=Ext.apply(g(),{collector:Ext.getCmp("collector").getValue(),moveData:Ext.getCmp("moveData").getValue()});j.asynchronous=Zenoss.settings.deviceMoveIsAsync(j.uids);f.setCollector(j,e)}},Zenoss.dialog.CANCEL]});h.show()}})]}});Zenoss.DeviceActionMenu.superclass.constructor.apply(this,arguments)}})})();(function(){Ext.ns("Zenoss.events");Zenoss.events.getRowClass=function(c,d){var e=c.get("eventState")=="New"?"unacknowledged":"acknowledged";var g=Zenoss.util.convertSeverity(c.get("severity"));var f=Ext.state.Manager.get("rowcolor")?"rowcolor rowcolor-":"";return f+g+"-"+e+" "+e};function b(d){if(Ext.getCmp("addeventwindow")){Ext.getCmp("addeventwindow").show();return}var e;if(Zenoss.env.device_uid){e=Zenoss.env.device_uid.split("/").reverse()[0]}var c=Ext.create("Zenoss.dialog.BaseWindow",{title:_t("Create Event"),id:"addeventwindow",layout:"fit",autoHeight:true,modal:true,width:310,closeAction:"hide",plain:true,items:[{id:"addeventform",xtype:"form",defaults:{width:290},autoHeight:true,frame:false,listeners:{validitychange:function(f,g){c.query("DialogButton")[0].setDisabled(!g)}},fieldDefaults:{labelWidth:100},items:[{xtype:"textarea",name:"summary",fieldLabel:_t("Summary"),allowBlank:false},{xtype:"textfield",fieldLabel:_t("Device"),name:"device",allowBlank:false,value:e},{xtype:"textfield",fieldLabel:_t("Component"),name:"component"},{fieldLabel:_t("Severity"),name:"severity",xtype:"combo",store:Zenoss.env.SEVERITIES,typeAhead:true,allowBlank:false,forceSelection:true,triggerAction:"all",value:5,selectOnFocus:true},{xtype:"textfield",fieldLabel:_t("Event Class Key"),name:"evclasskey"},{fieldLabel:_t("Event Class"),name:"evclass",xtype:"combo",allowBlank:true,store:Zenoss.env.EVENT_CLASSES,typeAhead:true,forceSelection:true,triggerAction:"all",selectOnFocus:true,listConfig:{resizable:true}}],buttons:[{text:_t("Submit"),xtype:"DialogButton",formBind:true,handler:function(){var f=Ext.getCmp("addeventform");Zenoss.remote.EventsRouter.add_event(f.getForm().getValues(),function(){c.hide();var g=Ext.getCmp(d);g.refresh()})}},{text:_t("Cancel"),xtype:"DialogButton",handler:function(){c.hide()}}]}]});c.show()}function a(c){var d=new Zenoss.dialog.BaseWindow({title:_t("Classify Events"),width:300,autoHeight:true,modal:true,plain:true,items:[{id:"classifyEventForm",xtype:"form",monitorValid:true,autoHeight:true,frame:false,items:[{padding:10,style:{"font-size":"10pt"},html:_t("Select the event class with which you want to associate these events.")},{xtype:"combo",store:Zenoss.env.EVENT_CLASSES,typeAhead:true,allowBlank:false,forceSelection:true,triggerAction:"all",width:180,style:{"margin-left":"100px"},listConfig:{resizable:true},emptyText:_t("Select an event class"),selectOnFocus:true,id:"evclass_combo"}],listeners:{fieldvaliditychange:function(e,g,f){Ext.getCmp("classifyEventFormSubmitButton").setDisabled(!f)},scope:d},buttons:[{text:_t("Submit"),xtype:"DialogButton",id:"classifyEventFormSubmitButton",disabled:true,handler:function(){var f=Ext.getCmp("evclass_combo"),h=Ext.getCmp(c),j=h.getSelectionModel(),g=j.getSelection(),e=[];Ext.each(g,function(k){e[e.length]=k.data});if(!e.length){d.hide();new Zenoss.dialog.ErrorDialog({message:_t("No events were selected.")})}else{Zenoss.remote.EventsRouter.classify({evclass:f.getValue(),evrows:e},function(k){d.destroy();var l=k.success?_t("Classified"):_t("Error");Ext.MessageBox.show({title:l,msg:Ext.htmlDecode(k.msg),buttons:Ext.MessageBox.OK})})}}},{text:_t("Cancel"),xtype:"DialogButton",handler:function(){d.destroy()}}]}]});d.show()}Zenoss.events.EventPanelToolbarActions={acknowledge:new Zenoss.ActionButton({iconCls:"acknowledge",tooltip:_t("Acknowledge events"),permission:"Manage Events",itemId:"acknowledge",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.acknowledge)}}),close:new Zenoss.ActionButton({iconCls:"close",tooltip:_t("Close events"),permission:"Manage Events",itemId:"close",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.close)}}),reclassify:new Zenoss.ActionButton({iconCls:"classify",tooltip:_t("Reclassify an event"),permission:"Manage Events",itemId:"classify",handler:function(d){var c=d.ownerCt.ownerCt.id;a(c)}}),reopen:new Zenoss.ActionButton({iconCls:"unacknowledge",tooltip:_t("Unacknowledge events"),permission:"Manage Events",itemId:"unacknowledge",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.reopen)}}),unclose:new Zenoss.ActionButton({iconCls:"reopen",tooltip:_t("Reopen events"),permission:"Manage Events",itemId:"reopen",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.reopen)}}),newwindow:new Zenoss.ActionButton({iconCls:"newwindow",permission:"View",tooltip:_t("Go to event console"),handler:function(g){var d=g.grid||this.ownerCt.ownerCt,k=Ext.state.Manager.get("evconsole")||{},f=k.filters||{},c=f.options||{},j=/devices\/([^\/]+)(\/.*\/([^\/]+)$)?/,h=d.view.getContext().match(j),l,e;if(h){c.device=h[1];if(h[3]){c.component=h[3]}}f.options=c;k.filters=f;l=encodeURIComponent(Zenoss.util.base64.encode(Ext.encode(k)));e="/zport/dmd/Events/evconsole?state="+l;window.open(e,"_newtab","")}}),refresh:new Zenoss.ActionButton({iconCls:"refresh",permission:"View",tooltip:_t("Refresh events"),handler:function(d){var c=d.grid||this.ownerCt.ownerCt;if(c.getComponent("event_panel")){c=c.getComponent("event_panel")}c.refresh()}})};Ext.define("Zenoss.model.EventType",{extend:"Ext.data.Model",idProperty:"id",fields:["id","event_type"]});Zenoss.EventConsoleTBar=Ext.extend(Zenoss.LargeToolbar,{constructor:function(e){var d=e.gridId,c=true,g=true,h,j=e.tbarItems||[],f=["acknowledge","close","reopen","unacknowledge","addNote"];if(!d){throw ("Event console tool bar did not receive a grid id")}h=[{id:"rowcolors_checkitem",xtype:"menucheckitem",text:_t("Show severity row colors"),handler:function(l){var m=l.checked;var k=Ext.getCmp(d);k.toggleRowColors(m)}},{id:"clearfilters",text:_t("Clear filters"),listeners:{click:function(){Ext.getCmp(d).clearFilters()}}},{text:_t("Restore defaults"),handler:function(){new Zenoss.dialog.SimpleMessageDialog({message:Ext.String.format(_t("Are you sure you want to restore the default configuration? All filters, column sizing, and column order will be lost.")),title:_t("Confirm Restore"),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){Ext.getCmp(d).resetGrid()}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}];if(!_global_permissions()["manage events"]){h.unshift({id:"excludenonactionables_checkitem",xtype:"menucheckitem",text:_t("Only show actionable events"),handler:function(l){var m=l.checked;var k=Ext.getCmp(d);var n=k.tbar;if(n&&n.getComponent){Ext.each(f,function(o){var p=n.getComponent(o);if(p){p.filtered=m;p.updateDisabled()}})}k.toggleNonActionables(m)}})}if(/^\/zport\/dmd\/Events/.test(window.location.pathname)){h.splice(2,0,{text:_t("Save this configuration..."),handler:function(){var k=Ext.getCmp(d),l=k.getPermalink();new Zenoss.dialog.ErrorDialog({message:Ext.String.format(_t('<div class="dialog-link">Drag this link to your bookmark bar <br/>to return to this configuration later.<br/><br/><a href="'+l+'">Resource Manager: Events</a></div>')),title:_t("Save Configuration")})}})}if(Ext.isDefined(e.actionsMenu)){c=e.actionsMenu}if(c){j.push({id:"event-actions-menu",text:_t("Actions"),xtype:"deviceactionmenu",deviceFetcher:function(){var m=Ext.getCmp(d),q=m.getSelectionModel(),p=q.getSelection(),k=[],l=Ext.Array.pluck,o=l(l(l(p,"data"),"device"),"uid"),n={uids:o,ranges:[],hashcheck:"none"};n.params=m.filterRow.getSearchValues();n.uids=Zenoss.util.filter(n.uids,function(r){return r});return n},saveHandler:Ext.emptyFn})}if(Ext.isDefined(e.commandsMenu)){g=e.commandsMenu}if(g){j.push({id:"event-commands-menu",text:_t("Commands"),hidden:!g,disabled:Zenoss.Security.doesNotHavePermission("Run Commands"),setContext:function(k){if(!k){k="/zport/dmd/Devices"}var l=Ext.getCmp("event-commands-menu"),m=l.menu;Zenoss.remote.DeviceRouter.getUserCommands({uid:k},function(n){m.removeAll();Ext.each(n,function(o){m.add({text:o.id,tooltip:o.description,handler:function(s){var u=s.text,p=Ext.getCmp(d),v=p.getSelectionModel(),r=v.getSelection(),q=Ext.Array.pluck(Ext.Array.pluck(Ext.Array.pluck(r,"data"),"device"),"uid");q=Zenoss.util.filter(q,function(w){return w});if(q.length){var t=new Zenoss.CommandWindow({uids:q,target:k+"/run_command",command:u});t.show()}}})})})},menu:{}})}this.gridId=d;if(!e.hideDisplayCombo){j.push("-");j.push(Ext.create("Ext.toolbar.TextItem",{hidden:e.hideDisplayCombo||false,text:_t("Display: ")}));j.push(Ext.create("Ext.form.ComboBox",{id:"history_combo",hidden:e.hideDisplayCombo||false,name:"event_display",queryMode:"local",store:new Ext.data.SimpleStore({model:"Zenoss.model.EventType",data:[[0,"Events"],[1,"Event Archive"]]}),displayField:"event_type",valueField:"id",width:120,value:0,triggerAction:"all",forceSelection:true,editable:false,listeners:{select:function(n){var l=n.value==1,k=Ext.getCmp(d),m=new Date();k.setStoreParameter("archive",l);if(l){m.setDate(m.getDate()-1);k.setFilter("lastTime",m)}else{k.setFilter("lastTime",null)}}}}))}if(e.newwindowBtn){j.push("-");j.push(Zenoss.events.EventPanelToolbarActions.newwindow)}Zenoss.EventActionManager.configure({onFinishAction:function(){var k=Ext.getCmp(d);if(Ext.get("event_panel")){k=Ext.getCmp("event_panel")}if(k){k.refresh()}},findParams:function(){var k=Ext.getCmp(d);if(Ext.get("event_panel")){k=Ext.getCmp("event_panel")}if(k){var l=k.getSelectionParameters();if(Zenoss.env.device_uid){l.uid=Zenoss.env.device_uid}return l}}});Ext.applyIf(e,{ref:"tbar",listeners:{beforerender:function(){var k=Ext.getCmp(d),l=this;if(l.getComponent){Ext.each(f,function(m){var n=l.getComponent(m);if(n){n.filtered=k.excludeNonActionables}})}},afterrender:function(){var n=Ext.getCmp(d),l=n.getStore(),o=this,k=n.getView();l.on("guaranteedrange",this.doLastUpdated);k.on("buffer",this.doLastUpdated);k.on("filterchange",function(){o.refreshmenu.setDisabled(!k.isValid());if(!k.isValid()){var p=Ext.getCmp("lastupdated");p.setText(_t(""))}});var m=Zenoss.env.device_uid||Zenoss.env.PARENT_CONTEXT;if(m=="/zport/dmd/Events"){m=location.pathname.replace("/viewEvents","")}this.setContext(m)},scope:this},items:Ext.Array.union([new Zenoss.ActionButton(Zenoss.events.EventPanelToolbarActions.acknowledge.initialConfig),new Zenoss.ActionButton(Zenoss.events.EventPanelToolbarActions.close.initialConfig),new Zenoss.ActionButton(Zenoss.events.EventPanelToolbarActions.reclassify.initialConfig),new Zenoss.ActionButton(Zenoss.events.EventPanelToolbarActions.reopen.initialConfig),new Zenoss.ActionButton(Zenoss.events.EventPanelToolbarActions.unclose.initialConfig),new Zenoss.ActionButton({iconCls:"addslide",tooltip:_t("Add Log"),permission:"Manage Events",itemId:"addNote",handler:function(n){var m=Ext.getCmp(d),q=m.getSelectionModel(),o=q.getSelection(),p=Ext.pluck(o,"data"),l=Ext.pluck(p,"evid"),k;k=Ext.create("Zenoss.dialog.BaseWindow",{title:_t("Add Note"),id:"addNoteWindow",layout:"fit",autoHeight:true,modal:true,width:310,plain:true,items:[{id:"addNoteForm",xtype:"form",defaults:{width:290},autoHeight:true,frame:false,fieldDefaults:{labelWidth:100},items:[{xtype:"textarea",name:"note",fieldLabel:_t("note"),allowBlank:false}],buttons:[{text:_t("Submit"),xtype:"DialogButton",formBind:true,handler:function(){var s=Ext.getCmp("addNoteForm"),r=s.getValues().note;Ext.each(l,function(t){Zenoss.remote.EventsRouter.write_log({evid:t,message:r})})}},{text:_t("Cancel"),xtype:"DialogButton",handler:function(){k.hide()}}]}]});k.show()}}),new Zenoss.ActionButton({iconCls:"add",tooltip:_t("Add an event"),permission:"Manage Events",handler:function(k){b(d)}}),{xtype:"tbseparator"},Zenoss.events.EventPanelToolbarSelectMenu,{text:_t("Export"),id:"export-button",menu:{items:[{text:"XML",handler:function(){var m=Zenoss.env.device_uid||Zenoss.env.PARENT_CONTEXT;if(m=="/zport/dmd/Events"){m=location.pathname.replace("/viewEvents","")}var l=Ext.getCmp(d),n=l.getState(),k=Ext.getCmp("history_combo"),o={type:"xml",isHistory:false,params:{uid:m,fields:Ext.Array.pluck(n.columns,"id"),sort:n.sort.property,dir:n.sort.direction,params:l.getExportParameters()}};if(k&&k.getValue()==1){o.isHistory=true}Ext.get("export_body").dom.value=Ext.encode(o);Ext.get("exportform").dom.submit()}},{text:"CSV",handler:function(){var m=Zenoss.env.device_uid||Zenoss.env.PARENT_CONTEXT;if(m=="/zport/dmd/Events"){m=location.pathname.replace("/viewEvents","")}var l=Ext.getCmp(d),n=Ext.getCmp(d).getState(),k=Ext.getCmp("history_combo"),o={type:"csv",params:{uid:m,fields:Ext.Array.pluck(n.columns,"id"),sort:n.sort.property,dir:n.sort.direction,params:l.getExportParameters()}};if(k&&k.getValue()==1){o.isHistory=true}Ext.get("export_body").dom.value=Ext.encode(o);Ext.get("exportform").dom.submit()}}]}},{text:_t("Configure"),id:"configure-button",menu:{items:h}},{xtype:"tbfill"},{id:"lastupdated",xtype:"tbtext",cls:"lastupdated",text:_t("Updating...")},{xtype:"refreshmenu",ref:"refreshmenu",id:"refresh-button",iconCls:"refresh",text:_t("Refresh"),handler:function(){var k=Ext.getCmp(d);if(k.isVisible(true)){k.refresh()}}}],j)});Zenoss.EventConsoleTBar.superclass.constructor.call(this,e)},doLastUpdated:function(){var e=Ext.getCmp("lastupdated"),d=new Date(),c=Ext.Date.format(d,"g:i:sA");e.setText(_t("Last updated at ")+c)},setContext:function(d){var c=Ext.getCmp("event-commands-menu");if(c){c.setContext(d)}}});Ext.define("Zenoss.EventPanelSelectionModel",{extend:"Zenoss.ExtraHooksSelectionModel",selectState:null,badIds:{},mode:"MULTI",constructor:function(c){this.callParent([c]);this.on("select",this.handleRowSelect,this);this.on("deselect",this.handleRowDeSelect,this);this.on("selectionchange",function(g){var d=["acknowledge","close","reopen","unacknowledge","classify","addNote"],f=!g.hasSelection()&&g.selectState!=="All",j=this.getGrid().tbar,h=Ext.getCmp("history_combo"),e=Ext.isDefined(h)?h.getValue()===1:false;if(e){j.getComponent("acknowledge").setDisabled(true);j.getComponent("close").setDisabled(true);j.getComponent("reopen").setDisabled(true);j.getComponent("unacknowledge").setDisabled(true);j.getComponent("classify").setDisabled(f)}else{if(j&&j.getComponent){Ext.each(d,function(k){if(j.getComponent(k)){j.getComponent(k).setDisabled(f)}})}}})},getGrid:function(){if(!Ext.isDefined(this.grid)){this.grid=Ext.getCmp(this.gridId)}return this.grid},handleRowSelect:function(e,c,d){if(c){delete this.badIds[c.get("evid")]}},handleRowDeSelect:function(e,c,d){if(this.selectState&&c){this.badIds[c.get("evid")]=1}},onStoreLoad:function(){var d=this.grid.getStore();if(this.selectState=="All"){this.suspendEvents();var c=Zenoss.util.filter(d.data.items,function(e){return(!this.badIds[e.get("evid")])},this);this.select(c,false,true);this.resumeEvents();this.fireEvent("selectionchange",this)}},selectEventState:function(f){var e=this,d=this.getGrid(),c=d.getStore();if(f==="All"){return this.selectAll(true)}this.clearSelections(true);this.suspendEvents();Ext.each(c.data.items,function(g){if(g){if(g.data.eventState==f){e.select(g,true)}}});this.selectState=f;this.resumeEvents();this.fireEvent("selectionchange",this)},clearSelectState:function(){this.selectState=null;this.grid.getStore().un("datachanged",this.onStoreLoad,this);this.grid.disableSavedSelection(false)},setSelectState:function(c){this.selectState=c;if(c==="All"){this.grid.getStore().on("datachanged",this.onStoreLoad,this);this.grid.disableSavedSelection(true)}},selectNone:function(){this.clearSelections(true);this.clearSelectState();this.fireEvent("selectionchange",this)},clearSelections:function(c){if(this.isLocked()||!this.grid){return}this.suspendEvents();if(!c){this.deselect(this.grid.getStore().data.items)}this.resumeEvents();this.fireEvent("selectionchange",this);this.badIds={};Zenoss.EventPanelSelectionModel.superclass.clearSelections.apply(this,arguments)}});Ext.define("Zenoss.EventsJsonReader",{extend:"Ext.data.reader.Json",alias:"reader.events",useSimpleAccessors:true,createAccessor:function(){return function(c){return function(d){return d[c]}}}()});Ext.define("Zenoss.events.Store",{extend:"Zenoss.DirectStore",constructor:function(c){c=c||{};Ext.applyIf(c,{model:"Zenoss.events.Model",initialSortColumn:"severity",initialSortDirection:"DESC",pageSize:Zenoss.settings.eventConsoleBufferSize,proxy:{type:"direct",simpleSortMode:true,directFn:c.directFn||Zenoss.remote.EventsRouter.query,reader:{type:"events",root:"events",totalProperty:"totalCount"}}});this.callParent(arguments)}});Zenoss.events.customColumns={};Zenoss.events.registerCustomColumn=function(c,d){Zenoss.events.customColumns[c]=d};Zenoss.events.eventFields=[];Zenoss.events.registerEventField=function(c){Zenoss.events.eventFields.push(c)};Ext.define("Zenoss.events.Grid",{extend:"Zenoss.FilterGridPanel",rowcolors:false,excludeNonActionables:false,constructor:function(c){c=c||{};c.viewConfig=c.viewConfig||{};Ext.applyIf(c.viewConfig,{getRowClass:Zenoss.events.getRowClass});this.callParent(arguments);this.on("itemclick",this.onItemClick,this);this.on("filterschanged",this.onFiltersChanged,this);this.excludeNonActionables=!_global_permissions()["manage events"]&&Ext.state.Manager.get("excludeNonActionables");this.getStore().autoLoad=true},initComponent:function(){this.getSelectionModel().grid=this;this.callParent(arguments);this.headerCt.on("columnhide",this.onColumnChange,this);this.headerCt.on("columnshow",this.onColumnChange,this)},onColumnChange:function(){if(!this.onColumnChangeTask){this.onColumnChangeTask=new Ext.util.DelayedTask(function(){this.refresh()},this)}this.onColumnChangeTask.delay(1000)},onItemClick:function(){this.getSelectionModel().clearSelectState()},listeners:{beforerender:function(){this.rowcolors=Ext.state.Manager.get("rowcolor");var c=Ext.getCmp("rowcolors_checkitem");if(c){c.setChecked(this.rowcolors)}var d=Ext.getCmp("excludenonactionables_checkitem");if(d){d.setChecked(this.excludeNonActionables)}}},applyOptions:function(){var c=this.getStore(),e,d=this.headerCt.getGridColumns();d=Zenoss.util.filter(d,function(f){return !f.hidden});e=Ext.Array.pluck(d,"dataIndex");e=Ext.Array.union(e,["evid","eventClass","eventClassKey","message"]);e=Ext.Array.union(e,Zenoss.events.eventFields);c.setBaseParam("keys",e);c.setParamsParam("excludeNonActionables",this.excludeNonActionables)},getSelectionParameters:function(){var g=this,j=g.getSelectionModel(),f=[],e,c=j.getSelection();if(Ext.isEmpty(c)){if(Ext.get("event_panel")){c=Ext.getCmp("event_panel").getSelectionModel().getSelection()}}var d=(j.selectState=="All");if(d){c=[]}else{Ext.each(c,function(k){f[f.length]=k.data.evid})}if(!d&&Ext.isEmpty(c)){return false}if(this.uid!="/zport/dmd"){e=this.uid}var h={evids:f,excludeIds:j.badIds,uid:e};Ext.apply(h,this.getUpdateParameters());return h},clearFilters:function(){this.filterRow.clearFilters()},onFiltersChanged:function(d,c){var e=d.getSelectionModel();e.clearSelections();e.clearSelectState()},getExportParameters:function(){var c=this.getSelectionParameters();if(c===false){c={evids:[],excludeIds:[]};Ext.apply(c,this.getUpdateParameters())}return c},getUpdateParameters:function(){var c={};c.params=this.filterRow.getSearchValues();c.params.excludeNonActionables=this.excludeNonActionables;return c},toggleRowColors:function(c){this.rowcolors=c;Ext.state.Manager.set("rowcolor",c);this.refresh()},toggleNonActionables:function(c){this.excludeNonActionables=c;Ext.state.Manager.set("excludeNonActionables",c);this.refresh()},clearURLState:function(){var c=Ext.urlDecode(window.location.search.replace(/^\?/,""));if(c.state){delete c.state;c=Ext.urlEncode(c);if(c){window.location.search="?"+Ext.urlEncode(c)}else{window.location.search=""}}},getPermalink:function(){var c=window.location,e=c.protocol+"//"+c.host+c.pathname+c.hash,d=Zenoss.util.base64.encode(Ext.encode(this.getState()));return e+"?state="+d},resetGrid:function(){Ext.state.Manager.clear(this.getItemId());this.clearFilters();Zenoss.remote.EventsRouter.column_config({},function(c){var g=[],d=this.getStore(),f=this,h=this.defaultFilters;Ext.each(c,function(j){g[g.length]=Ext.decode(j)});var e=g;this.reconfigure(null,e);f.filterRow.gridColumnMoveWithFilter();d.sort(d.sorters.get(0))},this)},updateRows:function(){this.refresh()}});Ext.define("Zenoss.SimpleEventGridPanel",{extend:"Zenoss.events.Grid",alias:["widget.SimpleEventGridPanel"],constructor:function(c){var d=c.id||Ext.id();c.viewConfig=c.viewConfig||{};Ext.applyIf(c.viewConfig,{getRowClass:Zenoss.events.getRowClass});Ext.applyIf(c,{id:"eventGrid"+d,stateId:Zenoss.env.EVENTSGRID_STATEID||"default_eventsgrid",enableDragDrop:false,stateful:true,rowSelectorDepth:5,store:Ext.create("Zenoss.events.Store",{}),appendGlob:true,selModel:new Zenoss.EventPanelSelectionModel({grid:this}),defaultFilters:{severity:[Zenoss.SEVERITY_CRITICAL,Zenoss.SEVERITY_ERROR,Zenoss.SEVERITY_WARNING,Zenoss.SEVERITY_INFO],eventState:[Zenoss.STATUS_NEW,Zenoss.STATUS_ACKNOWLEDGED]},viewConfig:{getRowClass:Zenoss.events.getRowClass}});Zenoss.SimpleEventGridPanel.superclass.constructor.call(this,c);this.on("itemdblclick",this.onRowDblClick,this)},onRowDblClick:function(d,c,h){var g=c.get("evid"),f="/zport/dmd/Events/viewDetail?evid="+g;window.open(f,g.replace(/-/g,"_"),"status=1,width=600,height=500,resizable=1")},initComponent:function(){this.callParent(arguments);this.addEvents("eventgridrefresh")},getState:function(){var c=Zenoss.SimpleEventGridPanel.superclass.getState.call(this);c.columns=Zenoss.util.filter(c.columns,function(d){return !d.hidden});return c},refresh:function(){this.callParent(arguments);this.fireEvent("eventgridrefresh",this)}});Zenoss.events.EventPanelToolbarSelectMenu={text:_t("Select"),id:"select-button",listeners:{afterrender:function(c){c.menu.items.items[0].setText(_t("Select All"))}},menu:{xtype:"menu",items:[{text:_t("All"),handler:function(){var c=Ext.getCmp("select-button").ownerCt.ownerCt,d=c.getSelectionModel();d.selectEventState("All");d.setSelectState("All")}},{text:"None",handler:function(){var c=Ext.getCmp("select-button").ownerCt.ownerCt,d=c.getSelectionModel();d.clearSelections();d.clearSelectState()}}]}};Ext.define("Zenoss.EventGridPanel",{extend:"Zenoss.SimpleEventGridPanel",alias:["widget.EventGridPanel"],border:false,constructor:function(c){Ext.applyIf(c,{tbar:new Zenoss.EventConsoleTBar({gridId:c.id,actionsMenu:c.actionsMenu,commandsMenu:c.commandsMenu})});Zenoss.EventGridPanel.superclass.constructor.call(this,c)},onRowDblClick:function(d,c,k){var g=c.get("evid"),j=Ext.getCmp("history_combo"),h=(j.getValue()=="1")?"History":"",f="/zport/dmd/Events/view"+h+"Detail?evid="+g;window.open(f,g.replace(/-/g,"_"),"status=1,width=600,height=500,resizable=1")},setContext:function(c){Zenoss.EventGridPanel.superclass.setContext.call(this,c);var d=this.getDockedItems("toolbar")[0];if(d&&Ext.isDefined(d.setContext)){d.setContext(c)}}});Ext.define("Zenoss.EventRainbow",{extend:"Ext.toolbar.TextItem",alias:["widget.eventrainbow"],constructor:function(c){var d={critical:{count:0,acknowledged_count:0},error:{count:0,acknowledged_count:0},warning:{count:0,acknowledged_count:0},info:{count:0,acknowledged_count:0},debug:{count:0,acknowledged_count:0},clear:{count:0,acknowledged_count:0}};c=Ext.applyIf(c||{},{height:45,directFn:Zenoss.util.isolatedRequest(Zenoss.remote.DeviceRouter.getInfo),text:Zenoss.render.events(d,c.count||3)});Zenoss.EventRainbow.superclass.constructor.call(this,c)},setContext:function(c){if(c){this.uid=c;this.refresh()}},refresh:function(){this.directFn({uid:this.uid,keys:["events"]},function(c){if(Zenoss.env.contextUid&&Zenoss.env.contextUid!=this.uid){return}this.updateRainbow(c.data.events)},this)},updateRainbow:function(c){this.setText(Zenoss.render.events(c,this.count))}})})();(function(){Ext.ns("Zenoss");Ext.define("Zenoss.InstanceModel",{extend:"Ext.data.Model",idProperty:"uid",fields:[{name:"device"},{name:"name"},{name:"description"},{name:"minProcessCount"},{name:"maxProcessCount"},{name:"monitored"},{name:"pingStatus"}]});Ext.define("Zenoss.InstanceStore",{extend:"Zenoss.DirectStore",alias:["widget.InstanceStore"],constructor:function(a){Ext.applyIf(a,{model:"Zenoss.InstanceModel",root:"data",initialSortColumn:"name"});this.callParent(arguments)}});Ext.define("Zenoss.SimpleInstanceGridPanel",{extend:"Zenoss.BaseGridPanel",alias:["widget.SimpleInstanceGridPanel"],constructor:function(a){var b=[{id:"instanceName",dataIndex:a.nameDataIndex||"name",header:_t("Name"),flex:0.25,width:400},{id:"device",dataIndex:"device",flex:0.75,header:_t("Device"),width:200,sortable:false,renderer:function(d,e,c){return Zenoss.render.link(d.uid,undefined,d.name)}},{dataIndex:"minProcessCount",header:_t("Min Threshold"),width:85,sortable:false,hidden:!a.showProcessCount},{dataIndex:"maxProcessCount",header:_t("Max Threshold"),width:85,sortable:false,hidden:!a.showProcessCount},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),width:70,sortable:false},{id:"status",dataIndex:"pingStatus",header:_t("Status"),renderer:Zenoss.render.pingStatus,width:60,sortable:false}];Ext.applyIf(a,{columns:a.columns||b,store:a.store||Ext.create("Zenoss.InstanceStore",{directFn:a.directFn,pageSize:a.pageSize}),selModel:a.sm||Ext.create("Zenoss.ExtraHooksSelectionModel",{mode:"SINGLE"})});this.callParent(arguments)}});Ext.define("Zenoss.SimpleCardPanel",{extend:"Ext.Panel",alias:["widget.simplecardpanel"],constructor:function(a){this.contextUid=null;var b=this;Ext.applyIf(a,{layout:"card",activeItem:0,placeholder:{},height:Math.min(((Ext.getCmp("viewport").getHeight()-75)/5)+30,200),tbar:{xtype:"consolebar",centerPanel:"detail_panel",title:_t("Display: "),parentPanel:this,leftItems:[{xtype:"select",ref:"../displaySelect",queryMode:"local",value:a.instancesTitle,store:[a.instancesTitle,_t("Configuration Properties")],listeners:{select:function(e,c){var d=c[0].index;this.layout.setActiveItem(d)},scope:this}}]},items:[a.instances,{xtype:"configpropertypanel",id:"config_property_panel",ref:"zPropertyEdit",displayFilters:false,viewName:"zPropertyEdit",listeners:a.zPropertyEditListeners}]});this.callParent(arguments)},setContext:function(a){this.contextUid=a;if(!this.collapsed){this.loadInstances(a)}},loadInstances:function(){if(!this.contextUid){return}var a=this.contextUid;this.items.each(function(b){b.setContext(a)});this.contextUid=null}});Ext.define("Zenoss.InstanceCardPanel",{extend:"Zenoss.SimpleCardPanel",alias:["widget.instancecardpanel"],constructor:function(b){var a=b.gridId||Ext.id();Ext.applyIf(b,{instances:{xtype:"SimpleInstanceGridPanel",id:a,bufferSize:b.bufferSize,nearLimit:b.nearLimit,directFn:b.router.getInstances,nameDataIndex:b.nameDataIndex||"name",columns:b.columns,sm:b.sm,store:b.store,showProcessCount:b.showProcessCount}});this.callParent(arguments);this.gridId=a},getInstancesGrid:function(){return Ext.getCmp(this.gridId)}})})();(function(){Ext.ns("Zenoss");Ext.define("Zenoss.ViewButton",{extend:"Ext.Button",alias:["widget.ViewButton"],constructor:function(c){var b={enableToggle:true,toggleGroup:"CardButtonPanel",allowDepress:false};var a=Ext.apply(b,c);Zenoss.ViewButton.superclass.constructor.call(this,a)}});Ext.define("Zenoss.CardButtonPanel",{extend:"Ext.Panel",alias:["widget.CardButtonPanel"],constructor:function(a){function b(f,e){return function(g,h){if(h){f.fireEvent("cardchange",e);f.getLayout().setActiveItem(e.id)}}}function c(g){var f=g.getDockedItems("toolbar")[0];for(var e=0;e<g.items.getCount();++e){var h=g.items.get(e);if(h instanceof Ext.Panel){f.add({xtype:"ViewButton",id:"button_"+h.id,text:Ext.clean(h.buttonTitle,h.title,"Undefined"),pressed:(h==g.layout.activeItem),iconCls:h.iconCls,toggleHandler:b(g,h)})}}}function d(f,g,e){}Ext.applyIf(a,{id:"cardPanel",layout:"card",activeItem:0});Ext.apply(a,{header:false,tbar:[{xtype:"tbtext",text:_t("View: ")}]});this.addEvents("cardchange");this.on("afterrender",c,this);this.listeners=a.listeners;Zenoss.CardButtonPanel.superclass.constructor.call(this,a)}})})();(function(){Ext.ns("Zenoss");var a=Ext.layout.CardLayout.prototype.setActiveItem;var b=Ext.layout.CardLayout.prototype.initEvents;Ext.override(Ext.layout.CardLayout,{initEvents:function(){b.apply(this,arguments);this.owner.addEvents("cardchange")},setActiveItem:function(c){a.apply(this,arguments);this.owner.fireEvent("cardchange",this.owner,c)}});Ext.define("Zenoss.ContextCardPanel",{extend:"Ext.Panel",alias:["widget.contextcardpanel"],contextUid:null,constructor:function(c){Ext.applyIf(c,{layout:{type:"card",deferredRender:true}});Zenoss.ContextCardPanel.superclass.constructor.call(this,c);this.on("cardchange",this.cardChangeHandler,this)},setContext:function(c){this.contextUid=c;this.cardChangeHandler(this.layout.activeItem)},cardChangeHandler:function(c){if(c!=this&&c.setContext){c.setContext(this.contextUid)}}})})();(function(){var b,c,a;b=Zenoss.remote.TemplateRouter;c="templateTree";Ext.ns("Zenoss","Zenoss.templates");Zenoss.templates.templateView="template";Zenoss.templates.deviceClassView="deviceClass";a=function(d){new Zenoss.HideFormDialog({id:"addTemplateDialog",title:_t("Add Monitoring Template"),items:{xtype:"textfield",id:"idTextfield",fieldLabel:_t("Name"),allowBlank:false},listeners:{hide:function(e){Ext.getCmp("idTextfield").setValue("")}},buttons:[{xtype:"HideDialogButton",text:_t("Submit"),handler:function(e,f){var g=Ext.getCmp("idTextfield").getValue();d.addTemplate(g)}},{xtype:"HideDialogButton",text:_t("Cancel")}]});new Zenoss.MessageDialog({id:"deleteNodeDialog",title:_t("Delete Tree Node"),message:_t("The selected node will be deleted."),okHandler:function(){d.deleteTemplate()}})};Ext.ns("Zenoss");Ext.define("Zenoss.TemplateTreePanel",{alias:["widget.TemplateTreePanel"],extend:"Zenoss.HierarchyTreePanel",constructor:function(e){var f=e.currentView,d=b.getTemplates;if(f==Zenoss.templates.deviceClassView){d=b.getDeviceClassTemplates}this.currentView=f;Ext.applyIf(e,{id:c,rootVisible:false,autoScroll:true,containerScroll:true,useArrows:true,searchField:true,loadMask:true,router:b,cls:"x-tree-noicon",idProperty:"id",directFn:d,nodeName:"Templates",root:{id:"root",uid:"/zport/dmd/Devices",text:_t("Templates")}});this.callParent(arguments);a(this);this.on("buttonClick",this.buttonClickHandler,this)},buttonClickHandler:function(d){switch(d){case"addButton":Ext.getCmp("addTemplateDialog").show();break;case"deleteButton":Ext.getCmp("deleteNodeDialog").show();break;default:break}},addTemplate:function(k){var e,f,h,d,g;e=this.getRootNode();f=e.data.uid;h={contextUid:f,id:k};d=this;function j(p,n){var l,q,o,m;l=n.result;if(l.success){q=n.result.nodeConfig;o=d.getLoader().createNode(q);e.appendChild(o);o.expand();m=o.childNodes[0];m.select()}else{Ext.Msg.alert("Error",l.msg)}}b.addTemplate(h,j)},deleteTemplate:function(){var e,f,d;e=this.getSelectionModel().getSelectedNode();f={uid:e.data.uid};d=this;function g(j,h){d.getRootNode().reload()}b.deleteTemplate(f,g)},createDeepLinkPath:function(d){var e;if(this.currentView!=Zenoss.templates.deviceClassView){e=this.id+Ext.History.DELIMITER+d.data.uid}else{e=this.id+Ext.History.DELIMITER+d.get("id")}return e},onExpandnode:function(d){if(!this.searchField.getValue()&&!Ext.History.getToken()){if(d===this.getRootNode()){d.childNodes[0].expand()}else{d.childNodes[0].select()}}},selectByToken:function(d){if(this.currentView==Zenoss.templates.deviceClassView){this.callParent([unescape(d.replace(/\//g,"."))])}else{this.templateViewSelectByToken(d)}},getFilterFn:function(f){if(this.currentView!=Zenoss.templates.deviceClassView){var e=new RegExp(Ext.String.escapeRegex(f),"i");var d=function(g){return e.test(g.get("id"))};return d}return this.callParent(arguments)},addHistoryToken:function(d,e){Ext.History.add(this.id+Ext.History.DELIMITER+e.get("uid"))},templateViewSelectByToken:function(e){var d=this.getRootNode(),f=Ext.bind(function(){var l,k,h,g,n,m,j;if(e.search("/rrdTemplates/")!=-1){l=unescape(e).split("/rrdTemplates/");k=l[0].split("/");h=l[1].split("/");g=h[0]}else{k=e.replace("/devices/","/").split("/");g=k.pop()}if(k.length===4){n="Devices"}else{n=k.slice(4).join(".")}m=Ext.String.format("/root/{0}/{0}..{1}",g,n);this.selectPath(m)},this);if(!d.isLoaded()){d.on("expand",f,this,{single:true})}else{f()}},manualSelect:function(f,d){var e=this;var g=function(j,h){if(!j){e.getRootNode().eachChild(function(k){if(d==k.data.id){k.eachChild(function(l){if(f==l.data.uid){l.select();return false}});return false}})}};return g}})})();(function(){var a=Ext.ns("Zenoss.devices");Ext.define("Zenoss.form.SmartCombo",{extend:"Ext.form.ComboBox",alias:["widget.smartcombo"],constructor:function(b){b=Ext.applyIf(b||{},{queryMode:b.autoLoad!==false?"local":"remote",store:new Zenoss.NonPaginatedStore({directFn:b.directFn,root:b.root||"data",model:b.model||"Zenoss.model.NameValue",initialSortColumn:b.initialSortColumn||"name"}),valueField:"value",displayField:"name",forceSelection:true,editable:false,autoSelect:true,selectOnFocus:false,triggerAction:"all"});this.callParent([b]);if(this.autoLoad!==false){this.getStore().load()}},getValue:function(){return this.callParent(arguments)||this.getRawValue()},getStore:function(){return this.store}});Ext.define("Zenoss.model.ValueIntModel",{extend:"Ext.data.Model",idProperty:"name",fields:[{name:"name",type:"string"},{name:"value",type:"int"}]});Ext.define("Zenoss.devices.PriorityCombo",{extend:"Zenoss.form.SmartCombo",alias:["widget.PriorityCombo"],constructor:function(b){b=Ext.apply(b||{},{directFn:Zenoss.remote.DeviceRouter.getPriorities,cls:"prioritycombo",model:"Zenoss.model.ValueIntModel"});this.callParent([b])},getValue:function(){var b=this.callParent(arguments);if(Ext.isString(b)){Zenoss.env.initPriorities();Ext.each(Zenoss.env.PRIORITIES,function(c){if(c.name===b){b=c.value;return false}})}return b}});Ext.define("Zenoss.devices.DevicePriorityMultiselectMenu",{extend:"Zenoss.MultiselectMenu",alias:["widget.multiselect-devicepriority"],constructor:function(b){b=Ext.apply(b||{},{text:"...",cls:"x-btn x-btn-default-toolbar-small",source:Zenoss.env.priorities,defaultValues:[]});a.DevicePriorityMultiselectMenu.superclass.constructor.call(this,b)}});Ext.define("Zenoss.devices.ProductionStateCombo",{extend:"Zenoss.form.SmartCombo",alias:["widget.ProductionStateCombo"],constructor:function(b){b=Ext.apply(b||{},{directFn:Zenoss.remote.DeviceRouter.getProductionStates,model:"Zenoss.model.ValueIntModel"});this.callParent([b])}});Ext.define("Zenoss.devices.ProductionStateMultiselectMenu",{extend:"Zenoss.MultiselectMenu",alias:["widget.multiselect-prodstate"],constructor:function(b){var c=[];if(Ext.isDefined(Zenoss.env.PRODUCTION_STATES)){c.Array=Ext.pluck(Zenoss.env.PRODUCTION_STATES,"value")}b=Ext.apply(b||{},{text:"...",cls:"x-btn x-btn-default-toolbar-small",source:Zenoss.env.productionStates,defaultValues:c});this.callParent([b])}});Ext.define("Zenoss.devices.ManufacturerDataStore",{extend:"Zenoss.NonPaginatedStore",constructor:function(c){c=c||{};var b=c.router||Zenoss.remote.DeviceRouter;Ext.applyIf(c,{root:"manufacturers",totalProperty:"totalCount",initialSortColumn:"name",model:"Zenoss.model.Name",directFn:b.getManufacturerNames});this.callParent([c])}});Ext.define("Zenoss.devices.OSProductDataStore",{extend:"Zenoss.NonPaginatedStore",constructor:function(c){c=c||{};var b=c.router||Zenoss.remote.DeviceRouter;Ext.applyIf(c,{root:"productNames",totalProperty:"totalCount",model:"Zenoss.model.Name",initialSortColumn:"name",directFn:b.getOSProductNames});this.callParent([c])}});Ext.define("Zenoss.devices.HWProductDataStore",{extend:"Zenoss.NonPaginatedStore",constructor:function(c){c=c||{};var b=c.router||Zenoss.remote.DeviceRouter;Ext.applyIf(c,{root:"productNames",totalProperty:"totalCount",model:"Zenoss.model.Name",initialSortColumn:"name",directFn:b.getHardwareProductNames});this.callParent([c])}});Ext.define("Zenoss.devices.ManufacturerCombo",{extend:"Zenoss.form.SmartCombo",alias:["widget.manufacturercombo"],constructor:function(c){var b=(c||{}).store||new a.ManufacturerDataStore();c=Ext.applyIf(c||{},{store:b,width:160,displayField:"name",valueField:"name"});this.callParent([c])}});Ext.define("Zenoss.devices.ProductCombo",{extend:"Zenoss.form.SmartCombo",alias:["widget.productcombo"],constructor:function(d){var e=d.manufacturer||"",c=d.prodType||"OS",b=(d||{}).store||c=="OS"?new a.OSProductDataStore():new a.HWProductDataStore();b.setBaseParam("manufacturer",e);d=Ext.applyIf(d||{},{store:b,displayField:"name",valueField:"name",width:160,queryMode:"remote"});this.callParent([d])}})}());(function(){var a,m,s,l,b,p,k,e,c,d;Ext.ns("Zenoss");a=Zenoss.remote.TemplateRouter;m="dataSourceTreeGrid";s="graphGrid";k="editDataSource";e="templateTree";function f(){return Ext.getCmp(m).getSelectionModel().getSelectedNode()}l=function(x,w){x.clearValue();x.getStore().setBaseParam("uid",w);delete x.lastQuery;x.doQuery(x.allQuery,true)};b=function(w,z){var x,y;x={dataPointUid:w,graphUid:z};y=function(B,A){Ext.getCmp(s).refresh()};a.addDataPointToGraph(x,y)};Ext.define("Zenoss.GraphModel",{extend:"Ext.data.Model",idProperty:"uid",fields:["uid","name","graphPoints","units","height","width","sequence"]});Ext.define("Zenoss.GraphStore",{extend:"Zenoss.NonPaginatedStore",alias:["widget.graphstore"],constructor:function(w){Ext.applyIf(w,{root:"data",directFn:a.getGraphs,model:"Zenoss.GraphModel"});this.callParent(arguments)}});p=function(){var x,C,z,y,B,w,A;x=Ext.getCmp("templateTree").getSelectionModel();C=x.getSelectedNode().data.uid;z=Ext.getCmp(m).getSelectionModel();y=z.getSelectedNode();if(y&&y.isLeaf()){B=y.data.name;w="<div>Data Point</div>";w+="<div>"+B+"</div><br/>";Ext.create("Zenoss.dialog.BaseWindow",{id:"addToGraphDialog",width:400,height:250,title:_t("Add Data Point to Graph"),items:[{xtype:"panel",id:"addToGraphMetricPanel"},{xtype:"combo",id:"graphCombo",fieldLabel:_t("Graph"),displayField:"name",valueField:"uid",width:300,minChars:999,resizeable:true,editable:false,emptyText:"Select a graph...",store:new Zenoss.GraphStore({}),listeners:{select:function(){Ext.getCmp("addToGraphDialog").submit.enable()}}}],buttons:[{xtype:"DialogButton",ref:"../submit",text:_t("Submit"),disabled:true,handler:function(E,G){var F,D,H;F=Ext.getCmp(m).getSelectionModel().getSelectedNode();D=F.data.uid;H=Ext.getCmp("graphCombo").getValue();b(D,H)}},{xtype:"DialogButton",text:_t("Cancel")}]}).show();Ext.getCmp("addToGraphMetricPanel").body.update(w);A=Ext.getCmp("graphCombo");l(A,C);Ext.getCmp("addToGraphDialog").submit.disable()}else{new Zenoss.dialog.ErrorDialog({message:_t("You must select a Data Point.")})}};function n(w){var x=Ext.getCmp(m);if(w){x.refresh(function(){x.getRootNode().cascade(function(y){if(y.data.id==w){y.expand();y.select()}})})}else{x.refresh()}}function v(){var x=Ext.getCmp(m),z=x.getSelectionModel().getSelectedNode(),y,w;if(z.data.leaf){z=z.parentNode}y={name:Ext.getCmp("metricName").getValue(),dataSourceUid:z.data.uid};w=z.data.id;function A(){n(w)}return a.addDataPoint(y,A)}function u(){var w=Ext.getCmp(m),x=w.getSelectionModel().getSelectedNode();if(!x){new Zenoss.dialog.ErrorDialog({message:_t("You must select data source.")});return}Ext.create("Zenoss.dialog.BaseWindow",{id:"addDataPointDialog",title:_t("Add Data Point"),height:160,width:310,listeners:{hide:function(){Ext.getCmp("metricName").setValue(null);Ext.getCmp("metricName").clearInvalid()},validitychange:function(y,z){Ext.getCmp("addDataPointDialog").query("DialogButton")[0].setDisabled(!z)}},items:{xtype:"form",buttonAlign:"left",items:[{xtype:"idfield",id:"metricName",fieldLabel:_t("Name"),allowBlank:false,blankText:_t("Name is a required field")}],buttons:[{xtype:"DialogButton",text:_t("Submit"),formBind:true,handler:v},{xtype:"DialogButton",text:_t("Cancel")}]}}).show()}function t(){var w=Ext.getCmp(e),y=w.getSelectionModel().getSelectedNode(),x={name:Ext.getCmp("dataSourceName").getValue(),type:Ext.getCmp("dataSourceTypeCombo").getValue(),templateUid:y.data.uid};return a.addDataSource(x,n)}Ext.define("Zenoss.templates.DataSourceTypeModel",{extend:"Ext.data.Model",idProperty:"type",fields:[{name:"type"}]});function j(){var w=Ext.getCmp(e),x=w.getSelectionModel().getSelectedNode();if(!x){new Zenoss.dialog.ErrorDialog({message:_t("You must select a template.")});return}Ext.create("Zenoss.dialog.BaseWindow",{id:"addDataSourceDialog",title:_t("Add Data Source"),height:180,width:350,listeners:{hide:function(){Ext.getCmp("dataSourceTypeCombo").setValue("SNMP");Ext.getCmp("dataSourceName").setValue("");Ext.getCmp("dataSourceName").clearInvalid()}},items:{xtype:"form",buttonAlign:"left",listeners:{validitychange:function(y,z){if(z){Ext.getCmp("addDataSourceDialog").query("button")[0].enable()}else{Ext.getCmp("addDataSourceDialog").query("button")[0].disable()}}},items:[{xtype:"idfield",id:"dataSourceName",fieldLabel:_t("Name"),allowBlank:false,blankText:_t("Name is a required field")},{xtype:"combo",id:"dataSourceTypeCombo",allowBlank:false,displayField:"type",fieldLabel:_t("Type"),editable:false,value:"SNMP",triggerAction:"all",store:{type:"directcombo",model:"Zenoss.templates.DataSourceTypeModel",root:"data",directFn:a.getDataSourceTypes}}],buttons:[{xtype:"DialogButton",disabled:true,text:_t("Submit"),handler:function(){t()}},Zenoss.dialog.CANCEL]}}).show()}function q(){var z,w,y,x;if(f()){z=_t("Are you sure you want to remove {0}? There is no undo.");w=f().data.name;y=Ext.String.format(z,w);x=Ext.getCmp("deleteDataSourceDialog");x.setText(y);x.show()}else{new Zenoss.dialog.ErrorDialog({message:_t("You must select a Data Source or Data Point.")})}}new Zenoss.MessageDialog({id:"deleteDataSourceDialog",title:_t("Delete"),okHandler:function(){var y,x=f(),w;y={uid:f().get("uid")};if(f().data.leaf){w=x.parentNode.data.id;function z(){n(w)}a.deleteDataPoint(y,z)}else{a.deleteDataSource(y,n)}}});function h(w){var x=Ext.getCmp(k);n(d);if(x){x.hide()}}function g(){var y=Ext.getCmp(k),w=y.editForm.form.getValues(),A,x,z;x=w.testDevice;A=new Zenoss.CommandWindow({uids:x,title:_t("Test Data Source"),data:w,target:w.uid+"/test_datasource"});A.show()}function r(x,z){var w=Ext.getCmp(k).query("alias"),y;if(w.length<1){throw"The DataPoint form does not have an alias field, it should have only one"}y=w[0];x.aliases=y.getValue();a.setInfo(x,z)}function o(){var x=Ext.getCmp(m),A=x.getSelectionModel().getSelectedNode(),z,w=false,B,y;if(!A){new Zenoss.dialog.ErrorDialog({message:_t("You must select a Data Source or Data Point.")});return}z=A.data;if(z.leaf){w=true;d=A.parentNode.data.id}else{d=z.id}B={uid:z.uid};function C(D){var F,E={};E.record=D.record;E.items=D.form;E.id=k;E.isDataPoint=w;E.title=_t("Edit Data Source");E.directFn=a.setInfo;E.width=800;if(w){E.title=_t("Edit Data Point");E.directFn=r;E.singleColumn=true}else{if(E.record.testable&&Zenoss.Security.hasPermission("Change Device")){E.items.items.push({xtype:"panel",columnWidth:0.5,baseCls:"test-against-device",hidden:Zenoss.Security.doesNotHavePermission("Run Commands"),title:_t("Test Against a Device"),items:[{xtype:"textfield",fieldLabel:_t("Device Name"),id:"testDevice",width:300,name:"testDevice"},{xtype:"hidden",name:"uid",value:D.record.id},{xtype:"button",text:_t("Test"),id:"testDeviceButton",handler:g}]})}}E.saveHandler=h;F=new Zenoss.form.DataSourceEditDialog(E);var G=F.editForm.form.findField("commandTemplate");if(G!=null){G.addListener("dirtychange",function(I,J){Ext.getCmp("testDeviceButton").disable();var H=Ext.getCmp("testDevice");H.setValue(_t("Save and reopen this dialog to test."));H.disable()})}F.show()}if(w){a.getDataPointDetails(B,C)}else{a.getDataSourceDetails(B,C)}}c=new Ext.menu.Menu({id:"dataSourceMenu",items:[{xtype:"menuitem",text:_t("Add Data Point To Graph"),disable:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:p},{xtype:"menuitem",text:_t("Add Data Point"),disable:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:u},{xtype:"menuitem",text:_t("View and Edit Details"),disable:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:o}]});Ext.define("Zenoss.templates.DataSourceModel",{extend:"Ext.data.Model",idProperty:"uid",fields:[{name:"uid"},{name:"name"},{name:"source"},{name:"enabled"},{name:"type"}]});Ext.define("Zenoss.templates.DataSourceStore",{extend:"Ext.data.TreeStore",constructor:function(w){w=w||{};Ext.applyIf(w,{model:"Zenoss.templates.DataSourceModel",nodeParam:"uid",remoteSort:false,proxy:{limitParam:undefined,startParam:undefined,pageParam:undefined,sortParam:undefined,type:"direct",directFn:a.getDataSources,reader:{root:"data",totalProperty:"count"}}});this.callParent(arguments)}});Ext.define("Zenoss.DataSourceTreeGrid",{extend:"Ext.tree.Panel",alias:["widget.DataSourceTreeGrid"],constructor:function(w){Ext.applyIf(w,{useArrows:true,cls:"x-tree-noicon",rootVisible:false,id:m,title:_t("Data Sources"),listeners:{beforeitemdblclick:o},store:Ext.create("Zenoss.templates.DataSourceStore",{}),tbar:[{xtype:"button",iconCls:"add",id:"datasourceAddButton",ref:"../addButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:j,listeners:{render:function(){Zenoss.registerTooltipFor("datasourceAddButton")}}},{xtype:"button",iconCls:"delete",ref:"../deleteButton",id:"datasourceDeleteButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),listeners:{render:function(){Zenoss.registerTooltipFor("datasourceDeleteButton")}},handler:q},{xtype:"button",id:"datasourceEditButton",iconCls:"customize",ref:"../customizeButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),listeners:{render:function(){Zenoss.registerTooltipFor("datasourceEditButton")}},menu:"dataSourceMenu"}],columns:[{xtype:"treecolumn",text:"Name",flex:2,sortable:true,dataIndex:"name"},{dataIndex:"source",flex:1,header:"Source",width:250},{dataIndex:"enabled",header:"Enabled",width:60},{dataIndex:"type",header:"Type",width:90}],selModel:Ext.create("Zenoss.TreeSelectionModel",{mode:"SINGLE"})});this.callParent(arguments)},disableToolBarButtons:function(w){this.addButton.setDisabled(w&&Zenoss.Security.hasPermission("Manage DMD"));this.deleteButton.setDisabled(w&&Zenoss.Security.hasPermission("Manage DMD"));this.customizeButton.setDisabled(w&&Zenoss.Security.hasPermission("Manage DMD"))},setContext:function(w){if(w!==this.uid){this.uid=w;this.refresh()}},refresh:function(y,x){var w=this.getRootNode();w.setId(this.uid);w.data.uid=this.uid;w.uid=this.uid;if(y){this.getStore().load({callback:y,scope:x||this})}else{this.getStore().load()}}})})();(function(){Ext.namespace("Zenoss.templates");var c,e,d;Zenoss.templates.thresholdsId="thresholdGrid";d="dataSourceTreeGrid";c=Zenoss.remote.TemplateRouter;e="templateTree";function b(l,h){var g,j,k,m,n;g=h.getTemplateUid();if(Ext.getCmp(d)){j=Ext.getCmp(d).getSelectionModel().getSelectedNode()}if(j&&j.isLeaf()){k=[j.data.uid]}else{k=[]}m={uid:g,thresholdType:l.thresholdTypeField,thresholdId:l.thresholdIdField,dataPoints:k};n=function(p,o){h.refresh()};Zenoss.remote.TemplateRouter.addThreshold(m,n)}function a(g){if(!g.getTemplateUid()){return}var h=Ext.create("Zenoss.dialog.BaseWindow",{id:"addThresholdDialog",title:_t("Add Threshold"),message:_t("Allow the user to add a threshold."),width:295,height:250,modal:true,padding:10,listeners:{show:function(){this.formPanel.getForm().reset()}},buttons:[{ref:"../submitButton",text:_t("Add"),disabled:true,xtype:"DialogButton",handler:function(k){var l,j;l=k.refOwner;j=l.formPanel.getForm();b(j.getValues(),g)}},{ref:"../cancelButton",text:_t("Cancel"),xtype:"DialogButton"}],items:{xtype:"form",ref:"formPanel",height:75,leftAlign:"top",monitorValid:true,paramsAsHash:true,listeners:{validitychange:function(j,k){h.submitButton.setDisabled(!k)}},items:[{name:"thresholdIdField",xtype:"idfield",fieldLabel:_t("Name"),allowBlank:false},{name:"thresholdTypeField",xtype:"combo",fieldLabel:_t("Type"),displayField:"type",forceSelection:true,triggerAction:"all",emptyText:_t("Select a type..."),selectOnFocus:true,allowBlank:false,store:{type:"directcombo",autoLoad:true,directFn:Zenoss.remote.TemplateRouter.getThresholdTypes,root:"data",fields:["type"]}}]}});h.show()}function f(j){var g=j.getSelectionModel().getSelected(),h={};function k(l){var m=Ext.create("Zenoss.form.DataSourceEditDialog",{record:l.record,items:l.form,singleColumn:true,width:650,xtype:"datasourceeditdialog",title:_t("Edit Threshold"),directFn:c.setInfo,id:"editThresholdDialog",saveHandler:function(n){j.refresh();if(m){m.hide()}}});m.show()}c.getThresholdDetails({uid:g.data.uid},k)}Ext.define("Zenoss.thresholds.Model",{extend:"Ext.data.Model",idProperty:"uid",fields:["name","type","dataPoints","severity","enabled","type","minval","maxval","uid"]});Ext.define("Zenoss.thresholds.Store",{extend:"Zenoss.NonPaginatedStore",constructor:function(g){g=g||{};Ext.applyIf(g,{model:"Zenoss.thresholds.Model",directFn:c.getThresholds,root:"data"});this.callParent(arguments)}});Ext.define("Zenoss.templates.thresholdDataGrid",{alias:["widget.thresholddatagrid"],extend:"Zenoss.ContextGridPanel",constructor:function(g){var h={},j=this,k=g.tbarItems||[];h=Ext.apply(h,{itemdblclick:function(l){f(l)}});g=g||{};Ext.applyIf(g,{id:Zenoss.templates.thresholdsId,selModel:new Zenoss.SingleRowSelectionModel({listeners:{select:function(l,n,m){if(Zenoss.Security.hasPermission("Manage DMD")){j.deleteButton.enable();j.editButton.enable()}}}}),title:_t("Thresholds"),store:Ext.create("Zenoss.thresholds.Store",{}),listeners:h,tbar:k.concat([{xtype:"button",iconCls:"add",id:"thresholdAddButton",ref:"../addButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:function(l){a(l.refOwner)},listeners:{render:function(){Zenoss.registerTooltipFor("thresholdAddButton")}}},{ref:"../deleteButton",id:"thresholdDeleteButton",xtype:"button",iconCls:"delete",disabled:true,handler:function(m){var o=j.getSelectionModel().getSelected(),l,n;if(o){l=o.get("uid");new Zenoss.dialog.SimpleMessageDialog({title:_t("Delete Threshold"),message:Ext.String.format(_t("Are you sure you want to delete this threshold? There is no undo.")),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){n={uid:l};c.removeThreshold(n,function(){j.refresh();j.deleteButton.disable();j.editButton.disable()})}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}},listeners:{render:function(){Zenoss.registerTooltipFor("thresholdDeleteButton")}}},{id:"thresholdEditButton",ref:"../editButton",xtype:"button",iconCls:"customize",disabled:true,handler:function(l){f(l.refOwner)},listeners:{render:function(){Zenoss.registerTooltipFor("thresholdEditButton")}}}]),columns:[{dataIndex:"name",flex:1,header:_t("Name")},{dataIndex:"type",header:_t("Type")},{dataIndex:"minval",header:_t("Min. Value")},{dataIndex:"maxval",header:_t("Max. Value")}]});Zenoss.templates.thresholdDataGrid.superclass.constructor.apply(this,arguments)},getTemplateUid:function(){var g=Ext.getCmp(e),h=g.getSelectionModel().getSelectedNode();if(h){return h.data.uid}}})}());(function(){var l,h,a,b,c,j;Ext.ns("Zenoss","Zenoss.templates");l=Zenoss.remote.TemplateRouter;h=function(){return Ext.getCmp("templateTree").getSelectionModel().getSelectedNode()};a=function(){return Ext.getCmp("graphGrid").getSelectionModel().getSelected()};function g(){var m=Ext.getCmp("graphPointGrid");if(m){return m.getSelectionModel().getSelected()}return null}c=function(){var m,n;m={uid:a().get("uid")};n=function(p,o){Ext.getCmp("deleteGraphDefinitionButton").disable();Ext.getCmp("graphDefinitionMenuButton").disable();Ext.getCmp("graphGrid").refresh()};l.deleteGraphDefinition(m,n)};new Zenoss.MessageDialog({id:"deleteGraphDefinitionDialog",title:_t("Delete Graph Definition"),okHandler:function(){c()}});function d(){var m,n;m={uid:g().get("uid")};n=function(p,o){Ext.getCmp("deleteGraphPointButton").disable();Ext.getCmp("editGraphPointButton").disable();Ext.getCmp("graphPointGrid").refresh()};l.deleteGraphPoint(m,n)}new Zenoss.MessageDialog({id:"deleteGraphPointDialog",title:_t("Delete Graph Point"),okHandler:d});function f(){var m=Ext.getCmp("addDataPointToGraphDialog").comboBox.getValue(),q=a().get("uid"),n=Ext.getCmp("addDataPointToGraphDialog").includeRelatedThresholds.getValue(),o={dataPointUid:m,graphUid:q,includeThresholds:n},p=function(){Ext.getCmp("graphPointGrid").refresh()};l.addDataPointToGraph(o,p)}new Zenoss.HideFormDialog({id:"addDataPointToGraphDialog",title:_t("Add Data Point"),closeAction:"hide",items:[{xtype:"combo",ref:"comboBox",getInnerTpl:function(){return'<tpl for="."><div ext:qtip="{name}" class="x-combo-list-item">{name}</div></tpl>'},fieldLabel:_t("Data Point"),valueField:"uid",displayField:"name",triggerAction:"all",forceSelection:true,editable:false,allowBlank:false,listeners:{validitychange:function(n,o){var m=Ext.getCmp("addDataPointToGraphDialog");if(m.isVisible()){m.submit.setDisabled(!o)}}},store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",model:"Zenoss.model.Basic",directFn:l.getDataPoints})},{xtype:"checkbox",name:"include_related_thresholds",ref:"includeRelatedThresholds",fieldLabel:_t("Include Related Thresholds"),checked:true}],listeners:{show:function(){var n,m;n=Ext.getCmp("addDataPointToGraphDialog").comboBox;n.reset();Ext.getCmp("addDataPointToGraphDialog").submit.disable();m=h().data.uid;n.store.setContext(m)}},buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",ref:"../submit",text:_t("Submit"),disabled:true,handler:function(m,n){f()}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});j=function(){var m,n;m={graphUid:a().get("uid"),thresholdUid:Ext.getCmp("addThresholdToGraphCombo").getValue()};n=function(){Ext.getCmp("graphPointGrid").refresh()};l.addThresholdToGraph(m,n)};new Zenoss.HideFormDialog({id:"addThresholdToGraphDialog",title:_t("Add Threshold"),items:{xtype:"combo",id:"addThresholdToGraphCombo",getInnerTpl:function(){return'<tpl for="."><div ext:qtip="{name}" class="x-combo-list-item">{name}</div></tpl>'},fieldLabel:_t("Threshold"),valueField:"uid",displayField:"name",triggerAction:"all",forceSelection:true,editable:false,allowBlank:false,listeners:{validitychange:function(n,o){var m=Ext.getCmp("addThresholdToGraphSubmit");if(m.isVisible()){m.setDisabled(!o)}}},store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",model:"Zenoss.model.Basic",directFn:l.getThresholds})},listeners:{show:function(){var n,m;n=Ext.getCmp("addThresholdToGraphCombo");n.reset();Ext.getCmp("addThresholdToGraphSubmit").disable();m=h().data.uid;n.store.setContext(m)}},buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",id:"addThresholdToGraphSubmit",text:_t("Submit"),disabled:true,handler:function(m,n){j()}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Ext.define("Zenoss.InstructionTypeModel",{extend:"Ext.data.Model",idProperty:"pythonClassName",fields:["pythonClassName","label"]});new Zenoss.HideFormDialog({id:"addCustomToGraphDialog",title:_t("Add Custom Graph Point"),listeners:{show:function(m){m.addForm.idField.reset();m.addForm.typeCombo.reset();m.addForm.typeCombo.store.load()}},items:[{xtype:"form",ref:"addForm",listeners:{validitychange:function(m,n){Ext.getCmp("addCustomToGraphDialog").submitButton.setDisabled(!n)}},items:[{xtype:"idfield",ref:"idField",fieldLabel:_t("Name"),allowBlank:false},{xtype:"combo",ref:"typeCombo",fieldLabel:_t("Instruction Type"),valueField:"pythonClassName",displayField:"label",triggerAction:"all",forceSelection:true,editable:false,allowBlank:false,store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",autoLoad:false,model:"Zenoss.InstructionTypeModel",directFn:l.getGraphInstructionTypes})}]}],buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",disabled:true,ref:"../submitButton",text:_t("Add"),handler:function(m){var o,p,n=Ext.getCmp("addCustomToGraphDialog").addForm;o={graphUid:a().get("uid"),customId:n.idField.getValue(),customType:n.typeCombo.getValue()};p=function(){Ext.getCmp("graphPointGrid").refresh()};l.addCustomToGraph(o,p)}},{xtype:"HideDialogButton",ui:"dialog-dark",ref:"../cancelButton",text:_t("Cancel")}]});Ext.create("Zenoss.dialog.BaseWindow",{title:_t("Graph Custom Definition"),id:"graphCustomDefinitionDialog",closeAction:"hide",buttonAlign:"left",autoScroll:true,height:500,width:400,modal:true,plain:true,padding:10,items:[{xtype:"form",ref:"formPanel",paramsAsHash:true,api:{load:l.getGraphDefinition,submit:l.setInfo},items:[{xtype:"label",fieldLabel:_t("Name"),name:"id",ref:"nameLabel"},{xtype:"textarea",fieldLabel:_t("Custom"),width:300,height:300,name:"custom",ref:"custom"},{xtype:"label",fieldLabel:_t("Available RRD Variables"),ref:"rrdVariables"}]}],buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Submit"),handler:function(n,p){var o=Ext.getCmp("graphCustomDefinitionDialog"),m,q=o.record,r={};r.uid=q.uid;r.custom=o.formPanel.custom.getValue();l.setInfo(r)}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}],loadAndShow:function(m){this.uid=m;this.formPanel.getForm().load({params:{uid:m},success:function(o,n){var p=n.result.data;this.record=p;this.formPanel.nameLabel.setText(p.id);this.formPanel.custom.setValue(p.custom);this.formPanel.rrdVariables.setText(p.rrdVariables.join("<br />"),false);this.show()},scope:this})}});Ext.define("Zenoss.graph.GraphPointModel",{extend:"Ext.data.Model",idProperty:"uid",fields:["uid","name","type","description"]});Ext.define("Zenoss.GraphPointStore",{alias:["widget.graphpointstore"],extend:"Zenoss.NonPaginatedStore",constructor:function(m){Ext.applyIf(m,{model:"Zenoss.graph.GraphPointModel",directFn:l.getGraphPoints,root:"data"});this.callParent(arguments)}});new Ext.menu.Menu({id:"graphPointMenu",items:[{xtype:"menuitem",text:_t("Data Point"),handler:function(){Ext.getCmp("addDataPointToGraphDialog").show()}},{xtype:"menuitem",text:_t("Threshold"),handler:function(){Ext.getCmp("addThresholdToGraphDialog").show()}},{xtype:"menuitem",text:_t("Custom Graph Point"),handler:function(){Ext.getCmp("addCustomToGraphDialog").show()}}]});Ext.define("Zenoss.BaseSequenceGrid",{extend:"Ext.grid.GridPanel",constructor:function(m){Ext.applyIf(m,{enableDragDrop:true,viewConfig:{forcefit:true,plugins:{ptype:"gridviewdragdrop"}}});this.addEvents({resequence:true});Zenoss.BaseSequenceGrid.superclass.constructor.call(this,m)}});Ext.define("Zenoss.GraphPointGrid",{alias:["widget.graphpointgrid"],extend:"Zenoss.ContextGridPanel",constructor:function(m){Ext.applyIf(m,{height:215,viewConfig:{plugins:{ptype:"gridviewdragdrop"}},listeners:{itemclick:function(){var n=g();if(n){Ext.getCmp("deleteGraphPointButton").enable();Ext.getCmp("editGraphPointButton").enable()}else{Ext.getCmp("deleteGraphPointButton").disable();Ext.getCmp("editGraphPointButton").disable()}},itemdblclick:k},store:Ext.create("Zenoss.GraphPointStore",{}),columns:[{dataIndex:"name",header:_t("Name"),width:150},{dataIndex:"type",header:_t("Type"),width:150},{dataIndex:"description",header:_t("Description"),id:"definition_description",flex:1}],tbar:[{xtype:"button",id:"addGraphPointButton",iconCls:"add",menu:"graphPointMenu",listeners:{render:function(){Zenoss.registerTooltipFor("addGraphPointButton")}}},{xtype:"button",id:"deleteGraphPointButton",iconCls:"delete",disabled:true,listeners:{render:function(){Zenoss.registerTooltipFor("deleteGraphPointButton")}},handler:function(){var o,n;o=_t("Are you sure you want to remove the graph point, {0}? There is no undo.");o=Ext.String.format(o,g().data.name);n=Ext.getCmp("deleteGraphPointDialog");n.setText(o);n.show()}},{xtype:"button",id:"editGraphPointButton",iconCls:"customize",disabled:true,listeners:{render:function(){Zenoss.registerTooltipFor("editGraphPointButton")}},handler:k}],selModel:Ext.create("Zenoss.SingleRowSelectionModel",{})});this.callParent(arguments)}});function e(){var m=Ext.getCmp("graphPointGrid");m.refresh()}function k(){var m=g();function n(o){var p=Ext.create("Zenoss.form.DataSourceEditDialog",{record:o.data,items:o.form,singleColumn:true,width:400,title:_t("Edit Graph Point"),directFn:l.setInfo,id:"editGraphPointDialog",saveHandler:e});p.show()}l.getInfo({uid:m.get("uid")},n)}new Zenoss.HideFitDialog({id:"manageGraphPointsDialog",title:_t("Manage Graph Points"),items:[{xtype:"graphpointgrid",id:"graphPointGrid",ref:"graphGrid"}],buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Save"),handler:function(){if(Zenoss.Security.hasPermission("Manage DMD")){var m,n;m=Ext.getCmp("graphPointGrid").getStore().getRange();n=Ext.Array.pluck(Ext.Array.pluck(m,"data"),"uid");l.setGraphPointSequence({uids:n})}}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Ext.create("Zenoss.dialog.BaseWindow",{layout:"fit",id:"viewGraphDefinitionDialog",title:_t("View and Edit Graph Definition"),closeAction:"hide",buttonAlign:"left",autoScroll:true,plain:true,modal:true,width:400,height:500,padding:10,buttons:[{ref:"../submitButton",xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Submit"),disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:function(n){var p,m,o;p=n.refOwner;m=p.formPanel.getForm();o=Ext.applyIf(m.getValues(),{uid:p.uid,hasSummary:false,log:false,base:false});m.api.submit(o,function(){Ext.getCmp("graphGrid").refresh()})}},{xtype:"HideDialogButton",ref:"../cancelButton",ui:"dialog-dark",text:"Cancel"}],items:{xtype:"form",ref:"formPanel",autoScroll:true,paramsAsHash:true,api:{load:l.getGraphDefinition,submit:l.setGraphDefinition},listeners:{validitychange:function(m,n){var o=Ext.getCmp("viewGraphDefinitionDialog");if(Zenoss.Security.hasPermission("Manage DMD")){o.submitButton.setDisabled(!n)}},show:function(m){m.getForm().load()}},items:[{xtype:"idfield",fieldLabel:_t("Name"),name:"newId",allowBlank:false},{xtype:"numberfield",fieldLabel:_t("Height"),name:"height",minValue:0},{xtype:"numberfield",fieldLabel:_t("Width"),name:"width",minValue:0},{xtype:"textfield",fieldLabel:_t("Units"),name:"units"},{xtype:"checkbox",fieldLabel:_t("Logarithmic Scale"),name:"log"},{xtype:"checkbox",fieldLabel:_t("Base 1024"),name:"base"},{xtype:"numberfield",fieldLabel:_t("Min Y"),name:"miny"},{xtype:"numberfield",fieldLabel:_t("Max Y"),name:"maxy"},{xtype:"checkbox",fieldLabel:_t("Has Summary"),name:"hasSummary"}]},loadAndShow:function(m){this.uid=m;this.formPanel.getForm().load({params:{uid:m},success:function(){this.show()},scope:this})}});new Ext.menu.Menu({id:"graphDefinitionMenu",items:[{xtype:"menuitem",text:_t("Manage Graph Points"),handler:function(){var n,m;n=a().get("uid");Ext.getCmp("manageGraphPointsDialog").show();m=Ext.getCmp("graphPointGrid");m.setContext(n)}},{xtype:"menuitem",text:_t("View and Edit Details"),handler:function(){var n,m;n=Ext.getCmp("viewGraphDefinitionDialog");m=a().get("uid");n.loadAndShow(m)}},{xtype:"menuitem",text:_t("Custom Graph Definition"),handler:function(){var n=Ext.getCmp("graphCustomDefinitionDialog"),m=a().get("uid");n.loadAndShow(m)}},{xtype:"menuitem",text:_t("Graph Commands"),handler:function(){var m={uid:a().get("uid")};l.getGraphDefinition(m,function(n){Ext.MessageBox.show({title:_t("Graph Commands"),minWidth:700,msg:Ext.String.format("<pre>{0}</pre>",n.data.fakeGraphCommands),buttons:Ext.MessageBox.OK})})}}]});Ext.define("Zenoss.templates.GraphGrid",{alias:["widget.graphgrid"],extend:"Zenoss.ContextGridPanel",constructor:function(m){var n=this;Ext.applyIf(m,{title:_t("Graph Definitions"),store:Ext.create("Zenoss.GraphStore",{}),enableDragDrop:true,viewConfig:{forcefit:true,plugins:{ptype:"gridviewdragdrop"},listeners:{drop:function(){var o,p;o=n.store.getRange();p=Ext.pluck(Ext.pluck(o,"data"),"uid");l.setGraphDefinitionSequence({uids:p})}}},listeners:{itemdblclick:function(){var p,o;p=Ext.getCmp("viewGraphDefinitionDialog");o=a().get("uid");p.loadAndShow(o)}},selModel:new Zenoss.SingleRowSelectionModel({listeners:{select:function(){if(Zenoss.Security.hasPermission("Manage DMD")){Ext.getCmp("deleteGraphDefinitionButton").enable();Ext.getCmp("graphDefinitionMenuButton").enable()}}}}),columns:[{dataIndex:"name",header:_t("Name"),flex:1,width:400}],tbar:[{id:"addGraphDefinitionButton",xtype:"button",iconCls:"add",ref:"../addButton",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),listeners:{render:function(){Zenoss.registerTooltipFor("addGraphDefinitionButton")}},handler:function(){var o=Ext.create("Zenoss.dialog.BaseWindow",{title:_t("Add Graph Definition"),buttonAlign:"left",autoScroll:true,plain:true,width:300,autoHeight:true,modal:true,padding:10,items:[{xtype:"form",listeners:{validitychange:function(p,q){o.submitButton.setDisabled(!q)}},items:[{xtype:"idfield",id:"graphDefinitionIdTextfield",fieldLabel:_t("Name"),allowBlank:false}]}],buttons:[{xtype:"DialogButton",ref:"../submitButton",disabled:true,text:_t("Submit"),handler:function(){var p,q;p={templateUid:h().data.uid,graphDefinitionId:Ext.getCmp("graphDefinitionIdTextfield").getValue()};q=function(s,r){Ext.getCmp("graphGrid").refresh()};l.addGraphDefinition(p,q)}},{xtype:"DialogButton",text:_t("Cancel")}]});o.show()}},{id:"deleteGraphDefinitionButton",xtype:"button",iconCls:"delete",disabled:true,listeners:{render:function(){Zenoss.registerTooltipFor("deleteGraphDefinitionButton")}},handler:function(){var r,o,q,p;r=_t("Are you sure you want to remove {0}? There is no undo.");o=a().data.name;q=Ext.String.format(r,o);p=Ext.getCmp("deleteGraphDefinitionDialog");p.setText(q);p.show()}},{id:"graphDefinitionMenuButton",xtype:"button",listeners:{render:function(){Zenoss.registerTooltipFor("graphDefinitionMenuButton")}},iconCls:"customize",menu:"graphDefinitionMenu",disabled:true}]});this.callParent(arguments)}})})();(function(){Ext.ns("Zenoss","Zenoss.templates");var b=Zenoss.remote.DeviceRouter;function a(){var c=Ext.getCmp("templateTree");if(c&&c.isVisible()){c.refresh(function(){var d=c.getRootNode();if(d.firstChild){c.getSelectionModel().select(d.firstChild)}})}}Ext.define("Zenoss.templates.Container",{alias:["widget.templatecontainer"],extend:"Ext.Panel",constructor:function(c){Ext.applyIf(c,{layout:"border",defaults:{split:true},items:[{xtype:"DataSourceTreeGrid",id:"dataSourceTreeGrid",region:"center",ref:"dataSourceTreeGrid",uid:c.uid,root:{uid:c.uid,id:c.uid}},{xtype:"panel",layout:"border",region:"east",width:"35%",defaults:{split:true},items:[{xtype:"thresholddatagrid",id:"thresholdGrid",ref:"../thresholdGrid",region:"north",height:300},{xtype:"graphgrid",id:"graphGrid",ref:"../graphGrid",region:"center"}]}]});Zenoss.templates.Container.superclass.constructor.call(this,c)},setContext:function(c){this.updateTreeGrid(this.dataSourceTreeGrid,c);this.updateGrid(this.thresholdGrid,c);this.updateGrid(this.graphGrid,c)},updateTreeGrid:function(d,c){d.setContext(c)},updateGrid:function(d,c){d.setContext(c)}});Zenoss.BubblingSelectionModel=Ext.extend(Zenoss.TreeSelectionModel,{constructor:function(c){Zenoss.BubblingSelectionModel.superclass.constructor.call(this,c);this.enableBubble("selectionchange");this.bubbleTarget=c.bubbleTarget},getBubbleTarget:function(){return this.bubbleTarget}});Zenoss.MonTemplateSelectionModel=Ext.extend(Zenoss.BubblingSelectionModel,{constructor:function(c){Ext.applyIf(c,{listeners:{beforeselect:function(e,d){return d.isLeaf()}}});Zenoss.MonTemplateSelectionModel.superclass.constructor.call(this,c)}});Ext.define("Zenoss.templates.TemplateTreeModel",{extend:"Zenoss.model.Tree",fields:["text","uid"],getId:function(){return this.get("uid")},proxy:{simpleSortMode:true,type:"direct",directFn:b.getTemplates,paramOrder:["uid"]}});Ext.define("Zenoss.templates.MonTemplateTreePanel",{alias:["widget.montemplatetreepanel"],extend:"Ext.tree.TreePanel",constructor:function(c){Ext.applyIf(c,{useArrows:true,manageHeight:false,cls:"x-tree-noicon",model:"Zenoss.model.Tree",selModel:new Zenoss.MonTemplateSelectionModel({bubbleTarget:c.bubbleTarget}),store:Ext.create("Ext.data.TreeStore",{model:"Zenoss.templates.TemplateTreeModel",nodeParam:"uid"}),hideHeaders:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text"}],root:{text:_t("Monitoring Templates")}});this.callParent([c])},initComponent:function(){this.callParent(arguments);this.getStore().on("load",function(){this.getRootNode().expand()},this)},setContext:function(d,f,e){this.uid=d;if(d.match("^/zport/dmd/Devices")){this.show();var c=this.getRootNode();if(c){c.collapse();c.data.uid=d;this.getStore().load({callback:f,scope:e})}}else{this.hide()}},onSelectionChange:function(c){var e,f,d;if(c&&c.length){f=c[0];d=f.get("id");e=Ext.getCmp(this.initialConfig.detailPanelId);if(!e.items.containsKey("montemplate")){e.add({xtype:"templatecontainer",id:"montemplate",ref:"montemplate",uid:d})}e.montemplate.setContext(d);e.getLayout().setActiveItem("montemplate")}},refresh:function(d,c){this.setContext(this.uid,d,c)}});Ext.define("Zenoss.BindTemplatesItemSelector",{alias:["widget.bindtemplatesitemselector"],extend:"Ext.ux.form.ItemSelector",constructor:function(c){Ext.applyIf(c,{imagePath:"/++resource++zenui/img/xtheme-zenoss/icon",drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,displayField:"name",width:380,valueField:"id",store:Ext.create("Ext.data.ArrayStore",{data:[],model:"Zenoss.model.IdName",sorters:[{property:"value"}]})});Zenoss.BindTemplatesItemSelector.superclass.constructor.apply(this,arguments)},setContext:function(c){b.getUnboundTemplates({uid:c},function(f,d){var e=d.result.data;b.getBoundTemplates({uid:c},function(j,g){var h=[];Ext.each(g.result.data,function(k){h.push(k[0]);e.push(k)});this.store.loadData(e);this.bindStore(this.store);this.setValue(h)},this)},this)}});Ext.define("Zenoss.AddLocalTemplatesDialog",{alias:["widget.addlocaltemplatesdialog"],extend:"Zenoss.HideFitDialog",constructor:function(c){var d=this;Ext.applyIf(c,{title:_t("Add Local Template"),layout:"anchor",items:[{xtype:"form",ref:"formPanel",listeners:{validitychange:function(e,f){d.submitButton.setDisabled(!f)}},items:[{xtype:"idfield",fieldLabel:_t("Name"),ref:"templateName",context:c.context}]}],listeners:{show:function(){this.formPanel.templateName.setValue("")}},buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",ref:"../submitButton",text:_t("Submit"),handler:function(){var e=d.formPanel.templateName.getValue();b.addLocalTemplate({deviceUid:d.context,templateId:e},a)}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Zenoss.AddLocalTemplatesDialog.superclass.constructor.call(this,c)},setContext:function(c){this.context=c}});Ext.define("Zenoss.BindTemplatesDialog",{alias:["widget.bindtemplatesdialog"],extend:"Zenoss.HideFitDialog",constructor:function(c){var d=this;var e=Ext.id();Ext.applyIf(c,{width:600,height:400,title:_t("Bind Templates"),items:[{xtype:"panel",width:550,layout:"column",defaults:{columnWidth:0.5},items:[{xtype:"label",style:{padding:"0 0 5px 7px"},text:"Available"},{xtype:"label",style:{padding:"0 0 5px 0"},text:"Selected"}]},{xtype:"bindtemplatesitemselector",ref:"itemselector",width:500,height:200,id:e,context:c.context}],listeners:{show:function(){Ext.getCmp(e).setContext(this.context)}},buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Save"),handler:function(){var f,g,h;if(Zenoss.Security.hasPermission("Manage DMD")){h=Ext.getCmp(e).getValue();b.setBoundTemplates({uid:d.context,templateIds:h},a)}}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Zenoss.BindTemplatesDialog.superclass.constructor.call(this,c)},setContext:function(c){this.context=c}});Ext.define("Zenoss.ResetTemplatesDialog",{alias:["widget.resettemplatesdialog"],extend:"Zenoss.MessageDialog",constructor:function(c){var d=this;Ext.applyIf(c,{title:_t("Reset Template Bindings"),message:_t("Are you sure you want to delete all local template bindings and use default values?"),buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Reset Bindings"),handler:function(){if(Zenoss.Security.hasPermission("Manage DMD")){b.resetBoundTemplates({uid:d.context},a)}}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Zenoss.ResetTemplatesDialog.superclass.constructor.call(this,c)},setContext:function(c){this.context=c}});Ext.define("Zenoss.OverrideTemplatesDialog",{alias:["widget.overridetemplatesdialog"],extend:"Zenoss.HideFitDialog",constructor:function(c){var d=this;Ext.applyIf(c,{height:200,width:300,title:_t("Override Templates"),listeners:{show:function(){d.submit.setDisabled(true);d.comboBox.setValue(null);d.comboBox.store.setBaseParam("query",d.context);d.comboBox.store.setBaseParam("uid",d.context)}},items:[{xtype:"label",html:_t("Select the bound template you wish to override.")},{xtype:"combo",forceSelection:true,emptyText:_t("Select a template..."),minChars:0,ref:"comboBox",selectOnFocus:true,typeAhead:true,valueField:"uid",displayField:"label",listConfig:{resizable:true},store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",model:"Zenoss.model.Label",directFn:b.getOverridableTemplates}),listeners:{select:function(){d.submit.setDisabled(!d.comboBox.getValue())}}}],buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",ref:"../submit",disabled:true,text:_t("Submit"),handler:function(){var e,f,h;if(Zenoss.Security.hasPermission("Manage DMD")){var g=d.comboBox.getValue();Zenoss.remote.TemplateRouter.copyTemplate({uid:g,targetUid:d.context},a)}}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Zenoss.OverrideTemplatesDialog.superclass.constructor.call(this,c)},setContext:function(c){this.context=c}});Ext.define("Zenoss.removeLocalTemplateDialog",{alias:["widget.removelocaltemplatesdialog"],extend:"Zenoss.HideFitDialog",constructor:function(c){var d=this;Ext.applyIf(c,{height:200,width:300,title:_t("Remove Local Template"),listeners:{show:function(){d.submit.setDisabled(true);d.comboBox.setValue(null);d.comboBox.store.setBaseParam("query",d.context);d.comboBox.store.setBaseParam("uid",d.context)}},items:[{xtype:"label",html:_t("Select the locally defined template you wish to remove.")},{xtype:"combo",forceSelection:true,width:200,emptyText:_t("Select a template..."),minChars:0,ref:"comboBox",selectOnFocus:true,valueField:"uid",displayField:"label",typeAhead:true,store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",model:"Zenoss.model.Label",directFn:b.getLocalTemplates}),listeners:{select:function(){d.submit.setDisabled(!d.comboBox.getValue())}}}],buttons:[{xtype:"HideDialogButton",ui:"dialog-dark",ref:"../submit",disabled:true,text:_t("Submit"),handler:function(){var e,f,h;if(Zenoss.Security.hasPermission("Manage DMD")){var g=d.comboBox.getValue();b.removeLocalTemplate({deviceUid:d.context,templateUid:g},a)}}},{xtype:"HideDialogButton",ui:"dialog-dark",text:_t("Cancel")}]});Zenoss.OverrideTemplatesDialog.superclass.constructor.call(this,c)},setContext:function(c){this.context=c}})})();(function(){Ext.ns("Zenoss");function a(b){return function(c,d){Ext.getCmp(b).fireEvent("buttonClick",c.id)}}Zenoss.footerHelper=function(f,d,e){var c;e=Ext.applyIf(e||{},{addToZenPack:true,hasOrganizers:true,deleteMenu:true,hasContextMenu:true,customAddDialog:{},buttonContextMenu:{},contextGetter:null,onGetDeleteMessage:function(g){return Ext.String.format(_t("The selected {0} will be deleted."),g.toLowerCase())},onGetAddDialogItems:function(){return[{xtype:"textfield",name:"id",fieldLabel:_t("Name"),anchor:"80%",allowBlank:false}]},onGetItemName:function(){return f}});Ext.applyIf(e.buttonContextMenu,{xtype:"ContextMenu",tooltip:_t("Context-sensitive actions"),menu:{items:[]},ref:"buttonContextMenu"});d=d||Ext.getCmp("footer_bar");d.setContext=function(g){Ext.each(this.items.items,function(h){if(h.setContext){h.setContext(g)}})};function b(j,l){var h,g,k;k=Ext.apply({},e.customAddDialog);h=function(m){d.fireEvent("buttonClick",l,m.id,m)};k=Ext.applyIf(k,{submitHandler:h,items:e.onGetAddDialogItems(),title:Ext.String.format(j,e.onGetItemName())});g=new Zenoss.SmartFormDialog(k);g.show()}c=[{xtype:"FlexButton",id:"footer_add_button",iconCls:"add",hidden:Zenoss.Security.doesNotHavePermission("Add DMD Objects"),tooltip:_t("Add a child to the selected organizer"),menu:{items:[{text:Ext.String.format(_t("Add {0}"),f),listeners:{click:Ext.pass(b,["Add {0}","addClass"])}}]},ref:"buttonAdd"},{xtype:"FlexButton",id:"footer_delete_button",iconCls:"delete",hidden:Zenoss.Security.doesNotHavePermission("Delete objects"),tooltip:Ext.String.format(_t("Delete {0}"),f),menu:{items:[{text:Ext.String.format(_t("Delete {0}"),e.onGetItemName()),listeners:{click:function(){var g=e.onGetItemName();new Zenoss.dialog.SimpleMessageDialog({message:e.onGetDeleteMessage(g),buttonAlign:"center",title:Ext.String.format(_t("Delete {0}"),e.onGetItemName()),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){d.fireEvent("buttonClick","delete")}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}}]},ref:"buttonDelete"}];if(e.hasOrganizers){c[0].menu.items.push({text:Ext.String.format(_t("Add {0} Organizer"),f),param:"addOrganizer",listeners:{click:Ext.pass(b,[_t("Add {0} Organizer"),"addOrganizer"])},ref:"buttonAddOrganizer"});if(e.deleteMenu){c[1].menu.items.push({text:Ext.String.format(_t("Delete {0} Organizer"),f),ref:"buttonDeleteOrganizer",listeners:{click:function(){var g=e.onGetItemName();Ext.MessageBox.show({title:Ext.String.format(_t("Delete {0} Organizer"),g),msg:Ext.String.format(_t("The selected {0} organizer will be deleted."),g.toLowerCase()),fn:function(h){if(h=="ok"){d.fireEvent("buttonClick","deleteOrganizer")}},buttons:Ext.MessageBox.OKCANCEL})}}})}}if(e.addToZenPack){e.buttonContextMenu.menu.items.push({ref:"buttonAddToZenPack",text:Ext.String.format(_t("Add {0} to ZenPack"),f),listeners:{click:function(){var g=new Zenoss.AddToZenPackWindow({});var h=e.contextGetter.getUid();if(!h){return}g.setTarget(h);g.show()}}});if(e.contextGetter.hasTwoControls()){e.buttonContextMenu.menu.items.push({ref:"buttonAddOrganizerToZenPack",text:Ext.String.format(_t("Add {0} Organizer to ZenPack"),f),listeners:{click:function(){var g=new Zenoss.AddToZenPackWindow({});var h=e.contextGetter.getOrganizerUid();if(!h){return}g.setTarget(h);g.show()}}})}}if(e.hasContextMenu||e.addToZenPack){c.push(" ");c.push(e.buttonContextMenu)}c.push("-");d.add(c)}})();(function(){Ext.ns("Zenoss");function a(h){var d=h.split(".");if(d.length>4){return false}while(d.length<4){d.push("0")}for(var f=0;f<d.length;f++){var c=parseInt(d[f],10);if(!c&&c!==0){return false}try{if(c>255){return false}}catch(g){return false}d[f]=c.toString()}return d.join(".")}function b(d,c){return d.split(c).length-1}Ext.define("Zenoss.IpAddressField",{alias:["widget.ipaddressfield"],extend:"Ext.form.TextField",constructor:function(c){c.maskRe=true;Zenoss.IpAddressField.superclass.constructor.call(this,c)},filterKeys:function(h,f){if(h.ctrlKey||h.isSpecialKey()){return}h.stopEvent();var g,n,c,l=f.selectionStart,j=f.selectionEnd,k=f.value.substring(0,l),d=f.value.substring(j),m=String.fromCharCode(h.getCharCode());if(m=="."){n=k+d;l+=d.indexOf(".");c=d.split(".")[1];if(j==l+1){l++}if(c){f.setSelectionRange(l+1,l+c.length+1)}}else{n=a(k+m+d);if(n){l++;f.value=n;f.setSelectionRange(l,l)}}}})})();(function(){Ext.define("Zenoss.SlidingCardLayout",{extend:"Ext.layout.CardLayout",alias:["layout.slide"],sizeAllCards:true,setActiveItem:function(h){var a=this.owner,b=a.body,d=a.getComponent(h),e=this.activeItem,l=Ext.Array.indexOf(a.items.items,e);if(d!=e){if(e){if(d){a.fireEvent("beforecardchange",a,d,h,e,l);if(!d.rendered){this.renderItem(d,h,a.getLayoutTarget())}d.show();if(d.doLayout&&(this.layoutOnCardChange||!d.rendered)){d.doLayout()}var c=0;function f(){c++;if(c==2){a.fireEvent("cardchange",a,d,h,e,l)}}var j=b.getX(),k=b.getWidth(),m=[j-k,j+k],g={duration:250,easing:"ease",opacity:0,callback:f};d.el.setY(b.getY());d.el.setX((l<h?m[1]:m[0]));e.el.shift(Ext.applyIf({x:l<h?m[0]:m[1]},g));d.el.shift(Ext.applyIf({x:j,opacity:1},g))}}this.activeItem=d;this.initLayout()}}});Ext.layout.container.slide=Zenoss.SlidingCardLayout;Ext.define("Zenoss.HorizontalSlidePanel",{alias:["widget.horizontalslide"],extend:"Ext.Panel",constructor:function(b){this.headerText=Ext.create("Ext.toolbar.TextItem",{html:(b&&b.text)?b.text:""});b=Ext.applyIf(b||{},{cls:"subselect",layout:"slide",activeItem:0});var a=[];Ext.each(b.items,function(f,d){var e=Ext.create("Ext.toolbar.TextItem",{html:(f&&f.text)?f.text:""});var c=Ext.create("Ext.Button",{text:(f&&f.buttonText)?f.buttonText:"",ref:(f.buttonRef||"navButton"),cls:d?"toleft":"toright",ui:"arrowslide",handler:function(){this.layout.setActiveItem(d?0:1)},scope:this},this);this[f.buttonRef]=c;c.hide();a.push({layout:"fit",tbar:{cls:"subselect-head",height:37,items:[e,"->",c]},items:[f],listeners:{render:function(g){g.card=g.items.items[0];g.card.parentCard=g;g.headerText=e;g.navButton=c;var j=function(l,k){this.headerText.setText(l);Ext.QuickTips.unregister(this.headerText);if(k){Ext.QuickTips.register({target:this.headerText,text:k})}};var h=function(k){this.navButton.setText(k)};g.setHeaderText=Ext.bind(j,g);g.setButtonText=Ext.bind(h,g)}}})},this);b.items=a;Zenoss.HorizontalSlidePanel.superclass.constructor.call(this,b)},initEvents:function(){this.addEvents("beforecardchange");this.addEvents("cardchange");Zenoss.HorizontalSlidePanel.superclass.initEvents.call(this)}});Zenoss.NavConfig=Ext.extend(Ext.util.MixedCollection,{constructor:function(){Zenoss.NavConfig.superclass.constructor.call(this,true,function(a){return a.id})}});Zenoss.NavManager=Ext.extend(Object,{all:null,constructor:function(){this.all=new Zenoss.NavConfig();this.all.addEvents("navready")},register:function(b){for(var a in b){this.add(a,b[a])}},add:function(c,a){if(!this.all.containsKey(c)){var b=new Zenoss.NavConfig();b.id=c;this.all.add(c,b);this.appendTo(c,a);this.all.fireEvent("navready",b)}else{this.appendTo(c,a)}},get:function(a){return this.all.getByKey(a)},appendTo:function(b,a){if(this.all.containsKey(b)){var c=this.all.getByKey(b);c.addAll(a)}else{this.onAvailable(b,function(d){d.addAll(a)})}},onAvailable:function(b,d,a){function c(e){if(e.id==b){d.call(a||e,e);this.all.un("navready",c,a)}}this.all.on("navready",c,this)}});Zenoss.nav=new Zenoss.NavManager();Ext.define("Zenoss.SubselectionPanel",{alias:["widget.subselection"],extend:"Ext.Panel",constructor:function(a){var b=a.id||Ext.id();Ext.applyIf(a,{id:b,layout:"fit",bodyStyle:{"margin-top":10},items:[{xtype:"treepanel",ref:"treepanel",selModel:new Zenoss.TreeSelectionModel({listeners:{selectionchange:function(e,c){if(c){var d=c.data.action;if(d){if(Ext.isString(this.target)){this.target=Ext.getCmp(this.target)}d.call(c,c,this.target)}}},scope:this}}),id:"subselecttreepanel"+b,rootVisible:false,root:{nodeType:"node"}}]});Zenoss.SubselectionPanel.superclass.constructor.call(this,a)},initComponent:function(){Zenoss.SubselectionPanel.superclass.initComponent.call(this);this.treepanel=Ext.getCmp("subselecttreepanel"+this.id)},setContext:function(c){var d=Zenoss.types.type(c),b=Zenoss.nav.get(d);if(b){Zenoss.util.each(b,function(e){Ext.applyIf(e,{nodeType:"subselect"})});var a=new Ext.tree.AsyncTreeNode({children:b,listeners:{load:function(f){var e=f.firstChild;if(e){if(e.rendered){e.select()}else{e.on("render",function(g){g.select()})}}},scope:this}});this.treepanel.setRootNode(a)}}});Ext.define("Zenoss.DetailNavTreeModel",{extend:"Ext.data.Model",fields:Zenoss.model.BASE_TREE_FIELDS.concat([{name:"action",type:"function"}])});Ext.define("Zenoss.DetailNavTreePanel",{alias:["widget.detailnavtreepanel"],extend:"Ext.tree.Panel",constructor:function(a){Ext.applyIf(a,{store:Ext.create("Ext.data.TreeStore",{model:"Zenoss.DetailNavTreeModel",proxy:{type:"memory",reader:{type:"json"}},autoLoad:false}),useArrows:true,manageHeight:false,hideHeaders:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"text"}],selModel:new Zenoss.BubblingSelectionModel({bubbleTarget:a.bubbleTarget}),id:"subselecttreepanel"+a.idSuffix,ref:"subselecttreepanel",rootVisible:false,iconCls:"x-tree-noicon",root:{nodeType:"node"}});this.callParent([a])},setNodeVisible:function(c,d){if(Ext.isString(c)){c=this.getNodeById(c)}var a=this.getView(),b=Ext.fly(a.getNodeByRecord(c));if(b){b.setVisibilityMode(Ext.Element.DISPLAY);b.setVisible(d)}}});Ext.define("Zenoss.DetailNavPanel",{alias:["widget.detailnav"],extend:"Zenoss.SubselectionPanel",onGetNavConfig:function(a){return[]},onSelectionChange:Ext.emptyFn,filterNav:function(b,a){return true},contextId:null,menuIds:["More","Manage","Edit","Actions","Add","TopLevel"],loaded:false,panelConfigMap:null,selectFirstNode:true,constructor:function(a){Ext.applyIf(a,{id:Ext.id(),bodyCls:"detailnav",layout:"fit",bodyStyle:{"margin-top":10}});Ext.applyIf(a,{items:{xtype:"detailnavtreepanel",ref:"navtreepanel",idSuffix:a.id,bubbleTarget:a.bubbleTarget}});Zenoss.DetailNavPanel.superclass.constructor.call(this,a)},initEvents:function(){this.addEvents("navloaded","nodeloaded","contextchange");Zenoss.DetailNavPanel.superclass.initEvents.call(this);if(this.selectFirstNode){this.on("navloaded",this.selectFirst,this)}},setContext:function(a){this.loaded=false;this.contextId=a;this.treepanel.setRootNode([]);this.getNavConfig(a);this.fireEvent("contextchange",this)},getSelectionModel:function(){return this.treepanel.getSelectionModel()},getNavConfig:function(b){var c=this;var d=function(j,f){var g=f.result.detailConfigs;var h=function(l){var k=true;if(Ext.isFunction(l.filterNav)){k=l.filterNav(c)}return k&&c.filterNav(c,l)};g=Zenoss.util.filter(g,h,c);var e=c.onGetNavConfig(c.contextId);if(!Ext.isDefined(e)||e===null){e=[]}e=Zenoss.util.filter(e,h,c);if(g){e=e.concat(g)}c.panelConfigMap=[];Zenoss.util.each(e,function(k){c.panelConfigMap[k.id]=k});c.setNavTree(e)};var a={uid:b};if(this.menuIds!==null&&this.menuIds.length>=1){a.menuIds=this.menuIds}if(Zenoss.env.lefthandnav){d(null,{result:Zenoss.env.lefthandnav});delete Zenoss.env.lefthandnav}else{Zenoss.remote.DetailNavRouter.getDetailNavConfigs(a,d,this)}},reset:function(){return this.treepanel.setRootNode({})},selectFirst:function(d,a){var e=d.getSelectionModel().getSelectedNode(),c=Ext.History.getToken(),b=d.id+Ext.History.DELIMITER+a.firstChild.id;if(!e){if(!c||(c&&c==b)){d.getSelectionModel().select(a.firstChild)}}},setNavTree:function(b){var a;if(b){a=this.treepanel.getRootNode();Zenoss.util.each(b,function(c){Ext.applyIf(c,{nodeType:"subselect",leaf:true});a.appendChild(c)});Zenoss.util.each(b,function(c){this.fireEvent("nodeloaded",this,c)},this)}this.loaded=true;this.fireEvent("navloaded",this,a);a.expand(false,function(){if(this.manualAdjustHeight){var d=this.treepanel.getView();var c=Ext.fly(d.getNode(0)).getHeight();this.setHeight((c*b.length)+35)}},this);this.doLayout()}});Ext.define("Zenoss.DetailNavCombo",{alias:["widget.detailnavcombo"],extend:"Ext.form.ComboBox",target:null,contextUid:null,lastSelItem:null,panelConfigMap:null,queryMode:"local",editable:false,forceSelection:true,typeAhead:false,triggerAction:"all",filterNav:function(a){return true},menuIds:["More","Manage","Edit","Actions","Add","TopLevel"],onSelectionChange:Ext.emptyFn,onGetNavConfig:function(a){return[]},constructor:function(a){Ext.applyIf(a,{store:new Ext.data.ArrayStore({id:0,model:"Zenoss.model.ValueText",autoDestroy:true})});this.callParent(arguments)},getTarget:function(){var a=this.target;return Ext.isString(a)?Ext.getCmp(a):a},initEvents:function(){Zenoss.DetailNavCombo.superclass.initEvents.call(this);this.on("select",this.onItemSelected,this)},onItemSelected:function(c,b){var b=b[0],e=this.getTarget(),f=b.get("value"),a=this.panelConfigMap[f],d=a.action||function(g,h){if(!(f in h.items.map)){if(a){h.add(a);h.doLayout()}}h.items.map[f].setContext(this.contextUid);h.layout.setActiveItem(f)};this.lastSelItem=b;d.call(this,b,e,this)},selectAt:function(a){var b=this.store.getAt(a||0);this.selectByItem(b)},selectByItem:function(b){var a=this.lastSelItem;this.lastSelItem=b||this.store.getAt(0);this.select(this.lastSelItem);this.fireEvent("select",this,[this.lastSelItem])},setContext:function(b){this.contextUid=b;var a={uid:b};if(!Ext.isEmpty(this.menuIds)){a.menuIds=this.menuIds}Zenoss.remote.DetailNavRouter.getDetailNavConfigs(a,function(j){var h=j.detailConfigs,f=[],e=[],d=this.lastSelItem,c=false,g={};var k=function(m){var l=true;if(Ext.isFunction(m.filterNav)){l=m.filterNav(this)}return l&&this.filterNav(m)};e=this.onGetNavConfig(b);e=Zenoss.util.filter(e,k,this);h=Zenoss.util.filter(h,k,this);e=e.concat(h);Ext.each(e,function(l){f.push([l.id,l.text]);g[l.id]=l;if(d&&l.id==d.getId()){c=true}});this.panelConfigMap=g;this.store=new Ext.data.ArrayStore({id:0,model:"Zenoss.model.ValueText",data:f,autoDestroy:true});this.valueField="value";this.displayField="text";this.list=null;this.bindStore(this.store);this.doComponentLayout();if(c){this.selectByItem(this.lastSelItem)}else{this.selectAt(0)}},this)}});Ext.define("Zenoss.DetailContainer",{alias:["widget.detailcontainer"],extend:"Ext.Container",constructor:function(a){Ext.applyIf(a,{autoScroll:true,listeners:{selectionchange:this.onSelectionChange,scope:this}});Ext.each(a.items,function(b){b.bubbleTarget=this},this);this.callParent(arguments)},setContext:function(a){this.items.each(function(b){b.setContext(a)})},onSelectionChange:function(c,b){var a;if(b.length>0){this.items.each(function(d){a=d.getSelectionModel();if(a===c){d.onSelectionChange(b)}else{a.deselectAll()}})}}})})();(function(){Ext.define("Zenoss.IFramePanel",{alias:["widget.iframe"],extend:"Ext.ux.IFrame",frameLoaded:false,testEarlyReadiness:false,constructor:function(a){a=Ext.applyIf(a||{},{timeout:5000,pollInterval:50,loadMask:_t("Loading..."),src:a.url||"about:blank",ignoreClassName:false});Zenoss.IFramePanel.superclass.constructor.call(this,a)},initComponent:function(){this.callParent(arguments);this.addEvents("frameload","framefailed","isReady");this.on("frameload",function(a){Zenoss.messenger.checkMessages()},this)},onRender:function(b,a){Zenoss.IFramePanel.superclass.onRender.apply(this,arguments);this.frame=this.getEl();this.waitForLoad()},afterRender:function(a){Zenoss.IFramePanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){var c=this.getPosition(),b=this.frame.parent().getViewSize();this.setSize(b.width-c[0],b.height-c[1])}},waitForLoad:function(){var j=this.getDocument(),k=j?j.location.href:null,h=false,g=this.testEarlyReadiness,e,c,b,d=0,a=this.timeout/this.pollInterval;Ext.bind(function f(){if(this.frameLoaded){return}e=this.getBody();if(k=="about:blank"||k==""){if(g){g=!!e&&(this.ignoreClassName||!!e.className)}else{h=!!e&&(this.ignoreClassName||!!e.className);h=h&&this.fireEvent("isReady",this.getWindow())}}else{c=e?e.dom:null;b=this.getDocument().location.href;h=b!=k||(c&&c.innerHTML);h=h&&this.fireEvent("isReady",this.getWindow())}if(h||d++>a){this.frameLoaded=h;this.fireEvent(h?"frameload":"framefailed",this.getWindow())}else{Ext.defer(f,this.pollInterval,this)}},this)()},getDocument:function(){return this.getDoc()},getWindow:function(){return this.getWin()},setSrc:function(a){this.frameLoaded=false;if(a=="about:blank"||a==""){this.load("about:blank")}else{this.load(Ext.urlAppend(a,"_dc="+new Date().getTime()))}this.waitForLoad()}});Ext.define("Zenoss.BackCompatPanel",{alias:["widget.backcompat"],extend:"Zenoss.IFramePanel",contextUid:null,constructor:function(a){Ext.apply(a||{},{testEarlyReadiness:true});Zenoss.BackCompatPanel.superclass.constructor.call(this,a);this.addEvents("frameloadfinished");this.on("frameload",function(c){if(Ext.isDefined(c.Ext)&&Ext.isDefined(c.Ext.onReady)){var b=this;c.Ext.onReady(function(){b.fireEvent("frameloadfinished",c)})}else{if(c.document&&c.document.body){this.fireEvent("frameloadfinished",c)}else{c.onload=Ext.bind(function(){this.fireEvent("frameloadfinished",c)},this)}}},this);this.on("isReady",function(b){return Ext.isDefined(b.Ext)&&Ext.isDefined(b.Ext.onReady)})},setContext:function(b){this.contextUid=b;var a=b;if(Ext.isDefined(this.viewName)&&this.viewName!==null){a=b+"/"+this.viewName}if(this.rendered){this.setSrc(a)}else{this.on("afterrender",function(){this.setSrc(a)},this,{single:true})}}});Zenoss.util.registerBackCompatMenu=function(g,d,h,e){h=h||"bl";e=e||[0,0];var c=new Ext.Panel({floating:true,contentEl:g,border:false,shadow:!Ext.isIE,bodyCls:g.id=="contextmenu_items"?"z-bc-z-menu z-bc-page-menu":"z-bc-z-menu"});c.render(Ext.getBody());function b(){var j=c.getEl().getAlignToXY(d.getEl(),h,e);c.setPagePosition(j[0],j[1]);g.dom.style.display="block";c.show()}function a(){c.hide()}function f(k){var j=k.getTarget("a");if(j){location.href=j.href}}d.on("click",function(){d.fireEvent("menushow",d,d.menu)});d.on("menushow",b);d.on("menuhide",a);g.on("mousedown",f)}})();(function(){var a=new Ext.Template('<form name="commandform" method="POST" action="{target}">','<textarea style="visibility:hidden" name="data">',"{data}","</textarea>","</form>");a.compile();Ext.define("Zenoss.CommandPanel",{alias:["widget.commandpanel"],extend:"Zenoss.IFramePanel",constructor:function(b){b=Ext.applyIf(b||{},{ignoreClassName:true});Zenoss.CommandPanel.superclass.constructor.call(this,b);this.on("frameload",this.injectForm,this,{single:true})},injectForm:function(d){var c=this.getDocument(),b=a.apply({data:Ext.encode(this.data),target:this.target});this.getBody().innerHTML=b;this.getFrame().setAttribute("allowtransparency","true");c.commandform.submit();this.parentWindow.setSize(this.parentWindow.getSize())}});Ext.define("Zenoss.CommandWindow",{alias:["widget.commandwindow"],extend:"Ext.Window",constructor:function(b){this.cpanel=Ext.id();this.commandData=b.data||{uids:b.uids,command:b.command};this.target=b.target;b=Ext.applyIf(b||{},{layout:"fit",title:b.command||b.title,cls:"streaming-window",constrain:true,closable:true,plain:true,items:{id:this.cpanel,xtype:b.panel||"commandpanel",data:this.commandData,target:b.target,autoLoad:b.autoLoad,parentWindow:this},fbar:{buttonAlign:"left",id:"window_footer_toolbar",items:{xtype:"checkbox",checked:true,boxLabel:'<span style="color:white">Autoscroll</span>',handler:Ext.bind(function(d){if(d.checked){this.startScrolling()}else{this.stopScrolling()}},this)}}});Zenoss.CommandWindow.superclass.constructor.call(this,b);this.task=new Ext.util.DelayedTask(this.scrollToBottom,this);this.on("afterrender",this.startScrolling,this);this.on("afterrender",this.resizeOnRender,this);this.on("afterlayout",function(){this.center()},this,{single:true});this.on("close",this.stopScrolling,this);this.on("close",function(){if(Ext.isDefined(b.redirectTarget)){this.closeAndRedirect()}})},resizeOnRender:function(){var b=Ext.getBody().getViewSize();this.setSize({width:b.width*0.95,height:b.height*0.95})},getCommandPanel:function(){if(Ext.isString(this.cpanel)){this.cpanel=Ext.getCmp(this.cpanel)}return this.cpanel},startScrolling:function(){this.task.delay(250)},stopScrolling:function(){this.task.cancel()},scrollToBottom:function(){try{var d=this.getCommandPanel().getWindow(),b=this.getCommandPanel().getBody();Zenoss.env.BODY=b;d.scrollBy(0,b.scrollHeight)}catch(c){Ext.emptyFn()}if(Ext.get("window_footer_toolbar")){Ext.get("window_footer_toolbar").focus();this.task.delay(250)}},closeAndRedirect:function(){window.top.location=this.redirectTarget;this.destroy()}})})();(function(){var g=Zenoss.remote.DeviceRouter;var c=function(k,j){k.clearValue();k.store.setBaseParam("manufacturer",j);delete k.lastQuery};var b=function(j,k){return{constructor:function(l){var o=_t("Click to edit this field");var m='<a href="javascript:" title="'+o+'" class="manu-edit-link">'+_t("Edit")+"</a>",n=true;if(l.permission&&!Zenoss.Security.hasPermission(l.permission)){n=false;m=""}l.fieldLabel+=m;l.listeners=Ext.apply(l.listeners||{},{render:function(q){if(n){q.editlink=q.labelEl.select("a.manu-edit-link");q.editlink.on("click",function(){q.fireEvent("labelclick",q)},q)}}});j.superclass.constructor.call(this,l);this.addEvents("labelclick")}}};Zenoss.ClickToEditField=Ext.extend(Zenoss.form.LinkField,{});Zenoss.ClickToEditField=Ext.extend(Zenoss.form.LinkField,b(Zenoss.ClickToEditField));Ext.reg("clicktoedit","Zenoss.ClickToEditField");Zenoss.ClickToEditNoLink=Ext.extend(Ext.form.DisplayField,{});Zenoss.ClickToEditNoLink=Ext.extend(Ext.form.DisplayField,b(Zenoss.ClickToEditNoLink));Ext.reg("clicktoeditnolink","Zenoss.ClickToEditNoLink");function f(q,o){function j(t){if(!t){return"Unknown"}if(!Ext.isString(t)){t=t.uid}return t.split("/").reverse()[0]}var r=300;var m={xtype:"manufacturercombo",width:r,name:"hwManufacturer",id:"hwmanufacturercombo",fieldLabel:_t("HW Manufacturer"),listConfig:{resizable:true,resizeHandles:"e"},listeners:{select:function(v,t,u){t=t[0];var w=Ext.getCmp("hwproductcombo");c(w,t.data.name)}}};var l={xtype:"productcombo",prodType:"HW",width:r,listConfig:{resizable:true,resizeHandles:"e"},name:"hwProductName",fieldLabel:_t("HW Product"),id:"hwproductcombo",manufacturer:j(q.hwManufacturer)};var k={xtype:"manufacturercombo",width:r,name:"osManufacturer",id:"osmanufacturercombo",fieldLabel:_t("OS Manufacturer"),listConfig:{resizable:true,resizeHandles:"e"},listeners:{select:function(v,t,u){t=t[0];var w=Ext.getCmp("osproductcombo");c(w,t.data.name)}}};var s={xtype:"productcombo",prodType:"OS",width:r,listConfig:{resizable:true,resizeHandles:"e"},name:"osProductName",id:"osproductcombo",fieldLabel:_t("OS Product"),manufacturer:j(q.osManufacturer)};var n=new Zenoss.FormDialog({autoHeight:true,width:390,title:_t("Edit Manufacturer Info"),items:[{xtype:"container",layout:"anchor",autoHeight:true,style:"padding-bottom:5px;margin-bottom:5px;border-bottom:1px solid #555;",items:[m,l]},{xtype:"container",layout:"anchor",autoHeight:true,items:[k,s]}],buttons:[{text:_t("Save"),ref:"../savebtn",xtype:"DialogButton",id:"win-save-button",disabled:Zenoss.Security.doesNotHavePermission("Manage Device"),handler:function(t){var u=t.refOwner.editForm.getForm(),v=u.getValues();Ext.apply(v,{uid:o});g.setProductInfo(v,function(w){Ext.getCmp("device_overview").load();n.destroy()})}},{text:_t("Cancel"),xtype:"DialogButton",id:"win-cancel-button",handler:function(t){n.destroy()}}]});n.show();n.doLayout();Ext.getCmp("hwmanufacturercombo").getStore().addListener("load",function p(){var t=j(q.hwManufacturer);Ext.getCmp("hwmanufacturercombo").setValue(t)});Ext.getCmp("hwproductcombo").getStore().addListener("load",function p(){var t=j(q.hwModel);Ext.getCmp("hwproductcombo").setValue(t)});Ext.getCmp("osmanufacturercombo").getStore().addListener("load",function p(){var t=j(q.osManufacturer);Ext.getCmp("osmanufacturercombo").setValue(t)});Ext.getCmp("osproductcombo").getStore().addListener("load",function p(){var t=j(q.osModel);Ext.getCmp("osproductcombo").setValue(t)})}var e=function(j,k){var l=new Zenoss.FormDialog({autoHeight:true,width:300,title:_t("Set Collector"),items:[{xtype:"combo",name:"collector",listConfig:{resizable:true,resizeHandles:"e"},fieldLabel:_t("Select a collector"),queryMode:"local",store:new Ext.data.ArrayStore({data:Zenoss.env.COLLECTORS,fields:["name"]}),valueField:"name",displayField:"name",value:j.collector,forceSelection:true,editable:false,autoSelect:true,triggerAction:"all"},{xtype:"checkbox",name:"moveData",fieldLabel:_t("Move Data")}],buttons:[{text:_t("Save"),ref:"../savebtn",xtype:"DialogButton",id:"editcollector-save-button",disabled:Zenoss.Security.doesNotHavePermission("Manage Device"),handler:function(n){var o=n.refOwner.editForm.getForm().getValues();var m={uids:[k],asynchronous:Zenoss.settings.deviceMoveIsAsync([k]),collector:o.collector,hashcheck:"",moveData:o.moveData};Zenoss.remote.DeviceRouter.setCollector(m,function(p){Ext.getCmp("device_overview").load()});l.destroy()}},{text:_t("Cancel"),xtype:"DialogButton",id:"editcollector-cancel-button",handler:function(m){l.destroy()}}]});l.show();l.doLayout()};var d=function(m,k,j){var l=new Zenoss.FormDialog({width:500,height:150,title:j.title,items:[{xtype:"panel",html:j.instructions},{xtype:"tbspacer",height:5},{xtype:"panel",layout:"hbox",width:"100%",items:[{xtype:"combo",ref:"../../selectgroup",name:"group",width:250,store:new Ext.data.DirectStore({directFn:j.getGroupFn,root:j.getGroupRoot,fields:["name"]}),valueField:"name",displayField:"name",id:"editgroups-combo",forceSelection:true,listConfig:{resizable:true,resizeHandles:"e"},editable:false,autoSelect:true,triggerAction:"all",flex:4},{xtype:"button",ref:"../../addgroupbutton",ui:"dialog-dark",text:_t("Add"),id:"addgroup-button",handler:function(n){var o=n.refOwner.selectgroup.getValue();if(o){n.refOwner.grouplist.addGroup(o)}},flex:1}]},{xtype:"panel",ref:"../grouplist",addGroup:function(p,n){if(p in this.groups){if(this.groups[p]=="del"){this.groups[p]=""}else{return}}else{this.groups[p]=n?"":"add"}var o=this;var q=this.getHeight();this.add({xtype:"tbspacer",height:5});this.add({xtype:"panel",layout:"hbox",width:"100%",layoutConfig:{align:"middle"},items:[{xtype:"panel",html:p},{xtype:"tbspacer",flex:1},{xtype:"button",ui:"dialog-dark",text:_t("Remove"),ref:"delbutton",group:p,handler:function(r){o.delGroup(p,r.refOwner)}}]});this.bubble(function(){this.doLayout()});if(n){return}l.setHeight(l.getHeight()+this.getHeight()-q)},delGroup:function(o,n){if(this.groups[o]=="add"){delete this.groups[o]}else{this.groups[o]="del"}var p=this.getHeight();n.destroy();this.bubble(function(){this.doLayout()});l.setHeight(l.getHeight()+this.getHeight()-p)},groups:{},listeners:{render:function(n){Ext.each(m,function(o){n.addGroup(o.uid.slice(j.dmdPrefix.length),true)})}}}],buttons:[{text:_t("Save"),ref:"../savebtn",xtype:"DialogButton",id:"editgroups-save-button",disabled:Zenoss.Security.doesNotHavePermission("Manage Device"),handler:function(n){Ext.iterate(n.refOwner.grouplist.groups,function(p,q){var o={uids:[k],hashcheck:""};if(q=="del"){o.uid=j.dmdPrefix+p;Zenoss.remote.DeviceRouter.removeDevices(o,function(r){Ext.getCmp("device_overview").load()})}if(q=="add"){o.target=j.dmdPrefix+p;o.asynchronous=Zenoss.settings.deviceMoveIsAsync(o.uids);Zenoss.remote.DeviceRouter.moveDevices(o,function(r){Ext.getCmp("device_overview").load()})}});l.destroy()}},{text:_t("Cancel"),xtype:"DialogButton",id:"editgroups-cancel-button",handler:function(n){l.destroy()}}]});l.show();l.doLayout();l.setHeight(l.getHeight()+l.grouplist.getHeight())};var a=function(j,k){var l=new Zenoss.FormDialog({autoHeight:true,width:500,title:_t("Set Location"),items:[{xtype:"combo",name:"location",fieldLabel:_t("Select a location"),store:new Ext.data.DirectStore({autoload:true,directFn:Zenoss.remote.DeviceRouter.getLocations,root:"locations",fields:["name"]}),valueField:"name",displayField:"name",id:"editlocation-name-combo",value:j.location?j.location.uid.slice(20):"",listConfig:{resizable:true,resizeHandles:"e"},width:250,triggerAction:"all"}],buttons:[{text:_t("Save"),ref:"../savebtn",xtype:"DialogButton",id:"editlocation-save-button",disabled:Zenoss.Security.doesNotHavePermission("Manage Device"),handler:function(n){var o=n.refOwner.editForm.getForm().getValues();if(o.location){var m={uids:[k],asynchronous:Zenoss.settings.deviceMoveIsAsync([k]),target:"/zport/dmd/Locations"+o.location,hashcheck:""};Zenoss.remote.DeviceRouter.moveDevices(m,function(p){if(p.success){Ext.getCmp("device_overview").load()}})}l.destroy()}},{text:_t("Cancel"),xtype:"DialogButton",id:"editlocation-cancel-button",handler:function(m){l.destroy()}}]});l.show();l.doLayout()};function h(j){return !!j.setValue&&!!j.getValue&&!!j.markInvalid&&!!j.clearInvalid}Ext.define("Zenoss.DeviceOverviewForm",{alias:["widget.devformpanel"],extend:"Ext.form.FormPanel",fieldDefaults:{labelAlign:"top"},paramsAsHash:true,frame:false,defaults:{anchor:"95%",labelStyle:"font-size: 13px; color: #5a5a5a"},buttonAlign:"left",buttons:[{text:_t("Save"),xtype:"button",ref:"../savebtn",disabled:true,hidden:true,handler:function(j){this.refOwner.getForm().submit()}},{text:_t("Cancel"),xtype:"button",ref:"../cancelbtn",disabled:true,hidden:true,handler:function(){this.refOwner.getForm().reset()}}],cls:"device-overview-form-wrapper",bodyCls:"device-overview-form",style:{"background-color":"#fafafa"},listeners:{add:function(k,l,j){if(h(l)){this.onFieldAdd.call(this,l)}},validitychange:function(k,l,j){this.setButtonsDisabled(!l)}},constructor:function(j){j=Ext.applyIf(j||{},{trackResetOnLoad:true});j.listeners=Ext.applyIf(j.listeners||{},this.listeners);Zenoss.DeviceOverviewForm.superclass.constructor.call(this,j)},showButtons:function(){if(!this.rendered){this.on("render",this.showButtons,this)}else{Ext.getCmp(this.savebtn.id).addCls("savebtn-button"+this.id);Ext.getCmp(this.cancelbtn.id).addCls("cancelbtn-button"+this.id);this.savebtn.show();this.cancelbtn.show()}},doButtons:function(){this.setButtonsDisabled(!this.form.isDirty())},setButtonsDisabled:function(j){if(Zenoss.Security.hasPermission("Manage Device")){this.savebtn.setDisabled(j)}this.cancelbtn.setDisabled(j)},onFieldAdd:function(j){if(!j.isXType("displayfield")){this.showButtons();this.mon(j,"dirtychange",this.doButtons,this)}},hideFooter:function(){this.footer.hide()},showFooter:function(){this.footer.show()},addField:function(j){this.add(j)},addFieldAfter:function(l,k){var j=this._indexOfFieldName(k)+1;this.insert(j,l)},_indexOfFieldName:function(l){var j=-1,k=this.getItems(),m;for(m=0;m<k.length;m++){if(k[m].name==l){j=m;break}}return j},replaceField:function(j,k){this.removeField(j);this.addField(k)},removeField:function(j){var k=this.getField(j);if(k){this.remove(k)}},getField:function(j){return this.getItems()[this._indexOfFieldName(j)]},getItems:function(){return this.items.items}});Ext.define("Zenoss.DeviceOverviewPanel",{alias:["widget.deviceoverview"],extend:"Ext.Panel",constructor:function(j){j=Ext.applyIf(j||{},{autoScroll:true,bodyCls:"device-overview-panel",padding:"10",frame:false,forms:[],listeners:{add:function(l,k){Ext.each(k.items.items,function(m){if(m.isXType("form")){var n=m.getForm();n.api=this.api;n.baseParams=this.baseParams;this.forms.push(m)}},this)}},items:[{layout:{type:"hbox"},id:"deviceoverviewpanel_main",defaults:{bodyStyle:"background-color:#fafafa;",minHeight:350,margin:"0 10 10 0",flex:1},defaultType:"devformpanel",items:[{id:"deviceoverviewpanel_summary",defaultType:"displayfield",frame:false,items:[{fieldLabel:_t("Device ID"),id:"device-id-label",name:"device"},{fieldLabel:_t("Uptime"),id:"uptime-label",name:"uptime"},{fieldLabel:_t("First Seen"),id:"first-seen-label",name:"firstSeen"},{fieldLabel:_t("Last Change"),id:"last-change-label",name:"lastChanged"},{fieldLabel:_t("Model Time"),id:"model-time-label",name:"lastCollected"},{fieldLabel:_t("Locking"),id:"locking-label",name:"locking"},{xtype:"displayfield",id:"memory-displayfield",name:"memory",fieldLabel:_t("Memory/Swap")}]},{id:"deviceoverviewpanel_idsummary",defaultType:"displayfield",frame:false,listeners:{actioncomplete:function(l,m){if(m.type=="directsubmit"){var k=Ext.getCmp("devdetailbar");if(k){k.refresh()}}}},items:[{xtype:"textfield",name:"name",fieldLabel:_t("Device Title"),id:"device-name-textfield",allowBlank:false},{xtype:"ProductionStateCombo",fieldLabel:_t("Production State"),id:"production-state-combo",name:"productionState"},{xtype:"PriorityCombo",fieldLabel:_t("Priority"),id:"priority-combo",name:"priority"},{fieldLabel:_t("Tag"),name:"tagNumber",id:"tagnumber-textfield",xtype:"textfield"},{fieldLabel:_t("Serial Number"),name:"serialNumber",id:"serialnumber-textfield",xtype:"textfield"}]},{id:"deviceoverviewpanel_descriptionsummary",defaultType:"textfield",frame:false,items:[{fieldLabel:_t("Rack Slot"),name:"rackSlot",id:"rackslot-textfield",xtype:"textfield"},{xtype:"clicktoeditnolink",permission:"Manage Device",listeners:{labelclick:function(k){e(this.getValues(),this.contextUid)},scope:this},fieldLabel:_t("Collector"),name:"collector",id:"collector-editnolink"},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){f(this.getValues(),this.contextUid)},scope:this},name:"hwManufacturer",id:"hwmanufacturer-editlink",fieldLabel:_t("Hardware Manufacturer")},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){f(this.getValues(),this.contextUid)},scope:this},name:"hwModel",id:"hwmodel-editlink",fieldLabel:_t("Hardware Model")},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){f(this.getValues(),this.contextUid)},scope:this},name:"osManufacturer",id:"osmanufacturer-editlink",fieldLabel:_t("OS Manufacturer")},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){f(this.getValues(),this.contextUid)},scope:this},name:"osModel",id:"osmodel-editlink",fieldLabel:_t("OS Model")}]}]},{id:"deviceoverviewpanel_customsummary",defaultType:"devformpanel",frame:false,layout:"hbox",defaults:{bodyStyle:"background-color:#fafafa;",minHeight:400,margin:"0 10 10 0"},layoutConfig:{align:"stretchmax"},items:[{defaultType:"displayfield",flex:2,minHeight:400,frame:false,id:"deviceoverviewpanel_systemsummary",items:[{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){d(this.getValues().systems,this.contextUid,{title:_t("Set Systems"),instructions:_t("Add/Remove systems"),getGroupFn:Zenoss.remote.DeviceRouter.getSystems,getGroupRoot:"systems",dmdPrefix:"/zport/dmd/Systems"})},scope:this},fieldLabel:_t("Systems"),name:"systems",id:"systems-editlink"},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){d(this.getValues().groups,this.contextUid,{title:_t("Set Groups"),instructions:_t("Add/Remove groups"),getGroupFn:Zenoss.remote.DeviceRouter.getGroups,getGroupRoot:"groups",dmdPrefix:"/zport/dmd/Groups"})},scope:this},fieldLabel:_t("Groups"),name:"groups",id:"groups-editlink"},{xtype:"clicktoedit",permission:"Manage Device",listeners:{labelclick:function(k){a(this.getValues(),this.contextUid)},scope:this},fieldLabel:_t("Location"),name:"location",id:"location-editlink"},{fieldLabel:_t("Links"),name:"links",id:"links-label"},{xtype:"textarea",grow:true,fieldLabel:_t("Comments"),name:"comments",id:"comments-textarea"}]},{id:"deviceoverviewpanel_snmpsummary",defaultType:"displayfield",frame:false,flex:1,bodyStyle:"background-color:#fafafa;",minHeight:400,items:[{fieldLabel:_t("SNMP SysName"),name:"snmpSysName",id:"snmpsysname-label"},{fieldLabel:_t("SNMP Location"),name:"snmpLocation",id:"snmplocation-label"},{fieldLabel:_t("SNMP Contact"),name:"snmpContact",id:"snmpcontact-label"},{fieldLabel:_t("SNMP Description"),autoWidth:true,name:"snmpDescr",id:"snmpdescr-label"},{fieldLabel:_t("SNMP Community"),name:"snmpCommunity",id:"snmpcommunity-label",hidden:Zenoss.Security.doesNotHavePermission("Manage Device")},{fieldLabel:_t("SNMP Version"),name:"snmpVersion",id:"snmpversion-label"}]}]}]});Zenoss.DeviceOverviewPanel.superclass.constructor.call(this,j)},api:{load:Zenoss.util.isolatedRequest(g.getInfo),submit:function(k,n,j){var m={},l=j.form.getValues(false,true);Ext.apply(m,l,j.form.baseParams);g.setInfo(m,function(o){this.form.clearInvalid();this.form.setValues(l);this.form.afterAction(this,true);this.form.reset()},j)}},baseParams:{},setContext:function(j){this.contextUid=j;this.baseParams.uid=j;if(!this.getEl()){this.on("afterrender",this.load,this,{single:true})}else{this.load()}},getFieldNames:function(){var k=[],j;Ext.each(this.forms,function(l){Ext.each(l.getForm().getFields().items,function(m){j=m.name;if(Ext.Array.indexOf(k,j)==-1&&(j!="links")&&(j!="uptime")){k.push(j)}})});return k},load:function(){var k=Ext.apply({keys:this.getFieldNames()},this.baseParams),j=this;var l=function(m){var o=m.data;if(o.locking){o.locking=Zenoss.render.locking(o.locking)}if(o.memory){o.memory=o.memory.ram+"/"+o.memory.swap}else{o.memory="Unknown/Unknown"}o.comments=Ext.htmlDecode(o.comments);o.tagNumber=Ext.htmlDecode(o.tagNumber);o.serialNumber=Ext.htmlDecode(o.serialNumber);o.rackSlot=Ext.htmlDecode(o.rackSlot);o.name=Ext.htmlDecode(o.name);this.setValues(o);var n=Ext.apply({keys:["links","uptime"]},this.baseParams);this.api.load(n,function(p){this.setValues(p.data)},this)};if(Zenoss.env.infoObject){Ext.bind(l,this,[Zenoss.env.infoObject])();delete Zenoss.env.infoObject}else{this.api.load(k,l,this)}},getValues:function(){var j={};Ext.each(this.forms,function(k){Ext.apply(j,k.getForm().getValues(false,false,true,true))},this);return j},setValues:function(j){this.suspendLayouts();Ext.each(this.forms,function(k){k.getForm().setValues(j)});this.resumeLayouts(true)}})})();(function(){Ext.define("Zenoss.DeviceDetailItem",{alias:["widget.devdetailitem"],extend:"Ext.Container",constructor:function(a){a=Ext.applyIf(a||{},{hideParent:true,cls:"devdetailitem",items:[{cls:"devdetail-textitem "+(a.textCls||""),ref:"textitem",xtype:"tbtext",text:a.text||""},{cls:"devdetail-labelitem "+(a.labelCls||""),ref:"labelitem",xtype:"tbtext",text:a.label||""}]});Zenoss.DeviceDetailItem.superclass.constructor.call(this,a)},setText:function(a){this.textitem.setText(a)},setLabel:function(a){this.labelitem.setText(a)}});Ext.define("Zenoss.DeviceNameItem",{alias:["widget.devnameitem"],extend:"Ext.Container",constructor:function(a){a=Ext.applyIf(a||{},{defaults:{xtype:"tbtext"},items:[{cls:"devdetail-devname",ref:"devname"},{ref:"devclass",cls:"devdetail-devclass"},{ref:"ipAddress",cls:"devdetail-ipaddress"}]});Zenoss.DeviceNameItem.superclass.constructor.call(this,a)}});Ext.define("Zenoss.DeviceDetailBar",{alias:["widget.devdetailbar"],extend:"Zenoss.LargeToolbar",constructor:function(a){a=Ext.applyIf(a||{},{cls:"largetoolbar devdetailbar",height:55,directFn:Zenoss.remote.DeviceRouter.getInfo,defaultType:"devdetailitem",items:[{ref:"iconitem",cls:"devdetail-icon"},{cls:"evdetail-sep"},{xtype:"devnameitem",height:45,ref:"deviditem"},"-",{xtype:"eventrainbow",width:202,ref:"eventsitem",id:"detailrainbow",label:_t("Events"),listeners:{render:function(b){b.getEl().on("click",function(){Ext.History.add("#deviceDetailNav:device_events")})}},count:4},"-",{ref:"statusitem",width:98,label:_t("Device Status"),id:"statusitem"},"-",{ref:"prodstateitem",width:120,label:_t("Production State"),id:"prodstateitem"},"-",{ref:"priorityitem",width:100,label:_t("Priority"),id:"priorityitem"}]});this.contextKeys=["ipAddressString","deviceClass","name","icon","status","productionState","priority"];Zenoss.DeviceDetailBar.superclass.constructor.call(this,a)},contextCallbacks:[],addDeviceDetailBarItem:function(d,c,a){this.add("-");this.add(d);this.on("contextchange",c,this);for(var b=0;b<a.length;b++){this.contextKeys.push(a[b])}},refresh:function(){this.setContext(this.contextUid)},setContext:function(a){this.contextUid=a;this.directFn({uid:a,keys:this.contextKeys},function(c){this.suspendLayouts();this.layout.targetEl.setWidth(this.getWidth());var h=Zenoss.render,g=c.data;Zenoss.env.icon=this.iconitem;this.iconitem.getEl().setStyle({"background-image":"url("+g.icon+")"});this.deviditem.devname.setText(Ext.htmlEncode(g.name));var d=g.ipAddressString;this.deviditem.ipAddress.setText(d);this.deviditem.devclass.setText(h.DeviceClass(g.deviceClass.uid));this.eventsitem.setContext(a);this.statusitem.setText(h.pingStatusLarge(g.status));var b=Zenoss.env.PRODUCTION_STATES_MAP[g.productionState];var f="<span title='"+b+"'>";f+=b.length>14?b.substring(0,12)+"...":b;f+="</span>";this.prodstateitem.setText(f);this.priorityitem.setText(Zenoss.env.PRIORITIES_MAP[g.priority]);this.iconitem.setPosition(0,0);Ext.getCmp(Ext.query(".evdetail-sep")[0].id).setPosition(this.iconitem.getWidth()+this.iconitem.x,0);var e=Ext.isEmpty(d)?7:-2;this.deviditem.setPosition(this.iconitem.getWidth()+this.iconitem.x+30,e);Ext.getCmp("detailrainbow").setPosition(this.deviditem.devname.getWidth()+this.deviditem.x+30,3);this.statusitem.setPosition(Ext.getCmp("detailrainbow").getWidth()+Ext.getCmp("detailrainbow").x+30,-2);Ext.getCmp(Ext.query(".x-toolbar-separator")[0].id).setPosition(this.statusitem.getWidth()+this.statusitem.x+10,14);this.prodstateitem.setPosition(this.statusitem.getWidth()+this.statusitem.x+30,-2);Ext.getCmp(Ext.query(".x-toolbar-separator")[1].id).setPosition(this.prodstateitem.getWidth()+this.prodstateitem.x+10,14);this.priorityitem.setPosition(this.prodstateitem.getWidth()+this.prodstateitem.x+30,-2);this.fireEvent("contextchange",this,g);this.resumeLayouts()},this)}})})();(function(){Ext.ns("Zenoss");Ext.define("Zenoss.ConsoleBar",{alias:["widget.consolebar"],extend:"Zenoss.LargeToolbar",constructor:function(b){var c=this;var d=b.title||"Title";var a=b.parentPanel;delete b.title;b=Ext.apply(b||{},{cls:"largetoolbar consolebar",height:35,collapseTitle:"Instances",items:[{xtype:"tbtext",text:d}].concat(b.leftItems||[]).concat([{xtype:"tbfill"}])});this.callParent(arguments)},toggleDockedItemPosition:function(){this.up("panel").removeDocked(this,false);if(this.parentPanel.collapsed){this.moveToSouthRegion()}else{this.moveToCenterRegion()}},_getRegion:function(b){var a=null;Ext.getCmp(this.centerPanel).items.each(function(c){if(c.region==b){a=c}});return a},moveToSouthRegion:function(){this.dock="top";this._getRegion("south").addDocked(this);this.parentPanel.setHeight(this.oldHeight);this.parentPanel.expand()},moveToCenterRegion:function(){this.dock="bottom";this._getRegion("center").addDocked(this,0);this.oldHeight=Math.max(this.parentPanel.getEl().getComputedHeight(),this.parentPanel.initialConfig.height);this.parentPanel.collapse();this.parentPanel.setHeight(0)}})})();(function(){Ext.ns("Zenoss");Ext.define("Zenoss.AddToZenPackWindow",{alias:["widget.AddToZenPackWindow"],extend:"Zenoss.dialog.BaseWindow",constructor:function(a){var b=this;a=Ext.applyIf(a||{},{title:_t("Add to Zen Pack"),layout:"fit",modal:true,autoHeight:true,width:310,plain:true,items:[{id:"addzenpackform",xtype:"form",listeners:{validitychange:function(c,d){b.query("DialogButton")[0].setDisabled(!d)}},defaults:{width:250},autoHeight:true,frame:false,fieldDefaults:{labelWidth:100,labelAlign:"top"},buttonAlign:"left",items:[{fieldLabel:_t("Zen Pack"),name:"zpname",xtype:"combo",emptyText:_t("Please select a zenpack..."),listEmptyText:_t("No zenpacks available"),allowBlank:false,listConfig:{resizable:true},store:new Zenoss.NonPaginatedStore({id:"myzpstore",root:"packs",model:"Zenoss.model.Name",totalProperty:"totalCount",directFn:Zenoss.remote.ZenPackRouter.getEligiblePacks}),valueField:"name",displayField:"name",forceSelection:true,triggerAction:"all",selectOnFocus:true,id:"zpcombobox"}],buttons:[{text:_t("Submit"),xtype:"DialogButton",disabled:true,handler:function(){var d;d=Ext.getCmp("addzenpackform");var c=d.getForm().findField("zpname").getValue();Zenoss.remote.ZenPackRouter.addToZenPack({topack:b.target,zenpack:c},function(e){Zenoss.message.info(_t("The item was added to the zenpack, {0}"),c)})}},{text:_t("Cancel"),xtype:"DialogButton"}]}]});Zenoss.AddToZenPackWindow.superclass.constructor.call(this,a)},setTarget:function(a){this.target=a}})})();(function(){Ext.ns("Zenoss");Zenoss.VerticalBrowsePanel=Ext.extend(Ext.Panel,{constructor:function(a){a=Ext.applyIf(a||{},{layout:"hbox",border:false,layoutConfig:{align:"stretch"},defaults:{flex:1,autoScroll:true}});Zenoss.VerticalBrowsePanel.superclass.constructor.call(this,a)}})})();(function(){var b=Ext.ns("Zenoss.component"),a=b.nameMap={};b.registerName=function(e,g,f){a[e]=[g,f]};b.displayName=function(e){return a[e]||[e,e]};b.displayNames=function(){return a};function d(e){if(e&&e.uid){return Zenoss.render.link(e.uid)}else{return e}}function c(){var e=["eventState","severity","eventClass","summary","firstTime","lastTime","count"],f;f=Zenoss.util.filter(Zenoss.env.COLUMN_DEFINITIONS,function(g){return Ext.Array.indexOf(e,g.dataIndex)!=-1});Ext.Array.each(f,function(g){if(g.id){delete g.id}});return f}Zenoss.nav.register({Component:[{nodeType:"subselect",id:"Graphs",text:_t("Graphs"),action:function(j,l,k){var f=k.contextUid,h="graph_panel",e={id:h,xtype:"graphpanel",viewName:"graphs",showToolbar:false,text:_t("Graphs")};if(!Ext.get("graph_panel")){l.add(e)}l.layout.setActiveItem(h);l.layout.activeItem.setContext(f);var m=l.getDockedItems()[0];if(m._btns){Ext.each(m._btns,m.remove,m)}var g=m.add(["->",{xtype:"drangeselector",listeners:{select:function(r,o,p){var q=o[0].data.id,n=Ext.getCmp(h);n.setDrange(q)}}},"-",{xtype:"button",ref:"../resetBtn",text:_t("Reset"),handler:function(n){Ext.getCmp(h).setDrange()}},"-",{xtype:"tbtext",text:_t("Link Graphs?")},{xtype:"checkbox",ref:"../linkGraphs",checked:true,listeners:{change:function(p,o){var n=Ext.getCmp(h);n.setLinked(o)}}},"-",{xtype:"graphrefreshbutton",stateId:"ComponentGraphRefresh",iconCls:"refresh",text:_t("Refresh"),handler:function(n){if(h&&Ext.getCmp(h)){Ext.getCmp(h).resetSwoopies()}}}]);m.doLayout();m._btns=g;k.on("select",function(o,n){if(o.value!="Graphs"){Ext.each(g,m.remove,m)}},this,{single:true})}},{nodeType:"subselect",id:"Events",text:_t("Events"),action:function(h,m,g){var l=g.contextUid,f="event_panel",n=function(){m.layout.setActiveItem(f);m.layout.activeItem.setContext(l)};if(!Ext.get("event_panel")){var e=m.add({id:f,xtype:"SimpleEventGridPanel",displayFilters:false,stateId:"component-event-console",columns:c()})}var j=m.getDockedItems()[0];if(j._btns){Ext.each(j._btns,j.remove,j)}var k=j.add(["-",new Zenoss.ActionButton({iconCls:"acknowledge",tooltip:_t("Acknowledge events"),permission:"Manage Events",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.acknowledge)}}),new Zenoss.ActionButton({iconCls:"close",tooltip:_t("Close events"),permission:"Manage Events",handler:function(){Zenoss.EventActionManager.execute(Zenoss.remote.EventsRouter.close)}}),new Zenoss.ActionButton({iconCls:"refresh",permission:"View",tooltip:_t("Refresh events"),handler:function(p){var o=p.grid||this.ownerCt.ownerCt;if(o.getComponent("event_panel")){o=o.getComponent("event_panel")}o.refresh()}}),"-",new Zenoss.ActionButton({iconCls:"newwindow",permission:"View",tooltip:_t("Go to event console"),handler:function(r){var u=Ext.state.Manager.get("evconsole")||{},s=u.filters||{},q=/devices\/([^\/]+)(\/.*\/([^\/]+)$)?/,p,o,t=Ext.getCmp("event_panel").uid.match(q);if(t){s.device=t[1];s.component=Ext.getCmp("component_card").componentgrid.getView().getSelectionModel().getSelected().get("name")}u.filters=s;p=encodeURIComponent(Zenoss.util.base64.encode(Ext.encode(u)));o="/zport/dmd/Events/evconsole?state="+p;window.open(o,"_newtab","")}})]);j.doLayout();j._btns=k;g.on("select",function(p,o){if(p.value!="Events"){Ext.each(k,j.remove,j)}},this,{single:true});n()}},{nodeType:"subselect",id:"Edit",text:_t("Details"),action:function(f,h,g){var e=g.contextUid;if(!Ext.get("edit_panel")){Zenoss.form.getGeneratedForm(e,function(j){h.add(Ext.apply({id:"edit_panel"},j));h.layout.setActiveItem("edit_panel")})}else{h.layout.setActiveItem("edit_panel");h.layout.activeItem.setContext(e)}}},{nodeType:"subselect",id:"ComponentTemplate",text:_t("Templates"),action:function(f,h,g){var e=g.contextUid;if(!Ext.get("templates_panel")){h.add(Ext.create("Zenoss.ComponentTemplatePanel",{ref:"componentTemplatePanel",id:"templates_panel"}))}h.componentTemplatePanel.setContext(e);h.layout.setActiveItem("templates_panel")}}]});Ext.define("Zenoss.component.ComponentDetailNav",{alias:["widget.componentnav"],extend:"Zenoss.DetailNavPanel",constructor:function(e){Ext.applyIf(e,{autoHeight:true,autoScroll:true,containerScroll:true,menuIds:[]});b.ComponentDetailNav.superclass.constructor.call(this,e);this.relayEvents(this.getSelectionModel(),["selectionchange"]);this.on("selectionchange",this.onSelectionChange)},onGetNavConfig:function(g){var h=this.ownerCt.ownerCt.ownerCt.componentgrid,f=[],e=false;Zenoss.env.GRID=h;Ext.each(h.store.data.items,function(j){if(j.data.monitor){e=true}});Zenoss.util.each(Zenoss.nav.get("Component"),function(j){if(!(j.id=="Graphs"&&!e)){f.push(j)}});return f},filterNav:function(g,f){var e=["status","events","resetcommunity","pushconfig","objtemplates","modeldevice","historyevents"];return(Ext.Array.indexOf(e,f.id)==-1)},onSelectionChange:function(h,e){var g=this.target||Ext.getCmp("component_detail_panel"),f=e.data.action||Ext.bind(function(k,l){var m=k.get("id");if(!(m in l.items.map)){var j=this.panelConfigMap[m];if(j){l.add(j);l.doLayout()}}l.items.map[m].setContext(this.contextId);l.layout.setActiveItem(m)},this);f(e,g)}});Ext.define("Zenoss.component.ComponentPanel",{alias:["widget.componentpanel"],extend:"Ext.Panel",constructor:function(f){var g=f.gridtbar,e=Ext.id();if(g){if(Ext.isArray(g)){g={items:g}}Ext.apply(g,{id:e})}f=Ext.applyIf(f||{},{tbarid:e,layout:"border",items:[{region:"north",height:250,split:true,ref:"gridcontainer",tbar:g,layout:"fit"},{xtype:"contextcardpanel",region:"center",ref:"detailcontainer",split:true,tbar:{cls:"largetoolbar componenttbar",height:32,items:[{xtype:"tbtext",text:_t("Display: ")},{xtype:"detailnavcombo",menuIds:[],onGetNavConfig:Ext.bind(function(l){var k=this.componentgrid,j=[],h=false;Ext.each(k.store.data.items,function(m){if(m.data.uid==l&&m.data.monitor){h=true}});Zenoss.util.each(Zenoss.nav.get("Component"),function(m){j.push(m)});return j},this),filterNav:function(h){var j=["status","events","resetcommunity","pushconfig","objtemplates","template","modeldevice","historyevents"];return(Ext.Array.indexOf(j,h.id)==-1)},ref:"../../componentnavcombo",getTarget:Ext.bind(function(){return this.detailcontainer},this)}]}}]});b.ComponentPanel.superclass.constructor.call(this,f);this.addEvents("contextchange")},getGridToolbar:function(){return Ext.getCmp(this.tbarid)},selectByToken:function(f){if(f){var e=this.componentgrid;e.selectByToken(f)}},setContext:function(e,f){this.contextUid=e;if(f!=this.componentType){this.componentType=f;var g=this.componentType+"Panel",h=Ext.ClassManager.getByAlias("widget."+g)?g:"ComponentGridPanel";this.gridcontainer.removeAll();this.gridcontainer.add({xtype:h,componentType:this.componentType,ref:"../componentgrid",listeners:{render:function(j){j.setContext(e)},rangeselect:function(j){this.detailcontainer.removeAll();this.componentnavcombo.reset()},selectionchange:function(n,l){var m=l[0];if(m){this.detailcontainer.removeAll();this.componentnavcombo.reset();Zenoss.env.compUUID=m.data.uuid;this.componentnavcombo.setContext(m.data.uid);var j=Ext.History.DELIMITER,k=Ext.History.getToken().split(j,2).join(j);Ext.History.add(k+j+m.data.uid);Ext.getCmp("component_monitor_menu_item").setDisabled(!m.data.usesMonitorAttribute)}else{this.detailcontainer.removeAll();this.componentnavcombo.reset()}},scope:this}});this.gridcontainer.doLayout()}else{this.componentgrid.setContext(e)}this.fireEvent("contextchange",this,e,f)}});Ext.define("Zenoss.component.ComponentGridPanel",{alias:["widget.ComponentGridPanel"],extend:"Zenoss.BaseGridPanel",lastHash:null,constructor:function(f){f=f||{};f.fields=f.fields||[{name:"severity"},{name:"name"},{name:"monitored"},{name:"locking"}];f.fields.push({name:"uuid"});f.fields.push({name:"uid"});f.fields.push({name:"meta_type"});f.fields.push({name:"monitor"});var g=f.autoExpandColumn;if(g&&f.columns){Ext.each(f.columns,function(j){if(g==j.id){j.flex=1}})}Ext.each(f.columns,function(j){delete j.id});var h=Ext.id(),e=Ext.define(h,{extend:"Ext.data.Model",idProperty:"uuid",fields:f.fields});f.sortInfo=f.sortInfo||{};f=Ext.applyIf(f,{autoExpandColumn:"name",bbar:{},store:new b.BaseComponentStore({model:h,initialSortColumn:f.sortInfo.field||"name",initialSortDirection:f.sortInfo.direction||"ASC",directFn:f.directFn||Zenoss.remote.DeviceRouter.getComponents}),columns:[{id:"component_severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:50},{id:"name",dataIndex:"name",header:_t("Name"),flex:1},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:65,sortable:true},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons,width:65}],selModel:new Ext.selection.RowModel({mode:"MULTI",getSelected:function(){var j=this.getSelection();if(!j.length){return null}return j[0]}})});b.ComponentGridPanel.superclass.constructor.call(this,f);this.relayEvents(this.getSelectionModel(),["rangeselect"]);this.store.proxy.on("load",function(k,l,j){this.lastHash=l.result.hash||this.lastHash},this);Zenoss.util.addLoadingMaskToGrid(this)},applyOptions:function(e){var f=this.getStore().getProxy().extraParams;Ext.apply(f,{uid:this.contextUid,keys:Ext.Array.pluck(this.fields,"name"),meta_type:this.componentType,name:this.componentName})},filter:function(e){this.componentName=e;this.refresh()},setContext:function(e){this.contextUid=e;this.getStore().on("guaranteedrange",function(){var f=Ext.History.getToken();if(f.split(Ext.History.DELIMITER).length!=3){this.getSelectionModel().selectRange(0,0)}},this,{single:true});this.callParent(arguments)},selectByToken:function(j){var h=this.getStore(),e=this.getSelectionModel(),f=this.getView(),k=this,g=function(){function l(){var p=false,o=0;h.each(function(q){if(q.get("uid")==j){e.select(q);f.focusRow(q.index);p=true;h.un("guaranteedrange",l,k);return false}o++;return true});return p}var m=l();if(!m){var n={componentUid:j};Ext.apply(n,h.getProxy().extraParams);Zenoss.remote.DeviceRouter.findComponentIndex(n,function(p){if(Ext.isNumeric(p.index)){h.on("guaranteedrange",l,k);var o=k.verticalScroller;k.getView().scrollBy({x:0,y:o.rowHeight*p.index},true)}else{e.select(0)}})}};if(!h.loaded){h.on("guaranteedrange",g,this,{single:true})}else{g()}}});Ext.define("Zenoss.component.BaseComponentStore",{extend:"Zenoss.DirectStore",constructor:function(e){Ext.applyIf(e,{pageSize:Zenoss.settings.componentGridBufferSize,directFn:e.directFn});b.BaseComponentStore.superclass.constructor.call(this,e);this.on("guaranteedrange",function(){this.loaded=true},this)}});Ext.define("Zenoss.component.IpInterfacePanel",{alias:["widget.IpInterfacePanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"IpInterface",autoExpandColumn:"description",fields:[{name:"uid"},{name:"severity"},{name:"name"},{name:"description"},{name:"ipAddressObjs"},{name:"network"},{name:"macaddress"},{name:"usesMonitorAttribute"},{name:"operStatus"},{name:"adminStatus"},{name:"status"},{name:"monitor"},{name:"monitored"},{name:"locking"},{name:"duplex"},{name:"netmask"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:50},{id:"name",dataIndex:"name",header:_t("IP Interface"),width:150},{id:"ipAddresses",dataIndex:"ipAddressObjs",header:_t("IP Addresses"),renderer:function(g){var f="";Ext.each(g,function(k,j){if(j>0){f+=", "}if(k&&Ext.isObject(k)&&k.netmask){var h=k.name+"/"+k.netmask;f+=Zenoss.render.link(k.uid,undefined,h)}else{if(Ext.isString(k)){f+=k}}});return f}},{id:"description",dataIndex:"description",header:_t("Description")},{id:"macaddress",dataIndex:"macaddress",header:_t("MAC Address"),width:120},{id:"status",dataIndex:"status",header:_t("Monitored"),renderer:Zenoss.render.pingStatus,width:80},{id:"operStatus",dataIndex:"operStatus",header:_t("Operational Status"),width:110},{id:"adminStatus",dataIndex:"adminStatus",header:_t("Admin Status"),width:80},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:60},{id:"locking",dataIndex:"locking",header:_t("Locking"),width:72,renderer:Zenoss.render.locking_icons}]});b.IpInterfacePanel.superclass.constructor.call(this,e)}});b.registerName("IpInterface",_t("Interface"),_t("Interfaces"));Ext.define("Zenoss.component.WinServicePanel",{alias:["widget.WinServicePanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"WinService",fields:[{name:"uid"},{name:"severity"},{name:"status"},{name:"name"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"},{name:"caption"},{name:"startMode"},{name:"startName"},{name:"serviceClassUid"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"name",dataIndex:"name",flex:1,header:_t("Service Name"),renderer:Zenoss.render.WinServiceClass},{id:"caption",dataIndex:"caption",header:_t("Caption")},{id:"startMode",dataIndex:"startMode",header:_t("Start Mode")},{id:"startName",dataIndex:"startName",header:_t("Start Name")},{id:"status",dataIndex:"status",header:_t("Status"),renderer:Zenoss.render.pingStatus,width:60},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:60},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.WinServicePanel.superclass.constructor.call(this,e)}});b.registerName("WinService",_t("Windows Service"),_t("Windows Services"));Ext.define("Zenoss.component.IpRouteEntryPanel",{alias:["widget.IpRouteEntryPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"IpRouteEntry",autoExpandColumn:"destination",fields:[{name:"uid"},{name:"destination"},{name:"nextHop"},{name:"id"},{name:"device"},{name:"interface"},{name:"protocol"},{name:"type"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitored"}],columns:[{id:"destination",dataIndex:"destination",header:_t("Destination"),renderer:d},{id:"nextHop",dataIndex:"nextHop",header:_t("Next Hop"),renderer:Zenoss.render.nextHop,width:250},{id:"interface",dataIndex:"interface",header:_t("Interface"),renderer:d},{id:"protocol",dataIndex:"protocol",header:_t("Protocol")},{id:"type",dataIndex:"type",header:_t("Type"),width:50},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.IpRouteEntryPanel.superclass.constructor.call(this,e)}});b.registerName("IpRouteEntry",_t("Network Route"),_t("Network Routes"));Ext.define("Zenoss.component.IpServicePanel",{alias:["widget.IpServicePanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"IpService",fields:[{name:"uid"},{name:"name"},{name:"status"},{name:"severity"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"},{name:"locking"},{name:"protocol"},{name:"description"},{name:"ipaddresses"},{name:"port"},{name:"serviceClassUid"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"name",dataIndex:"name",header:_t("Name"),flex:1,renderer:Zenoss.render.IpServiceClass},{id:"protocol",dataIndex:"protocol",header:_t("Protocol")},{id:"port",dataIndex:"port",header:_t("Port")},{id:"ipaddresses",dataIndex:"ipaddresses",header:_t("IPs"),renderer:function(f){return f.join(", ")}},{id:"description",dataIndex:"description",header:_t("Description")},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:60},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.IpServicePanel.superclass.constructor.call(this,e)}});b.registerName("IpService",_t("IP Service"),_t("IP Services"));Ext.define("Zenoss.component.OSProcessPanel",{alias:["widget.OSProcessPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"OSProcess",autoExpandColumn:"processName",fields:[{name:"uid"},{name:"processName"},{name:"status"},{name:"severity"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"},{name:"locking"},{name:"processClass"},{name:"processClassName"},{name:"alertOnRestart"},{name:"failSeverity"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"processClass",dataIndex:"processClass",header:_t("Process Class"),renderer:function(g,h,f){if(g&&g.uid){return Zenoss.render.link(g.uid,null,f.raw.processClassName)}else{return g}}},{id:"processName",dataIndex:"processName",header:_t("Process Set")},{id:"alertOnRestart",dataIndex:"alertOnRestart",renderer:Zenoss.render.checkbox,width:85,header:_t("Restart Alert?")},{id:"failSeverity",dataIndex:"failSeverity",renderer:Zenoss.render.severity,width:70,header:_t("Fail Severity")},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:60},{id:"locking",dataIndex:"locking",header:_t("Locking"),width:55,renderer:Zenoss.render.locking_icons}]});b.OSProcessPanel.superclass.constructor.call(this,e)}});b.registerName("OSProcess",_t("OS Process"),_t("OS Processes"));Ext.define("Zenoss.component.FileSystemPanel",{alias:["widget.FileSystemPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{autoExpandColumn:"mount",componentType:"FileSystem",fields:[{name:"uid"},{name:"name"},{name:"status"},{name:"severity"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"},{name:"locking"},{name:"mount"},{name:"totalBytes"},{name:"availableBytes"},{name:"usedBytes"},{name:"capacityBytes"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"mount",dataIndex:"mount",header:_t("Mount Point")},{id:"totalBytes",dataIndex:"totalBytes",header:_t("Total Bytes"),renderer:Zenoss.render.bytesString},{id:"usedBytes",dataIndex:"usedBytes",header:_t("Used Bytes"),renderer:Zenoss.render.bytesString},{id:"availableBytes",dataIndex:"availableBytes",header:_t("Free Bytes"),renderer:function(f){if(f<0){return _t("Unknown")}else{return Zenoss.render.bytesString(f)}}},{id:"capacityBytes",dataIndex:"capacityBytes",header:_t("% Util"),renderer:function(f){if(f=="unknown"||f<0){return _t("Unknown")}else{return f+"%"}}},{id:"monitored",dataIndex:"monitored",header:_t("Monitored"),renderer:Zenoss.render.checkbox,width:60},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.FileSystemPanel.superclass.constructor.call(this,e)}});b.registerName("FileSystem",_t("File System"),_t("File Systems"));Ext.define("Zenoss.component.CPUPanel",{alias:["widget.CPUPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"CPU",autoExpandColumn:"product",fields:[{name:"uid"},{name:"socket"},{name:"manufacturer"},{name:"product"},{name:"clockspeed"},{name:"extspeed"},{name:"cacheSizeL1"},{name:"cacheSizeL2"},{name:"voltage"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitored"}],columns:[{id:"socket",dataIndex:"socket",header:_t("Socket"),width:45},{id:"manufacturer",dataIndex:"manufacturer",header:_t("Manufacturer"),renderer:d},{id:"product",dataIndex:"product",header:_t("Model"),renderer:d},{id:"clockspeed",dataIndex:"clockspeed",header:_t("Speed"),width:70,renderer:function(f){return f+" MHz"}},{id:"extspeed",dataIndex:"extspeed",header:_t("Ext Speed"),width:70,renderer:function(f){return f+" MHz"}},{id:"cacheSizeL1",dataIndex:"cacheSizeL1",header:_t("L1"),width:70,renderer:function(f){return f+" KB"}},{id:"cacheSizeL2",dataIndex:"cacheSizeL2",header:_t("L2"),width:70,renderer:function(f){return f+" KB"}},{id:"voltage",dataIndex:"voltage",header:_t("Voltage"),width:70,renderer:function(f){return f+" mV"}},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.CPUPanel.superclass.constructor.call(this,e)}});b.registerName("CPU",_t("Processor"),_t("Processors"));Ext.define("Zenoss.component.ExpansionCardPanel",{alias:["widget.ExpansionCardPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"ExpansionCard",autoExpandColumn:"name",fields:[{name:"uid"},{name:"slot"},{name:"name"},{name:"serialNumber"},{name:"manufacturer"},{name:"product"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitored"}],columns:[{id:"slot",dataIndex:"slot",header:_t("Slot"),width:80},{id:"name",dataIndex:"name",header:_t("Name")},{id:"serialNumber",dataIndex:"serialNumber",header:_t("Serial Number"),width:110},{id:"manufacturer",dataIndex:"manufacturer",header:_t("Manufacturer"),renderer:d,width:110},{id:"product",dataIndex:"product",header:_t("Model"),renderer:d,width:130},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.ExpansionCardPanel.superclass.constructor.call(this,e)}});b.registerName("ExpansionCard",_t("Card"),_t("Cards"));Ext.define("Zenoss.component.PowerSupplyPanel",{alias:["widget.PowerSupplyPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"PowerSupply",autoExpandColumn:"name",fields:[{name:"uid"},{name:"severity"},{name:"name"},{name:"watts"},{name:"type"},{name:"state"},{name:"millivolts"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"name",dataIndex:"name",header:_t("Name")},{id:"watts",dataIndex:"watts",header:_t("Watts")},{id:"type",dataIndex:"type",header:_t("Type")},{id:"state",dataIndex:"state",header:_t("State")},{id:"millivolts",dataIndex:"millivolts",header:_t("Millivolts")},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.PowerSupplyPanel.superclass.constructor.call(this,e)}});b.registerName("PowerSupply",_t("Power Supply"),_t("Power Supplies"));Ext.define("Zenoss.component.TemperatureSensorPanel",{alias:["widget.TemperatureSensorPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"TemperatureSensor",autoExpandColumn:"name",fields:[{name:"uid"},{name:"severity"},{name:"name"},{name:"state"},{name:"temperature"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"name",dataIndex:"name",header:_t("Name")},{id:"state",dataIndex:"state",header:_t("State")},{id:"temperature",dataIndex:"temperature",header:_t("Temperature"),renderer:function(f){if(f==null){return""}else{return f+" F"}}},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.TemperatureSensorPanel.superclass.constructor.call(this,e)}});b.registerName("TemperatureSensor",_t("Temperature Sensor"),_t("Temperature Sensors"));Ext.define("Zenoss.component.FanPanel",{alias:["widget.FanPanel"],extend:"Zenoss.component.ComponentGridPanel",constructor:function(e){e=Ext.applyIf(e||{},{componentType:"Fan",autoExpandColumn:"name",fields:[{name:"uid"},{name:"severity"},{name:"name"},{name:"state"},{name:"type"},{name:"rpm"},{name:"locking"},{name:"usesMonitorAttribute"},{name:"monitor"},{name:"monitored"}],columns:[{id:"severity",dataIndex:"severity",header:_t("Events"),renderer:Zenoss.render.severity,width:60},{id:"name",dataIndex:"name",header:_t("Name")},{id:"state",dataIndex:"state",header:_t("State")},{id:"type",dataIndex:"type",header:_t("Type")},{id:"rpm",dataIndex:"rpm",header:_t("RPM")},{id:"locking",dataIndex:"locking",header:_t("Locking"),renderer:Zenoss.render.locking_icons}]});b.FanPanel.superclass.constructor.call(this,e)}});b.registerName("Fan",_t("Fan"),_t("Fans"))})();(function(){var a,b;Ext.define("Severity",{alias:["widget.severity"],extend:"Ext.form.ComboBox",constructor:function(c){c=c||{};Ext.applyIf(c,{fieldLabel:_t("Severity"),name:"severity",editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",queryMode:"local",store:Zenoss.env.SEVERITIES});this.callParent(arguments)}});Ext.define("ReverseSeverity",{alias:["widget.reverseseverity"],extend:"Severity",constructor:function(d){var c=[[0,"Critical"],[1,"Error"],[2,"Warning"],[3,"Info"],[4,"Debug"],[5,"Clear"]];d=d||{};Ext.applyIf(d,{store:c});this.callParent(arguments)}})}());(function(){Ext.define("Zenoss.form.EventClass",{alias:["widget.eventclass"],extend:"Ext.form.ComboBox",constructor:function(a){a=a||{};if(!Zenoss.env.EVENT_CLASSES){throw"You must include the js-snippets viewlet before you use the eventClass control"}Ext.applyIf(a,{name:"eventClass",typeAhead:true,editable:true,forceSelection:true,autoSelect:true,triggerAction:"all",listConfig:{maxWidth:250,maxHeight:250,resizable:true},queryMode:"local",store:Zenoss.env.EVENT_CLASSES});this.callParent([a])}})}());(function(){Ext.define("Zenoss.form.DataPointItemSelector",{alias:["widget.datapointitemselector"],extend:"Ext.ux.form.ItemSelector",constructor:function(b){var a=b.record;this.value=b.value;Ext.applyIf(b,{name:"dataPoints",fieldLabel:_t("Data Points"),id:"thresholdItemSelector",imagePath:"/++resource++zenui/img/xtheme-zenoss/icon",drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,store:a.allDataPoints});this.callParent(arguments)},getValue:function(){var a=this.toField.getStore();return Ext.pluck(Ext.pluck(a.data.items,"data"),"field1")}})}());(function(){Ext.ns("Zenoss");Ext.define("Zenoss.ContextMenu",{alias:["widget.ContextMenu"],extend:"Ext.Button",onSetContext:Ext.emptyFn,contextUid:null,constructor:function(a){a=a||{};Ext.applyIf(a,{id:"context-configure-menu",iconCls:"customize"});Zenoss.ContextMenu.superclass.constructor.call(this,a)},setContext:function(a){this.contextUid=a}});Ext.define("Zenoss.ContextConfigureMenu",{alias:["widget.ContextConfigureMenu"],extend:"Zenoss.ContextMenu",onGetMenuItems:function(a){return[]},onSelectionChange:Ext.emptyFn,filterMenu:function(b,a){return true},menuIds:["More","Manage","Edit","Actions","Add","TopLevel"],menu:{items:[]},disabled:true,menuItems:[],setContext:function(a){this.disable();this.onSetContext(a);this.contextUid=a;var b=this.menu;b.removeAll();this.getMenuItems(a)},addToZenPackHandler:function(b){var a=Ext.create("Zenoss.AddToZenPackWindow",{});a.setTarget(this.contextUid);a.show()},getMenuItems:function(b){var c=function(j,d){var e=[],g=0;if(this.menuItems.length!==0){e=e.concat(this.menuItems)}var f=this.onGetMenuItems(this.contextUid);if(f!==null||f.length>0){e=e.concat(f)}var k=d.result.menuItems;var h=function(l){return this.filterMenu(this,l)};k=Zenoss.util.filter(k,h,this);if(k){e=e.concat(k)}Ext.each(e,function(l){if(l.id==="addtozenpack"){l.handler=Ext.bind(this.addToZenPackHandler,this)}if(!Ext.isDefined(l.handler)){l.handler=Ext.bind(this.defaultHandler,this)}if(!l.hidden&&l!="-"){g+=1}this.menu.add(l)},this);if(this.menu.items.length!==0&&g){this.enable()}};var a={uid:b};if(this.menuIds!==null&&this.menuIds.length>=1){a.menuIds=this.menuIds}Zenoss.remote.DetailNavRouter.getContextMenus(a,c,this)},defaultHandler:function(b){var a=new Zenoss.dialog.DynamicDialog();a.setTitle(_t(b.text.replace(/\.\.\./g,"")));a.show();a.body.load({scripts:true,url:this.contextUid+"/"+b.viewName})}})})();(function(){Ext.define("Zenoss.form.parser",{alias:["widget.parser"],extend:"Ext.form.ComboBox",constructor:function(b){var a=b.record;b=b||{};Ext.applyIf(b,{fieldLabel:_t("Parser"),name:"parser",editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",minListWidth:250,listConfig:{resizable:true},queryMode:"local",store:a.availableParsers});this.callParent(arguments)}})}());(function(){Ext.define("Zenoss.form.rrdtype",{alias:["widget.rrdtype"],extend:"Ext.form.ComboBox",constructor:function(c){var a=c.record;c=c||{};var b=[];Ext.each(a.availableRRDTypes,function(d){b.push([d])});Ext.apply(c,{fieldLabel:_t("RRD Type"),name:"rrdtype",editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",queryMode:"local",displayField:"name",valueField:"name",store:Ext.create("Ext.data.ArrayStore",{model:"Zenoss.model.Name",data:b})});this.callParent(arguments)}})}());(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.Password",{alias:["widget.password"],extend:"Ext.form.TextField",constructor:function(a){a.inputType="password";Zenoss.form.Password.superclass.constructor.apply(this,arguments)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.UpDownField",{alias:["widget.updownfield"],extend:"Ext.form.ComboBox",constructor:function(a){a=Ext.applyIf(a||{},{editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",queryMode:"local",store:[[1,"Up"],[0,"Down"]]});Zenoss.form.UpDownField.superclass.constructor.call(this,a)}})})();(function(){Ext.namespace("Zenoss.form.Alias");function d(){var f=c,e=Ext.getCmp("add_alias_button"),g={};f.remove(e);f.add(a());f.add(b);f.doLayout()}var b={id:"add_alias_button",xtype:"button",ui:"dialog-dark",text:"Add",handler:d},c;function a(f,e){return{xtype:"container",bodyCls:"alias",layout:"hbox",items:[{aliasType:"id",xtype:"textfield",width:"150",value:f},{aliasType:"formula",xtype:"textfield",width:"150",style:{"margin-left":"10px;"},value:e},{xtype:"button",ui:"dialog-dark",text:"Delete",width:"10",style:{"margin-left":"10px;"},handler:function(){var g=this.findParentByType("container"),h=c;h.remove(g);h.doLayout()}}]}}Ext.define("Zenoss.form.Alias",{alias:["widget.alias"],extend:"Ext.Panel",constructor:function(g){var e=g.record.aliases,f=[],j,h;c=this;f.push({xtype:"panel",layout:"anchor",html:_t("Alias:<br>ID / FORMULA")});g=g||{};for(j=0;j<e.length;j++){h=e[j];f.push(a(h.name,h.formula))}f.push(a());f.push(b);Ext.applyIf(g,{items:f});Zenoss.form.Alias.superclass.constructor.apply(this,arguments)},getValue:function(){var h=c,e=h.query("textfield"),g=[],f,j;for(f=0;f<e.length/2;f++){g[f]={}}for(f=0;f<e.length;f++){j=e[f];g[Math.floor(f/2)][j.aliasType]=j.getValue()}return g}})}());(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.TwoColumnTextArea",{alias:["widget.twocolumntextarea"],extend:"Ext.form.TextArea",constructor:function(a){a.width=500;a.height=220;Zenoss.form.TwoColumnTextArea.superclass.constructor.apply(this,arguments)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.MultiLineDisplayField",{alias:["widget.multilinedisplayfield"],extend:"Ext.form.DisplayField",constructor:function(a){if((typeof a.value)!="string"){a.value=a.value.join("<br />")}Zenoss.form.MultiLineDisplayField.superclass.constructor.apply(this,arguments)}})}());(function(){Ext.namespace("Zenoss.inspector");Zenoss.inspector.SingleInstanceManager=Ext.extend(Object,{_instances:null,constructor:function(){this._instances={}},register:function(c,b){this.remove(c);this._instances[c]=b;b.on("destroy",function(){delete this._instances[c]},this)},get:function(b){return this._instances[b]},remove:function(b){Ext.destroyMembers(this._instances,b)}});Ext.define("Zenoss.inspector.InspectorProperty",{alias:["widget.inspectorprop"],extend:"Ext.Container",constructor:function(b){b=Ext.applyIf(b||{},{cls:"inspector-property",layout:"anchor",items:[{cls:"inspector-property-label",ref:"labelItem",xtype:"label",text:b.label?b.label+":":""},{cls:"inspector-property-value",ref:"valueItem",text:b.value||"",xtype:"panel",tpl:b.valueTpl||"{.}"}]});this.callParent(arguments)},setValue:function(b){this.valueItem.update(b)},setLabel:function(b){this.labelItem.setText(b+":")}});Ext.define("Zenoss.inspector.BaseInspector",{extend:"Ext.Panel",constructor:function(b){b=Ext.applyIf(b||{},{defaultType:"devdetailitem",layout:"anchor",bodyBorder:false,items:[],titleTpl:'<div class="name">{name}</div>'});b.items=[{layout:"hbox",cls:"inspector-header",ref:"headerItem",items:[{cls:"header-icon",ref:"iconItem",xtype:"panel"},{cls:"header-title",ref:"titleItem",xtype:"label",tpl:b.titleTpl}]},{xtype:"container",cls:"inspector-body",autoEl:"div",layout:"anchor",ref:"bodyItem",defaultType:"inspectorprop",items:b.items}];this.callParent(arguments)},setIcon:function(b){if(this.headerItem.iconItem.getEl()){this.headerItem.iconItem.getEl().setStyle("background-image","url("+b+")")}else{this.headerItem.iconItem.update(Ext.String.format('<img height="43px" src="{0}" />',b))}},addNewDataItems:function(b){return false},update:function(c){if(this.addNewDataItems(c)){this.doLayout()}var b=this;this.cascade(function(d){if(d!=b&&d.tpl){d.data=c;d.update(c)}return true});if(c.icon){this.setIcon(c.icon)}if(this.ownerCt){this.ownerCt.doLayout()}else{this.doLayout()}},addProperty:function(b,c){this.addPropertyTpl(b,"{[values."+c+' || ""]}')},addPropertyTpl:function(c,b){this.bodyItem.add({xtype:"inspectorprop",label:c,valueTpl:b})}});Zenoss.inspector.DirectInspector=Ext.extend(Zenoss.inspector.BaseInspector,{_contextUid:null,constructor:function(b){b=Ext.applyIf(b||{},{directFn:Ext.emptyFn});Zenoss.inspector.DirectInspector.superclass.constructor.call(this,b)},initComponent:function(){Zenoss.inspector.DirectInspector.superclass.initComponent.call(this);this.addEvents("contextchange");this.on("contextchange",this._onContextChange,this)},refresh:function(){this.load()},load:function(){if(this._contextUid){this.directFn({uid:this._contextUid,keys:this.keys},function(b){if(b.success){this.fireEvent("contextchange",b.data,this)}},this)}},setContext:function(b,c){this._contextUid=b;c=Ext.isDefined(c)?c:true;if(c){this.load()}},_onContextChange:function(b){this.onData(b)},onData:function(b){this.update(b)}});Ext.define("Zenoss.inspector.DeviceInspector",{alias:["widget.deviceinspector"],extend:"Zenoss.inspector.DirectInspector",constructor:function(b){b=Ext.applyIf(b||{},{directFn:Zenoss.remote.DeviceRouter.getInfo,keys:["ipAddress","device","deviceClass"],cls:"inspector",titleTpl:'<div class="name"><a href="{uid}" target="_top">{name}</a></div><div class="info">{[Zenoss.render.DeviceClass(values.deviceClass.uid)]}</div><div class="info">{[Zenoss.render.ipAddress(values.ipAddress)]}</div>'});this.callParent(arguments);this.addPropertyTpl(_t("Events"),"{[Zenoss.render.events(values.events, 4)]}");this.addPropertyTpl(_t("Device Status"),"{[Zenoss.render.pingStatus(values.status)]}");this.addProperty(_t("Production State"),"productionState");this.addPropertyTpl(_t("Location"),'{[(values.location && values.location.name) || ""]}')}});Ext.define("Zenoss.inspector.ComponentInspector",{alias:["widget.componentinspector"],extend:"Zenoss.inspector.DirectInspector",constructor:function(b){b=Ext.applyIf(b||{},{directFn:Zenoss.remote.DeviceRouter.getInfo,keys:["ipAddress","device"],cls:"inspector",titleTpl:'<div class="name"><a href="{uid}" target="_top">{name}</a></div><div class="info"><a href="{[values.device.uid]}" target="_top">{[values.device.name]}</a></div><div class="info">{[Zenoss.render.ipAddress(values.ipAddress)]}</div>'});b.items=[({label:_t("Events"),valueTpl:"{[Zenoss.render.events(values.events, 4)]}"})];this.callParent(arguments)},update:function(b){if(!b.device){b.device={}}this.callParent(arguments)}});var a=new Zenoss.inspector.SingleInstanceManager();Zenoss.inspector.createWindow=function(c,f,b,e){var d=new Ext.Window({x:(b||0),y:(e||0),cls:"inspector-window",plain:true,frame:false,constrain:true,model:false,layout:"fit",width:300,items:[{xtype:f,ref:"panelItem"}]});a.register(c,d);return d};Zenoss.inspector.registeredInspectors={device:"deviceinspector"};Zenoss.inspector.registerInspector=function(b,c){Zenoss.inspector.registeredInspectors[b.toLowerCase()]=c};Zenoss.inspector.show=function(c,b,d){Zenoss.remote.DeviceRouter.getInfo({uid:c},function(e){if(e.success){var h="componentinspector";var g=e.data.inspector_type||e.data.meta_type;if(g){g=g.toLowerCase();if(Zenoss.inspector.registeredInspectors[g]){h=Zenoss.inspector.registeredInspectors[g]}}var f=Zenoss.inspector.createWindow(c,h,b,d);f.panelItem.setContext(c,false);f.panelItem.update(e.data);f.show();f.toFront()}})}})();(function(){var c={beforedestroy:function(){this.bindStore(null)},afterrender:function(m,n){this.getStore().load()}};var f=Ext.ns("Zenoss.form.rule"),l=/^\((.*)\)$/,g=/\)( and | or )\(/,b={};f.CONJUNCTIONS={any:{text:_t("any"),tpl:" or "},all:{text:_t("all"),tpl:" and "}};var h=function(m){return[{xtype:"button",ref:"buttonAdd",iconCls:"add",handler:function(){var p=m.ownerCt,n=p.items.indexOf(m);var o=p.insert(n+1,{xtype:"ruleclause",nestedRule:m,builder:m.getBuilder()});p.doComponentLayout();o.subject.focus()},scope:m},{xtype:"button",ref:"buttonDelete",iconCls:"delete",handler:function(){m.ownerCt.remove(m,true);m.getBuilder().fireEvent("rulechange",m)},scope:m},{xtype:"button",ref:"buttonSubclause",iconCls:"classify",handler:function(){var o=m.ownerCt,n=o.items.indexOf(m);o.insert(n+1,{xtype:"nestedrule",ruleBuilder:m.getBuilder()});o.doComponentLayout()},scope:m}]};f.CONJUNCTION_STORE=[];for(var a in f.CONJUNCTIONS){if(f.CONJUNCTIONS.hasOwnProperty(a)){var d=f.CONJUNCTIONS[a];f.CONJUNCTION_STORE.push([a,d.text]);b[Ext.String.trim(d.tpl)]=a}}f.COMPARISONS={doesnotcontain:{text:_t("does not contain"),tpl:"{1} not in {0}"},doesnotstartwith:{text:_t("does not start with"),tpl:"not {0}.startswith({1})"},doesnotendwith:{text:_t("does not end with"),tpl:"not {0}.endswith({1})"},contains:{text:_t("contains"),tpl:"{1} in {0}"},startswith:{text:_t("starts with"),tpl:"{0}.startswith({1})"},endswith:{text:_t("ends with"),tpl:"{0}.endswith({1})"},equals:{text:_t("equals"),tpl:"{0} == {1}"},doesnotequal:{text:_t("does not equal"),tpl:"{0} != {1}"},lessthan:{text:_t("is less than"),tpl:"{0} < {1}",field:{xtype:"numberfield"}},greaterthan:{text:_t("is greater than"),tpl:"{0} > {1}",field:{xtype:"numberfield"}},lessthanorequalto:{text:_t("is less than or equal to"),tpl:"{0} <= {1}",field:{xtype:"numberfield"}},greaterthanorequalto:{text:_t("is greater than or equal to"),tpl:"{0} >= {1}",field:{xtype:"numberfield"}}};f.COMPARISON_STORE=[];var e={};for(var k in f.COMPARISONS){if(f.COMPARISONS.hasOwnProperty(k)){var j=f.COMPARISONS[k];f.COMPARISON_STORE.push([k,j.text]);e[k]=new RegExp(j.tpl.replace("(","\\(").replace(")","\\)").xsplit(/\{\d+\}/).join("(.*)"))}}Ext.define("Zenoss.form.rule.RuleClause",{alias:["widget.ruleclause"],extend:"Ext.Toolbar",constructor:function(n){n=Ext.applyIf(n||{},{cls:"rule-clause",items:[{ref:"subject",xtype:"combo",autoSelect:true,allowBlank:false,editable:false,forceSelection:true,triggerAction:"all",store:[[null,null]],listConfig:{resizable:true,maxWidth:200,maxHeight:250},getSubject:Ext.bind(function(){return this.getBuilder().subject_map[this.subject.getValue()]},this),listeners:{change:function(){if(!this.subject){return}var p=this.subject.getSubject(),o=[];this.comparison.reset();if(p.comparisons){Ext.each(p.comparisons,function(q){var r=f.COMPARISONS[q];if(!r){return}o.push([q,r.text])})}else{o=f.COMPARISON_STORE}this.comparison.store.loadData(o);this.comparison.setValue(o[0][0]);this.getBuilder().fireEvent("rulechange",this)},scope:this}},{ref:"comparison",xtype:"combo",autoSelect:true,editable:false,allowBlank:false,store:f.COMPARISON_STORE,value:f.COMPARISON_STORE[0][0],forceSelection:true,triggerAction:"all",listConfig:{maxWidth:200},listeners:{change:function(){var q=f.COMPARISONS[this.comparison.getValue()],s=this.subject.getSubject().field||(q&&q.field)||{xtype:"textfield"},p=Ext.Array.indexOf(this.items.items,this.predicate),r=this.predicate.getValue(),o=this.predicate.xtype;this.remove(this.predicate);this.insert(p,Ext.apply({ref:"predicate",allowBlank:false,width:150,listeners:{change:function(){this.getBuilder().fireEvent("rulechange",this)},scope:this}},s));if(typeof r!="undefined"&&this.predicate.xtype==o){this.predicate.setValue(r)}this.doComponentLayout();this.getBuilder().fireEvent("rulechange",this);this.predicate.focus()},scope:this}},{ref:"predicate",xtype:"textfield",width:150,listeners:{change:function(){this.getBuilder().fireEvent("rulechange",this)},scope:this}},"->"]});Ext.each(h(this),function(o){n.items.push(o)});this.callParent([n]);var m=this.getBuilder().subject_store;this.subject.store.loadData(m);this.subject.setValue(m[0][0]);this.on("added",function(){this.getBuilder().fireEvent("rulechange",this)},this)},getValue:function(){var p=this.comparison.getValue(),n=this.subject.getValue(),m=this.predicate.getValue();if(!p||!n||Ext.isEmpty(m)){return}var o=f.COMPARISONS[p];var q=Ext.String.format(o.tpl,this.getBuilder().prefix+n,Ext.encode(m));return Ext.String.format("({0})",q)},setValue:function(p){for(var t in e){if(e.hasOwnProperty(t)){var n=e[t];if(n.test(p)){var s=n.exec(p).slice(1),m=n.exec(f.COMPARISONS[t].tpl).slice(1),o=Ext.zip.apply(this,Ext.zip(m,s).sort())[1],q=o[0],u=o[1],r=q.replace(new RegExp("^"+this.getBuilder().prefix),"");this.subject.setValue(r);this.comparison.setValue(t);this.predicate.setValue(Ext.decode(u));break}}}},getBuilder:function(){if(!this.builder){this.builder=this.nestedRule.ruleBuilder||this.findParentByType("rulebuilder",true)}return this.builder}});f.changeListener=function(s,r){var n=this.items.items;if(n.length===0){return}var q=n[0],m=q instanceof f.NestedRule?q.items.items[0].buttonDelete:q.buttonDelete;if(n.length==1){m.disable()}else{if(n.length>1){m.enable()}}var p=0,o;while(q=q.findParentByType("nestedrule")){p++;if(p>=4){if(o=r.buttonSubclause){o.disable()}break}}};Ext.define("Zenoss.form.rule.NestedRule",{alias:["widget.nestedrule"],extend:"Ext.Container",constructor:function(n){n=Ext.applyIf(n||{},{showButtons:true,cls:"nested-rule",items:[{xtype:"toolbar",cls:"rule-clause nested-rule-header",items:[{ref:"../conjunction",xtype:"combo",width:60,store:f.CONJUNCTION_STORE,editable:false,allowBlank:false,forceSelection:true,triggerAction:"all",value:"all",listConfig:{maxWidth:60},listeners:{change:function(){this.getBuilder().fireEvent("rulechange",this)},scope:this}},{xtype:"label",html:_t("of the following rules:"),style:"margin-left: 7px; font-size: 12px; color: #444"}]},{ref:"clauses",xtype:"container",cls:"rule-clause-container",items:{xtype:"ruleclause",nestedRule:this},listeners:{add:f.changeListener,remove:f.changeListener}}]});if(n.showButtons){var m=n.items[0].items;m.push("->");Ext.each(h(this),function(o){m.push(o)})}this.callParent([n])},getBuilder:function(){if(!this.builder){this.builder=this.findParentByType("rulebuilder",true)}return this.builder},getValue:function(){var n=[],o=f.CONJUNCTIONS[this.conjunction.getValue()].tpl,m;Ext.each(this.clauses.items.items,function(q){var p=q.getValue();if(p){n.push(p)}},this);m=n.join(o);if(n.length>1){m=Ext.String.format("({0})",m)}return m},setValue:function(u){var v,n,t=0,o=0,w=[],s=[],z=false;v=u.charAt(t);var y=function(){var p=Ext.String.trim(s.join(""));if(p){w.push(p)}s=[]};while(v){if(v=='"'||v=="'"){n=v;s.push(v);for(;;){t++;v=u.charAt(t);s.push(v);if(v===n){break}if(v==="\\"){t++;s.push(u.charAt(t))}}}else{if(v=="("||v==")"){if(o===0){y()}s.push(v);if(v=="("){var r=u.charAt(t-1);if(t>0&&r!=" "&&r!="("){z=true}else{o++}}else{if(v==")"){if(z){z=false}else{o--}}}if(o===0){y()}}else{s.push(v)}}t++;v=u.charAt(t)}y();if(w){this.clauses.removeAll();var m,x;Ext.each(w,function(q){if(q){if(m=b[q]){this.conjunction.setValue(m);return}else{if(g.test(q)){x=this.clauses.add({xtype:"nestedrule",ruleBuilder:this.ruleBuilder})}else{x=this.clauses.add({xtype:"ruleclause",nestedRule:this})}}var A=q;try{A=l.exec(q)[1]}catch(p){}x.setValue(A)}},this)}}});Ext.define("Zenoss.form.rule.RuleBuilder",{alias:["widget.rulebuilder"],extend:"Ext.form.FieldContainer",constructor:function(m){m=Ext.applyIf(m||{},{cls:"rule-builder",prefix:"",items:[{ref:"rootrule",xtype:"nestedrule",showButtons:false,ruleBuilder:this}]});this.subject_store=[];this.subject_map={};Ext.each(m.subjects,function(n){if(!Ext.isObject(n)){n={value:n}}this.subject_store.push([n.value,n.text||n.value]);this.subject_map[n.value]=n},this);this.callParent([m]);this.addEvents("rulechange")},getValue:function(){var m=this.rootrule.getValue();if(m&&g.test(m)){m=l.exec(m)[1]}return m},setValue:function(m){if(!m){this.reset()}else{this.rootrule.setValue(m)}this.doComponentLayout()},reset:function(){this.rootrule.clauses.removeAll();this.rootrule.clauses.add({xtype:"ruleclause",nestedRule:this.rootrule,builder:this})}});Ext.define("Zenoss.form.rule.DeviceCombo",{extend:"Zenoss.form.SmartCombo",alias:["widget.rule.devicecombo"],constructor:function(m){m=Ext.applyIf(m||{},{queryMode:"remote",directFn:Zenoss.remote.DeviceRouter.getDeviceUuidsByName,root:"data",model:"Zenoss.model.BasicUUID",remoteFilter:true,minChars:3,typeAhead:true,valueField:"uuid",displayField:"name",forceSelection:true,triggerAction:"all",editable:true,autoLoad:false});this.callParent([m])},setValue:function(){var m=arguments[0];if(m&&Ext.isString(m)){this.getStore().setBaseParam("uuid",m);if(this.getStore().getById(m)===null){this.getStore().load()}}return this.callParent(arguments)}});f.STRINGCOMPARISONS=["contains","doesnotcontain","startswith","doesnotstartwith","endswith","doesnotendwith","equals","doesnotequal"];f.NUMBERCOMPARISONS=["equals","doesnotequal","lessthan","greaterthan","lessthanorequalto","greaterthanorequalto"];f.IDENTITYCOMPARISONS=["equals","doesnotequal"];f.LISTCOMPARISONS=["contains","doesnotcontain"];Ext.apply(f,{EVENTSEVERITY:{text:_t("Severity"),value:"severity",comparisons:f.NUMBERCOMPARISONS,field:{xtype:"combo",queryMode:"local",valueField:"value",displayField:"name",typeAhead:false,forceSelection:true,triggerAction:"all",listConfig:{maxWidth:200},store:new Ext.data.ArrayStore({model:"Zenoss.model.NameValue",data:[[_t("Critical"),5],[_t("Error"),4],[_t("Warning"),3],[_t("Info"),2],[_t("Debug"),1],[_t("Clear"),0]]})}},PRODUCTIONSTATE:{text:_t("Production state"),value:"productionState",field:{xtype:"ProductionStateCombo",listConfig:{maxWidth:200}},comparisons:f.NUMBERCOMPARISONS},DEVICEPRIORITY:{text:_t("Device priority"),value:"priority",field:{xtype:"PriorityCombo",listConfig:{maxWidth:200}},comparisons:f.NUMBERCOMPARISONS},DEVICE:{text:_t("Device"),value:"device_uuid",comparisons:f.IDENTITYCOMPARISONS,field:{xtype:"rule.devicecombo",listConfig:{maxWidth:200}}},DEVICECLASS:{text:_t("Device Class"),value:"dev.device_class",comparisons:f.STRINGCOMPARISONS,field:{xtype:"smartcombo",defaultListConfig:{maxWidth:200},fields:["name"],directFn:Zenoss.remote.DeviceRouter.getDeviceClasses,root:"deviceClasses",listeners:c,typeAhead:true,editable:true,valueField:"name",displayField:"name",forceSelection:true}},SYSTEMS:{text:_t("Systems"),value:"dev.systems",comparisons:f.LISTCOMPARISONS,field:{xtype:"smartcombo",defaultListConfig:{maxWidth:200},directFn:Zenoss.remote.DeviceRouter.getSystems,root:"systems",fields:["name"],listeners:c,typeAhead:true,editable:true,valueField:"name",displayField:"name",forceSelection:false}},DEVICEGROUPS:{text:_t("Device Groups"),value:"dev.groups",comparisons:f.LISTCOMPARISONS,field:{xtype:"smartcombo",defaultListConfig:{maxWidth:200},directFn:Zenoss.remote.DeviceRouter.getGroups,root:"groups",fields:["name"],listeners:c,typeAhead:true,editable:true,valueField:"name",displayField:"name",forceSelection:false}}})})();Ext.onReady(function(){Ext.ns("Zenoss.eventdetail");if(!Zenoss.hasOwnProperty("event_detail_custom_renderers")){Zenoss.event_detail_custom_renderers={}}if(!Zenoss.hasOwnProperty("event_detail_custom_sections")){Zenoss.event_detail_custom_sections={}}Zenoss.eventdetail.detail_header_template=['<table width="99%" id="evdetail_props_table">','<tr><td class="dt">',_t("Resource:"),"</td>","<td>",'<tpl if="device">',"{device}","</tpl>","</td>","</tr>",'<tr><td class="dt">',_t("Component:"),"</td>","<td>",'<tpl if="component">',"{component}","</tpl>","</td>","</tr>",'<tr><td class="dt">',_t("Event Class:"),"</td>","<td>",'<tpl if="eventClass">',"{eventClass}","</tpl>","</td>","</tr>",'<tr><td class="dt">',_t("Status:"),"</td> <td>{eventState}</td></tr>",'<tr><td class="dt">',_t("Message:"),"</td> <td >{message}</td></tr>",'</table><div style="clear:both;"></div>'];Zenoss.eventdetail.detail_data_template=['<table class="proptable" width="100%">','<tpl for="properties">','<tr class=\'{[xindex % 2 === 0 ? "even" : "odd"]}\'>','<td class="proptable_key">{key}</td>','<td class="proptable_value">{value}</td></tr>',"</tpl>","</table>"];Zenoss.eventdetail.detail_log_template=["<table>",'<tpl for="log">','<tr><td class="time">{0} {1}: </td>','<td class="message">{2}</td></tr>',"</tpl>","</table>"];Zenoss.eventdetail.Section=Ext.extend(Object,{constructor:function(a){Ext.applyIf(a||{},{template:Zenoss.eventdetail.detail_data_template});Ext.apply(this,a);Zenoss.eventdetail.Section.superclass.constructor.apply(this,arguments)},generateHtml:function(d,c){var b=new Ext.XTemplate(this.template),a={};Ext.each(this.keys,function(e){a[e]=d[e]});return b.apply(a)}});Zenoss.eventdetail.RepeatedSection=Ext.extend(Zenoss.eventdetail.Section,{constructor:function(a){Ext.applyIf(a||{},{generateHtml:function(e,d){var c=new Ext.XTemplate(this.template),b={properties:[]};Ext.each(this.keys,function(f){b.properties.push({key:f,value:e[f]})});return c.apply(b)}});Zenoss.eventdetail.RepeatedSection.superclass.constructor.apply(this,arguments)}});Zenoss.eventdetail.DetailsSection=Ext.extend(Zenoss.eventdetail.RepeatedSection,{constructor:function(a){Ext.applyIf(a||{},{generateHtml:function(f,e){var d=new Ext.XTemplate(this.template),c={properties:f.details},b=[];if(this.hasOwnProperty("keys")){Ext.each(this.keys,function(g){Ext.each(f.details,function(h){if(h.key==g){b.push(h)}},this)},this);c.properties=b}return d.apply(c)}});Zenoss.eventdetail.DetailsSection.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.DetailPanel",{extend:"Ext.Panel",alias:"widget.detailpanel",isHistory:false,layout:"border",constructor:function(a){this.sections=[];this.renderers={};a.onDetailHide=a.onDetailHide||Ext.emptyFn;a.items=[{id:"evdetail_hd",region:"north",layout:"border",height:50,cls:"evdetail_hd",items:[{region:"west",width:77,height:47,defaults:{height:47},layout:"hbox",items:[{id:"severity-icon",cls:"severity-icon"},{id:"evdetail-sep",cls:"evdetail-sep"}]},{region:"center",id:"evdetail-summary",html:""},{region:"east",id:"evdetail-tools",layout:"hbox",width:57,items:[{id:"evdetail-popout",cls:"evdetail-popout"},{id:"evdetail_tool_close",cls:"evdetail_close"}]}]},{id:"evdetail_bd",region:"center",width:"90%",autoScroll:true,cls:"evdetail_bd",items:[{xtype:"toolbar",width:"105%",style:{position:"relative",top:-1},hidden:!a.showActions,id:"actiontoolbar",items:[{xtype:"tbtext",text:_t("Event Actions:")},Zenoss.events.EventPanelToolbarActions.acknowledge,Zenoss.events.EventPanelToolbarActions.close,Zenoss.events.EventPanelToolbarActions.reopen,Zenoss.events.EventPanelToolbarActions.unclose]},{id:"event_detail_properties",frame:false,defaults:{frame:false},layout:{type:"table",columns:1,tableAttrs:{style:{width:"90%"}}}},{id:"evdetail-log-header",cls:"evdetail-log-header",hidden:false,html:"<hr/><h2>LOG</h2>"},{xtype:"form",id:"log-container",width:"90%",layout:{type:"table",columns:1},style:{"margin-left":"3em"},hidden:false,fieldDefaults:{labelWidth:1},items:[{id:"detail-logform-evid",xtype:"hidden",name:"evid"},{style:"margin:0.75em",width:300,xtype:"textfield",name:"message",hidden:Zenoss.Security.doesNotHavePermission("Manage Events"),id:"detail-logform-message"},{xtype:"button",type:"submit",name:"add",hidden:Zenoss.Security.doesNotHavePermission("Manage Events"),text:"Add",handler:function(b,f){var c=Ext.getCmp("log-container"),d=c.getForm().getValues(),g={evid:Ext.getCmp("")};Ext.apply(g,d);Zenoss.remote.EventsRouter.write_log(g,function(h,e){Ext.getCmp("detail-logform-message").setRawValue("");Ext.getCmp(a.id).refresh()})}}]},{id:"evdetail_log",cls:"log-content",hidden:false,autoScroll:true,height:200}]}];this.callParent([a]);this.init()},init:function(){var d={device:function(h,g){var j=g.device_title;if(g.device_url){j=Zenoss.render.default_uid_renderer(g.device_url,g.device_title);return j}return Ext.htmlEncode(j)},component:function(h,g){var j=g.component_title;if(g.component_url){j=Zenoss.render.default_uid_renderer(g.component_url,g.component_title);return j}return Ext.htmlEncode(j)},eventClass:function(h,g){return Zenoss.render.EventClass(g.eventClass_url,g.eventClass)},eventClassMapping:function(h,g){if(g.eventClassMapping_url){return Zenoss.render.link(null,g.eventClassMapping_url,g.eventClassMapping)}},Systems:function(h,g){return Zenoss.render.LinkFromGridUidGroup(h)},eventState:function(h,g){return Ext.htmlEncode(h)},summary:function(h,g){return Ext.htmlEncode(h)},dedupid:function(h,g){return Ext.htmlEncode(h)},message:function(h,g){return Ext.htmlEncode(h)},eventClassKey:function(h,g){return Ext.htmlEncode(h)},DeviceGroups:function(h,g){return Zenoss.render.LinkFromGridUidGroup(h)},DeviceClass:function(h,g){return Zenoss.render.LinkFromGridUidGroup(h)},Location:function(h,g){return Zenoss.render.LinkFromGridUidGroup(h)}};Ext.apply(this.renderers,d);var f=new Zenoss.eventdetail.Section({id:"evdetail_props",cls:"evdetail_props",template:Zenoss.eventdetail.detail_header_template,keys:["device","component","eventClass","eventState","message"]});this.addSection(f);var e=new Zenoss.eventdetail.RepeatedSection({id:"event_detail_management_section",title:_t("Event Management"),template:Zenoss.eventdetail.detail_data_template,keys:["agent","component","dedupid","eventClass","eventClassKey","eventClassMapping","eventGroup","eventKey","eventState","evid","facility","message","ntevid","priority","severity","summary"]});this.addSection(e);var c=new Zenoss.eventdetail.RepeatedSection({id:"event_detail_device_state_section",title:_t("Device State"),template:Zenoss.eventdetail.detail_data_template,keys:["DeviceClass","DeviceGroups","DevicePriority","Location","Systems","device","ipAddress","monitor","prodState"]});this.addSection(c);var b=new Zenoss.eventdetail.RepeatedSection({id:"event_detail_meta_section",title:_t("Event Data"),template:Zenoss.eventdetail.detail_data_template,keys:["clearid","count","firstTime","lastTime","ownerid","stateChange"]});this.addSection(b);var a=new Zenoss.eventdetail.DetailsSection({id:"event_detail_details_section",title:_t("Event Details"),template:Zenoss.eventdetail.detail_data_template});this.addSection(a);this.checkCustomizations()},checkCustomizations:function(){Ext.apply(this.renderers,Zenoss.event_detail_custom_renderers);Ext.each(Zenoss.event_detail_custom_sections,function(a){if(a.hasOwnProperty("section_class")){this.addSection(a)}},this);this.doLayout()},getBody:function(){return Ext.getCmp("event_detail_properties")},addSection:function(c){if(c.hasOwnProperty("renderers")){Ext.apply(this.renderers,c.renderers)}this.sections.push(c);if(c.hasOwnProperty("title")){var b={id:c.id+"_title",html:c.title+"...",cls:"show_details",height:30,toggleFn:Ext.bind(this.toggleSection,this,[c.id])};this.getBody().add(b)}var d="full_event_props";if(c.hasOwnProperty("cls")){d=c.cls}var a={layout:"fit",id:c.id,hidden:false,cls:d,html:""};this.getBody().add(a)},removeSection:function(a){var b;Ext.each(this.sections,function(d,c,e){if(d.id==a){b=c}});this.sections.splice(b,1);Ext.getCmp(a).destroy();Ext.getCmp(a+"_title").destroy()},hideSection:function(a){Ext.getCmp(a).hide()},showSection:function(a){Ext.getCmp(a).show()},toggleSection:function(a){var b=Ext.getCmp(a);if(b.hidden){b.show()}else{var c=b.getEl().dom.innerHTML;b.hide();if(Ext.isIE){b.getEl().dom.innerHTML=c}}},findSection:function(a){var b;Ext.each(this.sections,function(c){if(c.id==a){b=c}});return b},renderData:function(a){var b={};Ext.iterate(a,function(c){if(c=="details"){var d=[];Ext.each(a[c],function(e){var f=this.extractData(e.key,e.value,a);d.push({key:e.key,value:f})},this);b[c]=d}else{b[c]=this.extractData(c,a[c],a)}},this);return b},extractData:function(a,d,b){var c;if(this.renderers.hasOwnProperty(a)){c=this.renderers[a](d,b)}else{if(d){c=d}else{c=""}}return c},setSummary:function(b){var a=Ext.getCmp("evdetail-summary");if(a&&a.el){a.update(b)}},setSeverityIcon:function(b){var a=Ext.getCmp("severity-icon");this.clearSeverityIcon();a.addCls(b)},clearSeverityIcon:function(){var a=Ext.getCmp("severity-icon");Ext.each(Zenoss.env.SEVERITIES,function(b){b=b[1];a.removeCls(b.toLowerCase())})},update:function(c){var d=this.renderData(c);this.setSummary(d.summary);this.setSeverityIcon(Zenoss.util.convertSeverity(c.severity));Ext.getCmp("detail-logform-evid").setValue(c.evid);Ext.each(this.sections,function(g){var f=Ext.getCmp(g.id),e;e=g.generateHtml(d,c);f.update(e)},this);var a=new Ext.XTemplate(Zenoss.eventdetail.detail_log_template),b;b=a.apply(c);Ext.getCmp("evdetail_log").update(b);this.doLayout();if(this.showActions){this.updateEventActions(c)}},updateEventActions:function(e){Zenoss.EventActionManager.configure({onFinishAction:Ext.bind(this.refresh,this),findParams:function(){var h={evids:[e.evid]};return h}});var c=Ext.getCmp("actiontoolbar"),b=c.query("button[iconCls='acknowledge']")[0],a=c.query("button[iconCls='close']")[0],g=c.query("button[iconCls='unacknowledge']")[0],d=c.query("button[iconCls='reopen']")[0],f=e.eventState.toLowerCase();b.disable();a.disable();g.disable();d.disable();if(Zenoss.Security.hasPermission("Manage Events")){if(f=="new"){b.enable();a.enable()}else{if(f=="acknowledged"){g.enable();a.enable()}else{if((f=="closed")||(f=="cleared")){d.enable()}}}}},bind:function(){var b=Ext.getCmp("evdetail_tool_close").getEl(),a=Ext.getCmp("evdetail-popout").getEl();Ext.each(this.sections,function(d){var c=Ext.getCmp(d.id+"_title");if(c){c.getEl().un("click",c.toggleFn);c.getEl().on("click",c.toggleFn)}},this);if(b){b.un("click",this.onDetailHide);b.on("click",this.onDetailHide)}if(a){a.un("click",this.popout,this);a.on("click",this.popout,this)}},popout:function(){var b=Ext.getCmp("detail-logform-evid").getValue(),a=this.isHistory?"viewHistoryDetail":"viewDetail";a=a+"?evid="+b;window.open(a,b.replace(/-/g,"_"),"status=1,width=600,height=500,resizable=1,name=EventDetails")},wipe:function(){},load:function(a){if(a!==this.event_id){this.event_id=a;this.refresh()}},refresh:function(){Zenoss.remote.EventsRouter.detail({evid:this.event_id},function(a){var b=a.event[0];this.update(b);this.bind();this.show()},this)}})});(function(){var a=Zenoss.remote.TriggersRouter;Ext.define("Zenoss.triggers.TriggersModel",{extend:"Ext.data.Model",idProperty:"uuid",fields:[{name:"uuid"},{name:"enabled"},{name:"name"},{name:"rule"},{name:"users"},{name:"globalRead"},{name:"globalWrite"},{name:"globalManage"},{name:"userRead"},{name:"userWrite"},{name:"userManage"}]});Ext.define("Zenoss.trigger.TriggerSubscriptions",{alias:["widget.triggersSubscriptions"],extend:"Ext.grid.Panel",constructor:function(b){var c=this;Ext.applyIf(b,{ref:"grid_panel",border:false,viewConfig:{forceFit:true},title:_t("Triggers"),autoExpandColumn:"value",loadMask:{msg:_t("Loading...")},autoHeight:true,deferRowRender:true,keys:[{key:[Ext.EventObject.ENTER],handler:function(){c.addValueFromCombo()}}],tbar:{items:[{xtype:"combo",ref:"data_combo",typeAhead:true,triggerAction:"all",lazyRender:true,width:505,queryMode:"local",store:Ext.create("Zenoss.NonPaginatedStore",{root:"data",autoLoad:true,idProperty:"uuid",fields:["uuid","name"],directFn:a.getTriggerList,autoDestroy:false,listeners:{load:function(){c.getView().refresh()}}}),valueField:"uuid",displayField:"name"},{xtype:"button",text:"Add",ref:"add_button",handler:function(d,e){c.addValueFromCombo()}},{xtype:"button",ref:"delete_button",iconCls:"delete",handler:function(d,e){var f=c.getSelectionModel().getSelected();c.getStore().remove(f);c.getView().refresh()}}]},store:new Ext.data.JsonStore({model:"Zenoss.triggers.TriggersModel",storeId:"triggers_combo_store",autoLoad:false,autoDestroy:false,data:[]}),columns:[{header:_t("Trigger"),dataIndex:"uuid",flex:1,renderer:function(j,d,e,f,m,l){var g=c.getDockedItems("toolbar")[0];var k=g.data_combo.store;var h=k.find("uuid",j);if(h>-1){return k.getAt(h).data.name}else{return _t("(Hidden)")}}}],selModel:Ext.create("Zenoss.SingleRowSelectionModel",{})});this.callParent(arguments)},addValueFromCombo:function(){var e=this.getDockedItems("toolbar")[0].data_combo,g=e.getValue(),d=e.store.find("uuid",g),f=e.store.getAt(d),c=this.getStore().findExact("uuid",g);if(!Ext.isEmpty(g)&&c==-1){var b=Ext.create("Zenoss.triggers.TriggersModel",{uuid:g});this.getStore().add(b);e.setValue("")}else{if(c!=-1){Zenoss.message.error(_t("Duplicate items not permitted here."))}}},loadData:function(b){this.getStore().loadData(b)}})})();(function(){Ext.ns("Zenoss.form");Ext.define("Zenoss.form.SettingsGrid",{alias:["widget.settingsgrid"],extend:"Ext.form.FormPanel",constructor:function(b,a){b=b||{};var c,d=this,e;for(c=0;c<a.length;c++){e=a[c];e.fieldLabel=e.name;if(!Ext.isDefined(e.value)){e.value=e.defaultValue}if(e.xtype=="checkbox"){e.checked=e.value}e.ref=e.id;e.name=e.id}this.lastValues=a;Ext.applyIf(b,{autoScroll:"y",layout:"anchor",fieldDefaults:{labelAlign:"top"},paramsAsHash:true,frame:false,buttonAlign:"left",defaults:{anchor:"95%",labelStyle:"font-size: 13px; color: #5a5a5a"},bodyStyle:"padding: 10px",listeners:{validitychange:function(f,g){d.query("button")[0].setDisabled(!g)},afterrender:function(f){this.getForm().checkValidity()},scope:this},isDirty:function(){return true},buttons:[{text:_t("Save"),ref:"../savebtn",formBind:true,handler:function(g){var f={};Ext.each(a,function(h){f[h.id]=d[h.id].getValue()});b.saveFn({values:f},function(h){if(h.success){var j=_t("Configuration updated");Zenoss.message.info(j)}})}},{text:_t("Cancel"),ref:"../cancelbtn",handler:function(f){var g=f.refOwner;g.setInfo(g.lastValues)}}],items:a,setInfo:function(g){var f=this;Ext.each(g,function(h){f[h.id].setValue(h.value)})},autoHeight:true,viewConfig:{forceFit:true}});this.callParent(arguments)}})}());(function(){var g=Ext.ns("Zenoss.form"),d=Zenoss.remote.DeviceRouter,b,c,a,f,e;Ext.define("Zenoss.form.OrganizerDropDown",{extend:"Ext.form.ComboBox",constructor:function(h){h=h||{};Ext.applyIf(h,{xtype:"combo",name:"group",store:new Ext.data.DirectStore({directFn:h.getGroupFn,root:h.getGroupRoot,fields:["name"]}),valueField:"name",emptyText:_t("All..."),displayField:"name",allowBlank:true,forceSelection:false,editable:true,autoSelect:true,triggerAction:"all",listConfig:{resizable:true}});Zenoss.form.OrganizerDropDown.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.form.SystemDropDown",{alias:["widget.systemdropdown"],extend:"Zenoss.form.OrganizerDropDown",constructor:function(h){h=h||{};Ext.applyIf(h,{getGroupFn:d.getSystems,getGroupRoot:"systems"});Zenoss.form.SystemDropDown.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.form.GroupDropDown",{alias:["widget.groupdropdown"],extend:"Zenoss.form.OrganizerDropDown",constructor:function(h){h=h||{};Ext.applyIf(h,{getGroupFn:d.getGroups,getGroupRoot:"groups"});Zenoss.form.GroupDropDown.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.form.LocationDropDown",{alias:["widget.locationdropdown"],extend:"Zenoss.form.OrganizerDropDown",constructor:function(h){h=h||{};Ext.applyIf(h,{getGroupFn:d.getLocations,getGroupRoot:"locations"});Zenoss.form.LocationDropDown.superclass.constructor.apply(this,arguments)}});Ext.define("Zenoss.form.DeviceClassDropDown",{alias:["widget.deviceclassdropdown"],extend:"Zenoss.form.OrganizerDropDown",constructor:function(h){h=h||{};Ext.applyIf(h,{getGroupFn:d.getDeviceClasses,getGroupRoot:"deviceClasses"});Zenoss.form.DeviceClassDropDown.superclass.constructor.apply(this,arguments)}})}());(function(){var a=Zenoss.remote.DeviceRouter,d,b="zCollectorPlugins",c;Ext.define("Zenoss.form.ModelerPluginForm",{extend:"Ext.form.FormPanel",alias:"widget:modelerpluginform",constructor:function(e){var f=this;e=e||{};Ext.apply(e,{fieldDefaults:{labelAlign:"top"},paramsAsHash:true,frame:false,autoScroll:"y",defaults:{labelStyle:"font-size: 13px; color: #5a5a5a",anchor:"100%"},items:[{xtype:"displayfield",name:"path",id:"modeler-plugin-path",fieldLabel:_t("Path")},{xtype:"displayfield",id:"modeler-plugin-doc",name:"doc",height:65,autoScroll:true,ref:"doc",toolTip:"Select a single plugin to see the docs",fieldLabel:_t("Plugin Documentation")}],buttonAlign:"left",buttons:[{text:_t("Save"),ref:"savebtn",disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:function(k){var h=f.modelerPlugins.getValue(),g=f,j=f.uid;a.setZenProperty({uid:j,zProperty:b,value:h},function(l){if(l.success){Zenoss.message.info("Updated Modeler Plugins");Ext.getCmp("modeler-plugin-path").setValue(l.data.path);g.toggleDeleteButton(l.data.path)}})}},{text:_t("Cancel"),ref:"cancelbtn",handler:function(){if(f.uid){f.setContext(f.uid)}}},{text:_t("Delete Local Copy"),ref:"deleteBtn",hidden:true,disabled:Zenoss.Security.doesNotHavePermission("Manage DMD"),handler:function(h){var g=f;new Zenoss.dialog.SimpleMessageDialog({title:_t("Delete zProperty"),msg:_t("Are you sure you want to delete the local copy of zCollectorPlugin?"),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){if(g.uid){a.deleteZenProperty({uid:g.uid,zProperty:b},function(j){g.setContext(g.uid)})}}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}],cls:"device-overview-form-wrapper",bodyCls:"device-overview-form"});this.callParent(arguments)},setContext:function(e){if(this.modelerPlugins){this.modelerPlugins.destroy()}if(this.pluginsHeader){this.pluginsHeader.destroy()}if(this.panelHeaders){this.panelHeaders.destroy()}Ext.getCmp("modeler-plugin-doc").setValue("");this.uid=e;a.getZenProperty({uid:e,zProperty:b},Ext.bind(this.loadData,this));a.getModelerPluginDocStrings({uid:e},Ext.bind(this.loadDocs,this))},toggleDeleteButton:function(g){var e=this.uid.replace("/zport/dmd/Devices",""),f=this.getButton("deleteBtn");if(g=="/"){f.hide();return}if(e==g){f.show()}else{f.hide()}},getButton:function(e){return this.query(Ext.String.format("button[ref='{0}']",e))[0]},loadData:function(g){if(g.success){var h=g.data,j,e=this;Ext.getCmp("modeler-plugin-path").setValue(h.path);this.toggleDeleteButton(h.path);j=function(k,l){var m=l.data.name;e.showDocFor(m)};var f=[];Ext.each(h.options,function(k){f.push([k])});this.add({xtype:"label",text:"Modeler Plugins:",ref:"pluginsHeader",style:{color:"#5A5A5A",fontWeight:"bold",display:"block",padding:"0 0 8px 0"}});this.add({xtype:"panel",width:800,layout:"column",ref:"panelHeaders",items:[{xtype:"label",columnWidth:0.515,text:"Available",style:{color:"#5A5A5A"}},{xtype:"label",columnWidth:0.485,text:"Selected",style:{color:"#5A5A5A"}}]});this.add({name:"modelerPlugins",ref:"modelerPlugins",xtype:"itemselector",imagePath:"/++resource++zenui/img/xtheme-zenoss/icon",height:250,drawUpIcon:true,drawDownIcon:true,drawTopIcon:true,drawBotIcon:true,displayField:"name",valueField:"name",store:Ext.create("Ext.data.ArrayStore",{model:"Zenoss.model.Name",data:f}),value:h.value,listeners:{afterrender:function(){this.modelerPlugins.fromField.boundList.on("itemclick",j);this.modelerPlugins.toField.boundList.on("itemclick",j)},scope:this}});this.doLayout()}},showDocFor:function(e){if(e&&this.docs&&this.docs[e]){this.doc.setValue(this.docs[e])}else{this.doc.setValue(Ext.String.format(_t("No documentation found for {0}"),e))}},loadDocs:function(e){if(e.success){this.docs=e.data}}});Ext.define("Zenoss.form.ModelerPluginPanel",{alias:["widget.modelerpluginpanel"],extend:"Ext.Panel",constructor:function(e){e=e||{};var f=Ext.create("Zenoss.form.ModelerPluginForm",{});Ext.applyIf(e,{layout:"fit",width:800,autoScroll:"auto",items:[f]});this.callParent(arguments);this.form=f},setContext:function(e){this.form.setContext(e)}})})();(function(){var c=Zenoss.remote.DeviceRouter,d,b={};Ext.ns("Zenoss.zproperties");Ext.apply(b,{"int":{xtype:"numberfield",allowDecimals:false,width:100},"float":{xtype:"numberfield",width:100},string:{xtype:"textfield"},lines:{xtype:"textarea",resizable:true,width:300},severity:{xtype:"severity"},"boolean":{xtype:"checkbox"},password:{xtype:"password"},options:{xtype:"combo",editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",queryMode:"local"},zSnmpCommunity:{xtype:Zenoss.Security.doesNotHavePermission("zProperties Edit")?"password":"textfield"},zEventSeverity:{xtype:"severity"},zFailSeverity:{xtype:"severity"},zWinEventlogMinSeverity:{xtype:"reverseseverity"}});Zenoss.zproperties.registerZPropertyType=function(f,e){b[f]=e};function a(m,h){var k,g,e,l,f,j;j=m.type;l={};if(Ext.isArray(m.options)&&m.options.length>0&&j=="string"){l.store=m.options;Ext.apply(l,b.options)}else{Ext.apply(l,b[m.id]||b[j]||b.string)}Ext.applyIf(l,{fieldLabel:_t("Value"),value:m.value,ref:"editConfig",checked:m.value,name:m.id,width:250});if(j=="lines"&&Ext.isArray(l.value)){l.value=l.value.join("\n")}k=function(){var n=f.getForm().getForm().getValues(),o=n[m.id];if(j=="lines"){if(o){o=Ext.Array.map(o.split("\n"),function(q){return Ext.String.trim(q)})}else{o=[]}}var p={uid:h.uid,zProperty:m.id,value:o};Zenoss.remote.DeviceRouter.setZenProperty(p,function(q){if(q.success){h.refresh()}})};e={submitHandler:k,minHeight:300,autoHeight:true,width:500,title:_t("Edit Config Property"),listeners:{show:function(){f.getForm().query("field[ref='editConfig']")[0].focus(true,500)}},items:[{xtype:"displayfield",name:"name",fieldLabel:_t("Name"),value:m.id},{xtype:"displayfield",name:"path",ref:"path",fieldLabel:_t("Path"),value:m.path},{xtype:"displayfield",name:"type",ref:"type",fieldLabel:_t("Type"),value:m.type},l],keys:{}};f=new Zenoss.SmartFormDialog(e);if(Zenoss.Security.hasPermission("zProperties Edit")){f.show()}}Ext.define("Zenoss.ConfigProperty.Model",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id"},{name:"islocal"},{name:"value"},{name:"category"},{name:"valueAsString"},{name:"type"},{name:"path"},{name:"options"}]});Ext.define("Zenoss.ConfigProperty.Store",{extend:"Zenoss.DirectStore",constructor:function(e){e=e||{};Ext.applyIf(e,{model:"Zenoss.ConfigProperty.Model",initialSortColumn:"id",pageSize:300,directFn:Zenoss.remote.DeviceRouter.getZenProperties});this.callParent(arguments)}});Ext.define("Zenoss.ConfigProperty.Grid",{alias:["widget.configpropertygrid"],extend:"Zenoss.FilterGridPanel",constructor:function(e){e=e||{};Zenoss.Security.onPermissionsChange(function(){this.disableButtons(Zenoss.Security.doesNotHavePermission("zProperties Edit"))},this);Ext.applyIf(e,{stateId:e.id||"config_property_grid",sm:Ext.create("Zenoss.SingleRowSelectionModel",{}),tbar:[{xtype:"button",iconCls:"customize",toolTip:_t("Customize"),disabled:Zenoss.Security.doesNotHavePermission("zProperties Edit"),ref:"customizeButton",handler:function(g){var f=g.up("configpropertygrid"),j,h=f.getSelectionModel().getSelection();if(Ext.isEmpty(h)){return}j=h[0].data;a(j,f)}},{xtype:"button",iconCls:"refresh",toolTip:_t("Refresh"),ref:"../refreshButton",disabled:Zenoss.Security.doesNotHavePermission("zProperties Edit"),handler:function(g){var f=g.up("configpropertygrid");f.refresh()}},{xtype:"button",ref:"../deleteButton",toolTip:_t("Delete"),text:_t("Delete Local Copy"),handler:function(g){var f=g.up("configpropertygrid"),j,h=f.getSelectionModel().getSelection();if(Ext.isEmpty(h)){return}j=h[0].data;if(j.islocal&&j.path=="/"){Zenoss.message.info(_t("{0} can not be deleted from the root definition."),j.id);return}if(!j.islocal){Zenoss.message.info(_t("{0} is not defined locally"),j.id);return}new Zenoss.dialog.SimpleMessageDialog({title:_t("Delete Local Property"),message:Ext.String.format(_t("Are you sure you want to delete the local copy of {0}?"),j.id),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){if(f.uid){c.deleteZenProperty({uid:f.uid,zProperty:j.id},function(k){f.refresh()})}}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}],store:Ext.create("Zenoss.ConfigProperty.Store",{}),columns:[{header:_t("Is Local"),id:"islocal",dataIndex:"islocal",width:60,sortable:true,filter:false,renderer:function(f){if(f){return"Yes"}return""}},{id:"category",dataIndex:"category",header:_t("Category"),sortable:true,renderer:function(f){return Ext.htmlEncode(f)}},{id:"id",dataIndex:"id",header:_t("Name"),width:200,sortable:true,renderer:function(f){return Ext.htmlEncode(f)}},{id:"value",dataIndex:"valueAsString",header:_t("Value"),flex:1,width:180,renderer:function(g,h,f){if(Zenoss.Security.doesNotHavePermission("zProperties Edit")&&f.data.id=="zSnmpCommunity"){return"*******"}return Ext.htmlEncode(g)},sortable:false},{id:"path",dataIndex:"path",header:_t("Path"),width:200,sortable:true,renderer:function(f){return Ext.htmlEncode(f)}}]});this.callParent(arguments);this.on("itemdblclick",this.onRowDblClick,this)},setContext:function(e){if(e=="/zport/dmd/Devices"){this.deleteButton.setDisabled(true)}else{this.deleteButton.setDisabled(Zenoss.Security.doesNotHavePermission("zProperties Edit"))}this.uid=e;this.callParent(arguments)},onRowDblClick:function(f,k,j){var h,g=this.getSelectionModel().getSelection();if(!g){return}h=g[0].data;a(h,this)},disableButtons:function(e){var f=this.query("button");Ext.each(f,function(g){g.setDisabled(e)})}});Ext.define("Zenoss.form.ConfigPropertyPanel",{alias:["widget.configpropertypanel"],extend:"Ext.Panel",constructor:function(e){e=e||{};this.gridId=Ext.id();Ext.applyIf(e,{layout:"fit",autoScroll:"y",height:800,items:[{id:this.gridId,xtype:"configpropertygrid",ref:"configGrid",displayFilters:e.displayFilters}]});this.callParent(arguments)},setContext:function(e){Ext.getCmp(this.gridId).setContext(e)}})})();(function(){var b=[[129600,_t("Hourly")],[864000,_t("Daily")],[3628800,_t("Weekly")],[41472000,_t("Monthly")],[62208000,_t("Yearly")]],h=Ext.isIE?25:50;function l(q){function p(r){return r<10?"0"+r:r}return q.getUTCFullYear()+"-"+p(q.getUTCMonth()+1)+"-"+p(q.getUTCDate())+"T"+p(q.getUTCHours())+":"+p(q.getUTCMinutes())+":"+p(q.getUTCSeconds())+"Z"}Date.prototype.minus=function(p){return new Date(this.valueOf()-(p*1000))};Date.prototype.toPretty=function(){return l(this)};function n(r){r=r.split("=",1)[0];var p=[r];for(var q=0;q<=4-(r.length%4);q++){p.push("=")}return p.join("")}var a=a||{},c=1.5,j=3,o=/now-([0-9]*)s/,f=/end-([0-9]*)s/;Ext.ns("Zenoss");Zenoss.SWOOP_CALLBACKS={};Zenoss.SwoopyGraph=Ext.extend(Ext.Panel,{constructor:function(q){var p=Ext.isGecko?"-moz-zoom-in":Ext.isWebKit?"-webkit-zoom-in":"crosshair";q=Ext.applyIf(q||{},{html:{tag:"img",src:q.graphUrl,id:q.graphId,style:"cursor:"+p},width:607,cls:"graph-panel",tbar:{items:[{xtype:"tbtext",text:q.graphTitle},"->",{text:"&lt;",width:67,handler:Ext.bind(function(r,s){this.onPanLeft(this)},this)},{text:_t("Zoom In"),enableToggle:true,pressed:true,ref:"../zoomin",handler:Ext.bind(function(r,s){this.fireEventsToAll("zoommodechange",this,!r.pressed)},this)},{text:_t("Zoom Out"),ref:"../zoomout",enableToggle:true,handler:Ext.bind(function(r,s){this.fireEventsToAll("zoommodechange",this,r.pressed)},this)},{text:"&gt;",width:67,handler:Ext.bind(function(r,s){this.onPanRight(this)},this)}]}});Zenoss.SwoopyGraph.superclass.constructor.call(this,q);this.mustUseImageUri=Ext.isIE},initEvents:function(){this.addEvents("zoommodechange","updateimage");Zenoss.SwoopyGraph.superclass.initEvents.call(this);this.on("zoommodechange",this.onZoomModeChange,this);this.on("updateimage",this.updateImage,this);this.graphEl=Ext.get(this.graphId);this.graphEl.on("click",this.onGraphClick,this);this.graphEl.on("load",function(){this.suspendLayouts();var p=this.graphEl.getSize();this.setWidth(p.width+10);this.setHeight(p.height+42);this.el.setHeight(p.height+42);if(!p.width||!p.height){this.showFailure()}else{this.parseGraphParams()}this.resumeLayouts(true)},this,{single:true})},showFailure:function(){this.failureMask=this.failureMask||Ext.DomHelper.insertAfter(this.graphEl,{tag:"div",html:_t("There was a problem rendering this graph. Either the file does not exist or an error has occurred.  Initial graph creation can take up to 5 minutes.  If the graph still does not appear, look in the Zope log file $ZENHOME/log/event.log for errors.")});var q=Ext.fly(this.failureMask);var p=this.graphEl.getSize();if(!p.width||!p.height){p={height:150,width:500}}q.setSize(p);Ext.fly(this.failureMask).setDisplayed(true);this.graphEl.setDisplayed(false)},hideFailure:function(){if(this.failureMask){this.graphEl.setDisplayed(true);Ext.fly(this.failureMask).setDisplayed(false)}},parseGraphParams:function(q){q=q||this.graphEl.dom.src;var p=q.split("?"),r=Ext.apply({url:p[0]},Ext.urlDecode(p[1]));r.gopts=n(r.gopts);r.width=Number(r.width);r.drange=Number(r.drange);r.start=Ext.isDefined(r.start)?Number(f.exec(r.start)[1]):r.drange;r.end=Ext.isDefined(r.end)?Number(o.exec(r.end)[1]):0;this.graph_params=r},getComment:function(v,q){var r=new Date(),t=r.minus(q).toPretty(),p=r.minus(v+q).toPretty();var s="\\t\\t to \\t\\t";var u=p+s+t;u=u.replace(/:/g,"\\:");return u},fireEventsToAll:function(){if(this.linked()){var p=arguments;Ext.each(this.refOwner.getGraphs(),function(q){q.fireEvent.apply(q,p)})}else{this.fireEvent.apply(this,arguments)}},linked:function(){return this.isLinked},setLinked:function(p){this.isLinked=p},updateImage:function(q){var p=Ext.apply({},q,this.graph_params);p.comment=this.getComment(p.start,p.end);p.end="now-"+p.end+"s";p.start="end-"+p.start+"s";this.sendRequest(p)},sendRequest:function(v){var q=v.url,r=this;delete v.url;v.getImage=null;if(this.mustUseImageUri===true){v.getImage=true}var p=new Date().getTime();var u=p+"_"+this.graphId;v.graphid=u;var s=Ext.urlAppend(q,Ext.urlEncode(v));if(this.mustUseImageUri===true){this.graphEl.dom.src=s;this.parseGraphParams(s)}else{Zenoss.SWOOP_CALLBACKS[u]=Ext.bind(function(x){var w=Ext.decode(x);if(w.success){this.hideFailure();this.graphEl.dom.src="data:image/png;base64,"+w.data;this.parseGraphParams(s)}else{this.showFailure()}delete Zenoss.SWOOP_CALLBACKS[u];Ext.get(u).remove()},this);var t=Ext.DomHelper.createDom({tag:"script",id:u,type:"text/javascript",src:s});Ext.getDoc().dom.getElementsByTagName("head")[0].appendChild(t)}},onPanLeft:function(q){var p=this.graph_params;var s=Math.round(p.drange/j);var r=p.end+s>0?p.end+s:0;this.fireEventsToAll("updateimage",{end:r})},onPanRight:function(q){var p=this.graph_params;var s=Math.round(p.drange/j);var r=p.end-s>0?p.end-s:0;this.fireEventsToAll("updateimage",{end:r})},onZoomModeChange:function(s,q){this.zoomout.toggle(q);this.zoomin.toggle(!q);var r=q?"out":"in",p=Ext.isGecko?"-moz-zoom-"+r:(Ext.isWebKit?"-webkit-zoom-"+r:"crosshair");this.graphEl.setStyle({cursor:p})},doZoom:function(q,s){var t=this.graph_params;if(q<0||q>t.width){return}var r=Math.round(t.drange/s),u=((t.width/2)-q)*(t.drange/t.width)+(t.drange-r)/2,p=Math.round(t.end+u>=0?t.end+u:0);this.fireEventsToAll("updateimage",{drange:r,start:r,end:p})},onGraphClick:function(s){var r=s.getTarget(null,null,true),p=s.getPageX()-r.getX()-67,q=this.zoomin.pressed?this.onZoomIn:this.onZoomOut;q.call(this,this,p)},onZoomIn:function(q,p){this.doZoom(p,c)},onZoomOut:function(q,p){this.doZoom(p,1/c)}});var m=Zenoss.remote.DeviceRouter,e,d,g,k;Ext.define("Zenoss.form.GraphRefreshButton",{alias:["widget.graphrefreshbutton"],extend:"Zenoss.RefreshMenuButton",constructor:function(p){p=p||{};var q={xtype:"statefulrefreshmenu",id:p.stateId||Ext.id(),trigger:this,items:[{cls:"refreshevery",text:"Refresh every"},{xtype:"menucheckitem",text:"1 minute",value:60,group:"refreshgroup"},{xtype:"menucheckitem",text:"5 minutes",value:300,group:"refreshgroup"},{xtype:"menucheckitem",text:"10 Minutes",value:600,group:"refreshgroup"},{xtype:"menucheckitem",text:"30 Minutes",checked:true,value:1800,group:"refreshgroup"},{xtype:"menucheckitem",text:"1 Hour",value:3600,group:"refreshgroup"},{xtype:"menucheckitem",text:"Manually",value:-1,group:"refreshgroup"}]};Ext.apply(p,{menu:q});this.callParent(arguments)}});Ext.define("Zenoss.form.DRangeSelector",{alias:["widget.drangeselector"],extend:"Ext.form.ComboBox",constructor:function(p){p=p||{};Ext.apply(p,{fieldLabel:_t("Range"),name:"ranges",editable:false,forceSelection:true,autoSelect:true,triggerAction:"all",value:129600,queryMode:"local",store:new Ext.data.ArrayStore({id:0,model:"Zenoss.model.IdName",data:b}),valueField:"id",displayField:"name"});this.callParent(arguments)}});k=[{xtype:"tbtext",text:_t("Performance Graphs")},"-","->",{xtype:"drangeselector",ref:"../drange_select",listeners:{select:function(t,q,r){var s=q[0].data.id,p=t.refOwner;p.setDrange(s)}}},"-",{xtype:"button",ref:"../resetBtn",text:_t("Reset"),handler:function(q){var p=q.refOwner;p.setDrange()}},"-",{xtype:"tbtext",text:_t("Link Graphs?:")},{xtype:"checkbox",ref:"../linkGraphs",checked:true,listeners:{change:function(r,q){var p=r.refOwner;p.setLinked(q)}}},"-",{xtype:"graphrefreshbutton",ref:"../refreshmenu",stateId:"graphRefresh",iconCls:"refresh",text:_t("Refresh"),handler:function(q){if(q){var p=q.refOwner;p.resetSwoopies()}}}];Ext.define("Zenoss.form.GraphPanel",{alias:["widget.graphpanel"],extend:"Ext.Panel",constructor:function(p){p=p||{};if(!Ext.isDefined(p.showToolbar)){p.showToolbar=true}if(p.showToolbar){p.tbar=k}Ext.applyIf(p,{drange:129600,isLinked:true,bodyStyle:{overflow:"auto"},directFn:m.getGraphDefs});Zenoss.form.GraphPanel.superclass.constructor.apply(this,arguments)},setContext:function(p){this.removeAll();this.lastShown=0;var q={uid:p,drange:this.drange};this.uid=p;this.directFn(q,Ext.bind(this.loadGraphs,this))},loadGraphs:function(p){if(!p.success){return}var s=p.data,q=this,r=this.getEl();if(r.isMasked()){r.unmask()}if(s.length>0){this.addGraphs(s)}else{r.mask(_t("No Graph Data"),"x-mask-msg-noicon")}},addGraphs:function(v){var r=[],u,p,t=this,w=this.lastShown,q=this.lastShown+h,s;for(s=w;s<Math.min(q,v.length);s++){p=Ext.id();u=v[s];r.push(new Zenoss.SwoopyGraph({graphUrl:u.url,graphTitle:u.title,graphId:p,isLinked:this.isLinked,height:250,ref:p}))}this.lastShown=q;if(v.length>q){r.push({xtype:"button",margin:"0 0 7 7",text:_t("Show more results..."),handler:function(x){x.hide();t.addGraphs(v)}})}this.add(r)},setDrange:function(p){p=p||this.drange;this.drange=p;Ext.each(this.getGraphs(),function(q){q.fireEvent("updateimage",{drange:p,start:p,end:0},this)})},resetSwoopies:function(){Ext.each(this.getGraphs(),function(p){p.fireEvent("updateimage",{},this)})},getGraphs:function(){var p=Zenoss.util.filter(this.items.items,function(q){return q.graphUrl});return p},setLinked:function(p){this.isLinked=p;Ext.each(this.getGraphs(),function(q){q.setLinked(p)})}})}());(function(){var d=Zenoss.remote.TemplateRouter,a;function c(h,f){var g=h.refOwner.getCurrentUid(),j={uid:g,templateName:f};d.makeLocalRRDTemplate(j,function(){h.refresh()})}function b(h,f){var g=h.refOwner.getCurrentUid(),j={uid:g,templateName:f};d.removeLocalRRDTemplate(j,function(){h.refresh()})}function e(f,g){return g.startswith(f)}Ext.define("Zenoss.ComponentTemplatePanel",{alias:["widget.componenttemplatepanel"],extend:"Ext.Panel",constructor:function(f){var g=this;f=f||{};Ext.applyIf(f,{layout:"fit",autoScroll:"y",items:[{layout:"border",defaults:{split:true},items:[{region:"west",width:"65%",xtype:"contextgridpanel",ref:"../templates",selModel:Ext.create("Zenoss.SingleRowSelectionModel",{listeners:{select:function(h,j,m){var l=g.thresholds,k=g.templates;l.setContext(j.get("uid"));if(e(k.refOwner.getCurrentUid(),j.get("uid"))){k.deleteLocalCopyButton.enable();k.createLocalCopyButton.disable()}else{k.createLocalCopyButton.enable();k.deleteLocalCopyButton.disable()}l.addButton.enable()},deselect:function(h){var k=g.thresholds,j=g.templates;k.addButton.disable();j.deleteLocalCopyButton.disable();j.createLocalCopyButton.disable()}}}),tbar:[{ref:"../createLocalCopyButton",xtype:"button",disabled:true,text:_t("Create Local Copy"),handler:function(j){var h=j.refOwner,k=h.getSelectionModel().getSelected();if(k){c(h,k.data.name)}}},{ref:"../deleteLocalCopyButton",xtype:"button",text:_t("Delete Local Copy"),disabled:true,tooltip:_t("Delete the local copy of this template"),handler:function(j){var h=j.refOwner,k=h.getSelectionModel().getSelected();if(k){new Zenoss.dialog.SimpleMessageDialog({title:_t("Delete Copy"),message:Ext.String.format(_t("Are you sure you want to delete the local copy of this template? There is no undo.")),buttons:[{xtype:"DialogButton",text:_t("OK"),handler:function(){b(h,k.data.name)}},{xtype:"DialogButton",text:_t("Cancel")}]}).show()}}}],store:Ext.create("Zenoss.NonPaginatedStore",{directFn:d.getObjTemplates,fields:["uid","name","description","definition"],root:"data",listeners:{load:function(h){if(h.getCount()){g.templates.getSelectionModel().selectRange(0,0)}return true}}}),viewConfig:{emptyText:_t("No Templates"),stripeRows:true},columns:[{dataIndex:"name",header:_t("Name"),width:80,renderer:function(k,h,j){var l=j.data.uid;if(l){return Zenoss.render.link(null,l,k)}return k}},{dataIndex:"description",flex:1,header:_t("Description")},{minWidth:200,dataIndex:"definition",header:_t("Definition")}]},{id:"component_template_threshold",region:"center",title:null,stateId:"component_template_thresholds",xtype:"thresholddatagrid",ref:"../thresholds",getTemplateUid:function(){var h=this.refOwner.templates,j=h.getSelectionModel().getSelected();if(j){return j.data.uid}},tbarItems:[{xtype:"tbtext",text:_t("Thresholds")},"-"]}]}]});this.callParent(arguments)},setContext:function(h){var g=this.templates,f=g.getStore();g.setContext(h);this._uid=h;this.thresholds.addButton.disable()},getCurrentUid:function(){return this._uid}})})();(function(){Ext.define("Zenoss.LockPanel",{extend:"Ext.panel.Panel",alias:["widget.lockpanel"],constructor:function(a){a=a||{};Ext.applyIf(a,{listeners:{show:Ext.bind(this.setCheckboxes,this)},items:[{xtype:"panel",frame:false,border:false,layout:"vbox",height:110,defaults:{xtype:"checkbox",flex:1,align:"stretch"},items:[{name:"updates",ref:"../updates",boxLabel:_t("Lock from updates"),listeners:{change:Ext.bind(this.setCheckboxes,this)},checked:a.updatesChecked},{name:"deletion",ref:"../deletion",boxLabel:_t("Lock from deletion"),listeners:{change:Ext.bind(this.setCheckboxes,this)},checked:a.deletionChecked},{name:"sendEvent",ref:"../sendEventWhenBlocked",boxLabel:_t("Send an event when an action is blocked"),checked:a.sendEventChecked}]}]});this.callParent([a])},setCheckboxes:function(){var b=this.updates.getValue(),a=this.deletion.getValue();if(b||a){this.sendEventWhenBlocked.enable()}else{this.sendEventWhenBlocked.setValue(false);this.sendEventWhenBlocked.disable()}if(b){this.deletion.setValue(true);this.deletion.disable()}else{this.deletion.enable()}}});Ext.define("Zenoss.dialog.LockForm",{extend:"Zenoss.SmartFormDialog",constructor:function(a){a=a||{};Ext.applyIf(a,{submitFn:Zenoss.remote.DeviceRouter.lockDevices,applyOptions:Ext.emptyFn,height:220,title:_t("Locking"),submitHandler:Ext.bind(this.lockObject,this),items:{xtype:"lockpanel",updatesChecked:a.updatesChecked,deletionChecked:a.deletionChecked,sendEventChecked:a.sendEventChecked}});this.callParent([a])},lockObject:function(a){this.applyOptions(a);this.submitFn(a)}})}());(function(){Ext.define("Zenoss.form.ExampleTextField",{alias:["widget.exampletextfield"],extend:"Ext.form.field.Text",config:{example:null},fieldSubTpl:['<input id="{id}" type="{type}" {inputAttrTpl}',' size="1"','<tpl if="name"> name="{name}"</tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' class="{fieldCls} {typeCls} {editableCls}" autocomplete="off"/><span class="example">Example: {example}</span>',{disableFormats:true}],constructor:function(a){a=a||{};a.style=a.style||{};Ext.applyIf(a.style,{paddingBottom:20});this.callParent([a])},getSubTplData:function(){var a=this;return Ext.apply(a.callParent(),{example:a.example})}})}());(function(){Ext.ns("Zenoss");var d=Zenoss.remote.JobsRouter;function h(j){return j==null?0:j}function e(k){for(var j in k){if(k.hasOwnProperty(j)){return false}}return true}function a(n,k,j){var m=j.data,l=m.description;l=l.length>58?l.substring(0,55)+"...":l;return"<a href='/zport/dmd/joblist#jobs:"+m.uuid+"'>"+l+"</a>"}function b(o,m,k){var j,n=k.data,l=new Date(0);switch(n.status){case"SUCCESS":j=_t("Finished");break;case"STARTED":j=_t("Started");break;case"PENDING":j=_t("Scheduled");break}l.setUTCSeconds(o);return j+" "+l.readable(1)}Ext.define("Zenoss.model.Job",{extend:"Ext.data.Model",idProperty:"uuid",fields:["uuid","type","description","scheduled","started","finished","status","result","user"]});var c=Ext.create("Ext.data.Store",{model:"Zenoss.model.Job",initialSortColumn:"running"});var g=Ext.create("Ext.data.Store",{model:"Zenoss.model.Job",initialSortColumn:"pending"});var f=Ext.create("Ext.data.Store",{model:"Zenoss.model.Job",initialSortColumn:"finished"});Ext.define("Zenoss.JobsWidget",{alias:["widget.jobswidget"],extend:"Ext.Button",constructor:function(j){j=Ext.applyIf(j||{},{menuAlign:"br-tr?",menu:{layout:"fit",plain:true,bodyStyle:"background:transparent;padding:0;border:0",style:"background:transparent;padding:0;border:0",items:[{xtype:"container",width:425,style:{border:"1px solid #444","-webkit-border-radius":5,"-moz-border-radius":5,"-ms-border-radius":5,borderRadius:5},items:[{id:"nojobspanel",xtype:"panel",bodyStyle:"padding:4px",hidden:true,html:_t("No jobs")},{id:"jobs-grid-running",xtype:"grid",hideHeaders:true,forceFit:true,stateful:false,disableSelection:true,title:_t("Running jobs"),store:c,columns:[{header:"description",dataIndex:"description",renderer:a},{header:"started",dataIndex:"started",renderer:b,width:150}]},{id:"jobs-grid-pending",xtype:"grid",hideHeaders:true,forceFit:true,stateful:false,disableSelection:true,title:_t("Pending jobs"),store:g,columns:[{header:"description",dataIndex:"description",renderer:a},{header:"scheduled",dataIndex:"scheduled",renderer:b,width:150}]},{id:"jobs-grid-finished",xtype:"grid",hideHeaders:true,forceFit:true,stateful:false,disableSelection:true,title:_t("Finished jobs"),store:f,columns:[{header:"description",dataIndex:"description",renderer:a,width:60,flex:1},{header:"finished",dataIndex:"finished",renderer:b,width:150}]},{xtype:"panel",id:"more-jobs-link",bodyStyle:"font-size:11px; padding:3px; padding-left: 5px",html:'<a href="/zport/dmd/joblist">More...</a>'}]}]}});this.lastchecked=0;this.callParent([j]);this.on("beforerender",this.on_render,this,{single:true});this.on("menushow",function(k){k.menu.hide();new Ext.util.DelayedTask(function(){k.menu.show()}).delay(500)},this,{single:true});this.pollTask=new Ext.util.DelayedTask(this.poll,this)},initComponent:function(){this.lastchecked=Ext.util.Cookies.get("jobswidget_update")||0;this.callParent(arguments)},on_render:function(){this.menucontainer=this.menu.items.items[0];this.init_tip();this.pollTask.delay(2000)},initEvents:function(){this.callParent(arguments);this.addEvents("update");Ext.Direct.on("event",function(j){if(Ext.isDefined(j.result)&&j.result&&Ext.isDefined(j.result.new_jobs)){Ext.each(j.result.new_jobs,function(k){this.alert_new(k)},this)}},this)},init_tip:function(){var k=this,j=Ext.ClassManager.getByAlias("widget.tooltip"),l=this.tip=Ext.create("Ext.tip.ToolTip",{target:this,dismissDelay:9000,show:function(){j.prototype.show.call(this);this.triggerElement=k.el;this.clearTimer("hide");this.targetXY=this.el.getAlignToXY(k.el,"br-tr",[-15,-18]);j.prototype.show.call(this)}});l.mun(this,"mouseover",l.onTargetOver,l);l.mun(this,"mouseout",l.onTargetOut,l);l.mun(this,"mousemove",l.onMouseMove,l)},alert:function(j){if(this.tip.isVisible()){j=this.tip.body.dom.innerHTML+"<br/><br/>"+j}this.tip.update(j);this.tip.show()},alert_new:function(j){this.alert("<b>New job</b>: "+Ext.htmlEncode(j.description))},alert_finished:function(j){this.alert("<b>Finished job</b>: "+Ext.htmlEncode(j.description))},poll:function(){this.update();this.pollTask.delay(Zenoss.settings.zenjobsRefreshInterval*1000)},pause:function(){this.pollTask.cancel()},check_for_recently_finished:function(j){if(Ext.isDefined(j.SUCCESS)){Ext.each(j.SUCCESS,function(k){if(k.finished>=this.lastchecked){this.alert_finished(k)}},this)}this.set_lastchecked()},update_button:function(m){var o=h(m.PENDING),k=h(m.STARTED),n,j,l;if(!o&&!k){n=_t("0 Jobs");j="circle_arrows_still"}else{k>1?l=" Jobs":l=" Job";n=k+l+" ("+o+" Pending)";j="circle_arrows_ani"}this.setIconCls(j);this.setText(n)},update_menu:function(j){if(!e(j)){Ext.getCmp("nojobspanel").hide();Ext.getCmp("jobs-grid-running").setVisible(j.STARTED);if(j.STARTED){c.loadData(j.STARTED)}Ext.getCmp("jobs-grid-pending").setVisible(j.PENDING);if(j.PENDING){g.loadData(j.PENDING)}Ext.getCmp("jobs-grid-finished").setVisible(j.SUCCESS);if(j.SUCCESS){f.loadData(j.SUCCESS)}Ext.getCmp("more-jobs-link").show()}else{Ext.getCmp("nojobspanel").show();Ext.getCmp("jobs-grid-running").hide();Ext.getCmp("jobs-grid-pending").hide();Ext.getCmp("jobs-grid-finished").hide();Ext.getCmp("more-jobs-link").hide()}},set_lastchecked:function(){var j=Ext.Date.add(new Date(),Ext.Date.DAY,14);this.lastchecked=(new Date().getTime()/1000);Ext.util.Cookies.set("jobswidget_update",this.lastchecked,j)},update:function(){d.userjobs({},function(k){var j=k.jobs;this.update_button(k.totals);this.update_menu(j);this.check_for_recently_finished(j)},this)}})})();(function(){Ext.define("Zenoss.stats.ResultsWindow",{extend:"Zenoss.dialog.BaseDialog",constructor:function(h){var f=h.finalTime,g=h.loadingTime;Ext.applyIf(h,{title:_t("Page Load Time"),defaults:{xtype:"displayfield"},items:[{value:Ext.String.format(_t("{0} seconds until the page is ready to use."),g)},{value:Ext.String.format(_t("{0} seconds in layout and rendering on the client."),(f-Zenoss._pageStartTime).toFixed(2))},{value:Ext.String.format(_t("{0} seconds since ExtJs start time."),(f-(Ext._startTime/1000)).toFixed(2))},{value:Ext.String.format(_t("{0} seconds spent in Ajax requests."),(h.ajaxTime).toFixed(2))}]});this.callParent([h])}});Ext.define("Zenoss.stats.Infrastructure",{pageName:"Infrastructure",constructor:function(){this.addHooks()},addHooks:function(){Ext.getCmp("device_grid").getStore().on("guaranteedrange",this.checkReady,this,{single:true})},getTiming:function(){var f=window.performance||{};var g=f.now||f.mozNow||f.webkitNow||f.msNow||f.oNow;return g?g.bind(f):Ext.emptyFn},checkReady:function(){var g=new Date().getTime()/1000,h=this.getTiming()(),f=Ext.Array.sum(Ext.pluck(c,"time"));if(!h){return}h=(h/1000).toFixed(2);Zenoss.remote.DetailNavRouter.recordPageLoadTime({page:this.pageName,time:h});Ext.Ajax.un("beforerequest",a);Ext.Ajax.un("requestcomplete",e);Ext.getCmp("footer_bar").add(["-",{xtype:"button",text:Ext.String.format(_t("{0} seconds"),h),handler:function(){Ext.create("Zenoss.stats.ResultsWindow",{finalTime:g,loadingTime:h,ajaxTime:f}).show()}}])}});Ext.define("Zenoss.stats.Events",{extend:"Zenoss.stats.Infrastructure",pageName:"EventConsole",addHooks:function(){Ext.getCmp("events_grid").getStore().on("datachanged",this.checkReady,this,{single:true})}});Ext.define("Zenoss.stats.DeviceDetail",{extend:"Zenoss.stats.Infrastructure",pageName:"DeviceDetails",addHooks:function(){var f=Ext.getCmp("deviceDetailNav");f.on("componenttreeloaded",this.checkReady,this,{single:true})}});var b={},c=[];function d(g){if(!g){return null}if(Ext.isArray(g)){var f=Ext.pluck(g,"id");return f.join(" ")}return g.id}function a(h,g){var f=g.url,j=d(g.transaction);if(j){b[j]={url:f,starttime:new Date().getTime()}}}function e(k,f,h){var g=h.url,j=new Date().getTime(),l=d(h.transaction);if(b[l]){c.push({url:g,time:(j-b[l].starttime)/1000});delete b[l]}}Ext.onReady(function(){if(Zenoss.settings.showPageStatistics){Ext.Ajax.on("beforerequest",a);Ext.Ajax.on("requestcomplete",e)}})}());