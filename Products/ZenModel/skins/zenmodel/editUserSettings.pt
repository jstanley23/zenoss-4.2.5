<tal:block metal:use-macro="here/page_macros/old-new">
<tal:block metal:fill-slot="contentPane">

<script type="text/javascript">
function ConfirmEmailTest() {
    return confirm(
        "Make sure you have saved any changes to this form." +
        "  This will send a test email to this address." +
        "  Do you wish to continue?");
}

function ConfirmPagerTest() {
    return confirm(
        "Make sure you have saved any changes to this form." +
        "  This will send a test message to this pager number." +
        "  Do you wish to continue?");
}

function resetPassword(){
    if (confirm("Are you sure you want to reset this user's password?")) {
        /*  added a hidden input to act as the 'real' submit button 
            next to the visible submit button. This 'real' submit button
            gets us around the use of the popup confirm submit button conflict.
            We simulate a click on this hidden 'real' submit button below
        */
        var pwdButton = Ext.getDom("passwordResetButton");
        pwdButton.value="Please wait...";
        pwdButton.onclick = null;
        Ext.getDom("resetInitiator").click();
    }
}


function clearBrowserState(event){
    if(confirm("Are you sure you want to reset your preferences to their default values?")){
        Zenoss.remote.MessagingRouter.clearBrowserState();
    }
}

setTimeout(function () {
        document.getElementById('password').autocomplete = 'off';
        document.getElementById('sndpassword').autocomplete = 'off';
        document.getElementById('pwconfirm').autocomplete = 'off';
    }, 1);

</script>



<input type="hidden" name="zenScreenName" tal:attributes="value template/id" />

        <tal:block tal:define="message request/message | string:State at time:;
            tabletitle string:${message} ${here/getNowString}">
        <tal:block metal:use-macro="here/zenuimacros/macros/zentable">

        <!--====Optional titlebar slots=============

            <tal:block metal:fill-slot="filterslot">
            </tal:block>

            <tal:block metal:fill-slot="menuslot">
            </tal:block>

            ==========================================-->

        <tal:block metal:fill-slot="zentablecontents">
        <!-- BEGIN TABLE CONTENTS -->
    <tr>
    <td style="padding:8px 0 8px 8px;border-bottom:solid 1px #ccc;" colspan="4">
      <form method=post tal:attributes="action string:${here/absolute_url_path}" name="user">
        <div style="background:#ddd;width:372px;height:40px;">
            <div style="float:left;width:230px;height:40px;font-size:11px;line-height:12px;color:#555;padding:2px 0 0 4px;">
                Automatically generate a new password and send it to the email listed below.
            </div>
            <div style="float:left;padding:2px 0 0 8px;">
              <input type="submit" name="manage_resetPassword:method" id="resetInitiator" style="display:none;" />
              <input type="button" value="Reset Password"
                     tabindex="-1"
                     style="height:30px;width:132px;text-align:center;"
                     onclick="resetPassword()"
                     class="tableheader"
                     id="passwordResetButton" />

            </div>
        </div>
      </form>
    </td>
    </tr>
    <tr tal:condition="here/isLoggedInUser">
    <td class="tableheader" style="padding:0 0 0 8px;border-bottom:solid 1px #888;background:#bbb;" colspan="4">
        <div style="font-size:14px;">
            USER PREFERENCES        </div>
    </td>
    </tr>
    <tr tal:condition="here/isLoggedInUser">
    <td style="padding:8px 0 8px 8px;border-bottom:solid 1px #ccc;" colspan="4">
        <div style="background:#ddd;width:372px;height:50px;">
            <div style="float:left;width:230px;height:50px;font-size:11px;line-height:12px;color:#555;padding:2px 0 0 4px;">
                Reset all preferences such as grid columns and filters to their default values.
            </div>
            <div style="float:left;padding:2px 0 0 8px;">
            <button style="height:30px;width:132px;text-align:center;"
                   onclick="clearBrowserState(event)"
                   class="tableheader">
               Reset Preferences
            </button>
            </div>
        </div>
    </td>
    </tr>

<form method=post tal:attributes="action string:${here/absolute_url_path}" name="user" autocomplete="off">

    <tr>
    <td class="tableheader" style="padding:0 0 0 8px;border-bottom:solid 1px #888;background:#bbb;" colspan="4">
        <div style="font-size:14px;">
            USER SETTINGS        </div>
    </td>
    </tr>


    <tr tal:condition="here/isManager">
      <td class="tableheader" align="left">Roles</td>
      <td class="tablevalues">
        <select class="tablevalues" name="roles:list" multiple
            tal:define="allroles here/getAllRoles;curroles here/getUserRoles">
            <option tal:repeat="r allroles" tal:content="r"
                    tal:attributes="value r; selected python:r in curroles"/>
        </select>
      </td>
    </tr>
    <tr tal:condition="here/isManager">
      <td class="tableheader" align="left">Groups</td>
      <td class="tablevalues">
        <select class="tablevalues" name="groups:list" multiple
            tal:define="allgroups here/getAllGroupSettingsNames;
                currgroups here/getUserGroupSettingsNames">
            <option tal:repeat="r allgroups" tal:content="r"
                    tal:attributes="value r; selected python:r in currgroups"/>
        </select>
      </td>
    </tr>
    <tr>
      <td class="tableheader" align="left">Email</td>
      <td class="tablevalues">
        <input class="tablevalues" type="text" name="email" size="40"
            tal:attributes="value here/email" />
        <tal:block tal:condition="here/email">
        &nbsp;&nbsp;
        <a class="tablevalues" onclick="return ConfirmEmailTest()"
        tal:attributes="href string:${here/absolute_url_path}?zenScreenName=editUserSettings&manage_emailTest:method=1&userid=${here/getId}&redirect=True">test</a>
        </tal:block>
      </td>
    </tr>
    <tr>
      <td class="tableheader" align="left">Pager</td>
      <td class="tablevalues">
        <input class="tablevalues" type="text" name="pager" size="40"
            tal:attributes="value here/pager" />
        <tal:block tal:condition="here/pager">
        &nbsp;&nbsp;
        <a class="tablevalues" onclick="return ConfirmPagerTest()"
        tal:attributes="href string:${here/absolute_url_path}?zenScreenName=editUserSettings&manage_pagerTest:method=1&userid=${here/getId}&redirect=True">test</a>
        </tal:block>
      </td>
    </tr>
    <tr>
      <td class="tableheader" align="left">Default Page Size</td>
      <td class="tablevalues">
        <input class="tablevalues" type="text" name="defaultPageSize"
            tal:attributes="value here/defaultPageSize" />
      </td>
    </tr>
    <tr tal:condition="here/isManager">
      <td class="tableheader" align="left">Default Admin Role</td>
      <td class="tablevalues">
        <select class="tablevalues" name="defaultAdminRole"
            tal:define="roles here/getAllRoles">
            <option tal:repeat="role roles" tal:content="role"
                tal:attributes="selected python:here.defaultAdminRole==role"/>
        </select>
      </td>
    </tr>
    <tr>
      <td class="tableheader" align="left">Network Map Start Object</td>
      <td class="tablevalues">
        <input class="tablevalues" type="text" name="netMapStartObject"
            tal:attributes="value here/netMapStartObject" />
      </td>
    </tr>

    <tr>
        <td style="height:1px;border-bottom:dashed 1px #bbb;" class="tableheader">
        </td>
        <td style="height:1px;border-bottom:dashed 1px #ccc;" colspan=3>
        </td>
    </tr>

    <tr>
      <td class="tableheader" align="left">Set New Password</td>
      <td class="tablevalues">
        <input class="tablevalues" type="password" name="password" id="password"
            autocomplete="off"/>
       </td>
    </tr>
    <tr>
      <td class="tableheader" align="left">Confirm New Password</td>
      <td class="tablevalues">
        <input class="tablevalues" type="password" name="sndpassword" id="sndpassword"
            autocomplete="off"/>
       </td>
    </tr>


    <tr>
        <td style="color:darkred;width:275px;height:50px" class=tableheader align="left">
            <strong>Enter current password to confirm changes</strong>
        </td>
        <td align="left" style="padding:4px 0 0 4px;" class="tableheader" colspan=3>
            <div style="float:left;">
            <input style="margin-top:2px;" id="pwconfirm" class="tablevalues" type="password" name="oldpassword"
                autocomplete="off"/>
            </div>
                <div style="padding:0 0 0 8px;float:left;">
                <input class="tableheader" type="submit" value=" Save Settings "
                    disabled=true
                    id="formsave"
                    style="height:30px;width:144px;text-align:center;color:#888"
                    name="manage_editUserSettings:method" />
                </div>
        </td>
    </tr>


</form>
        <!-- END TABLE CONTENTS -->

        </tal:block>
        </tal:block>
        </tal:block>



<script>
    connect('pwconfirm', 'onkeyup', function(){
        if($('pwconfirm').value) {
            $('formsave').disabled = false;
            setStyle('formsave', {'color':'#000'});
        } else {
            $('formsave').disabled = true;
            setStyle('formsave', {'color':'#888'});
        }
    });
</script>
</tal:block>
</tal:block>
